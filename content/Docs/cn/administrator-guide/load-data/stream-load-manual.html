

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Stream load &mdash; Doris Documentations 0.11.0 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../../" src="../../../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../../../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../../../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" />
    <link rel="next" title="Routine Load" href="routine-load-manual.html" />
    <link rel="prev" title="Broker Load" href="broker-load-manual.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../../index.html" class="icon icon-home"> Doris Documentations
          

          
          </a>

          
            
            
              <div class="version">
                0.11.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../installing/index.html">编译与部署</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../getting-started/index.html">开始使用</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">操作手册</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="index.html">数据导入</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="load-manual.html">导入总览</a></li>
<li class="toctree-l3"><a class="reference internal" href="broker-load-manual.html">Broker Load</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Stream load</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id1">基本原理</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id2">基本操作</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id8">相关系统配置</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id9">最佳实践</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id13">常见问题</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="routine-load-manual.html">Routine Load</a></li>
<li class="toctree-l3"><a class="reference internal" href="insert-into-manual.html">Insert Into</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../http-actions/index.html">HTTP API</a></li>
<li class="toctree-l2"><a class="reference internal" href="../operation/index.html">运维操作</a></li>
<li class="toctree-l2"><a class="reference internal" href="../backup-restore.html">备份与恢复</a></li>
<li class="toctree-l2"><a class="reference internal" href="../colocation-join.html">Colocation Join</a></li>
<li class="toctree-l2"><a class="reference internal" href="../export_manual.html">数据导出</a></li>
<li class="toctree-l2"><a class="reference internal" href="../privilege.html">权限管理</a></li>
<li class="toctree-l2"><a class="reference internal" href="../small-file-mgr.html">文件管理器</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../extending-doris/index.html">扩展功能</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../internal/index.html">设计文档</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../sql-reference/index.html">SQL 手册</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../community/index.html">Apache 社区</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../index.html">Doris Documentations</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../index.html">操作手册</a> &raquo;</li>
        
          <li><a href="index.html">数据导入</a> &raquo;</li>
        
      <li>Stream load</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../../../_sources/Docs/cn/administrator-guide/load-data/stream-load-manual.md.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="stream-load">
<h1>Stream load<a class="headerlink" href="#stream-load" title="Permalink to this headline">¶</a></h1>
<p>Stream load 是一个同步的导入方式，用户通过发送 HTTP 协议发送请求将本地文件或数据流导入到 Doris 中。Stream load 同步执行导入并返回导入结果。用户可直接通过请求的返回体判断本次导入是否成功。</p>
<p>Stream load 主要适用于导入本地文件，或通过程序导入数据流中的数据。</p>
<div class="section" id="id1">
<h2>基本原理<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h2>
<p>下图展示了 Stream load 的主要流程，省略了一些导入细节。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>                         <span class="o">^</span>      <span class="o">+</span>
                         <span class="o">|</span>      <span class="o">|</span>
                         <span class="o">|</span>      <span class="o">|</span> <span class="mi">1</span><span class="n">A</span><span class="o">.</span> <span class="n">User</span> <span class="n">submit</span> <span class="n">load</span> <span class="n">to</span> <span class="n">FE</span>
                         <span class="o">|</span>      <span class="o">|</span>
                         <span class="o">|</span>   <span class="o">+--</span><span class="n">v</span><span class="o">-----------+</span>
                         <span class="o">|</span>   <span class="o">|</span> <span class="n">FE</span>           <span class="o">|</span>
<span class="mf">5.</span> <span class="n">Return</span> <span class="n">result</span> <span class="n">to</span> <span class="n">user</span> <span class="o">|</span>   <span class="o">+--+-----------+</span>
                         <span class="o">|</span>      <span class="o">|</span>
                         <span class="o">|</span>      <span class="o">|</span> <span class="mf">2.</span> <span class="n">Redirect</span> <span class="n">to</span> <span class="n">BE</span>
                         <span class="o">|</span>      <span class="o">|</span>
                         <span class="o">|</span>   <span class="o">+--</span><span class="n">v</span><span class="o">-----------+</span>
                         <span class="o">+---+</span><span class="n">Coordinator</span> <span class="n">BE</span><span class="o">|</span> <span class="mi">1</span><span class="n">B</span><span class="o">.</span> <span class="n">User</span> <span class="n">submit</span> <span class="n">load</span> <span class="n">to</span> <span class="n">BE</span>
                             <span class="o">+-+-----+----+-+</span>
                               <span class="o">|</span>     <span class="o">|</span>    <span class="o">|</span>
                         <span class="o">+-----+</span>     <span class="o">|</span>    <span class="o">+-----+</span>
                         <span class="o">|</span>           <span class="o">|</span>          <span class="o">|</span> <span class="mf">3.</span> <span class="n">Distrbute</span> <span class="n">data</span>
                         <span class="o">|</span>           <span class="o">|</span>          <span class="o">|</span>
                       <span class="o">+-</span><span class="n">v</span><span class="o">-+</span>       <span class="o">+-</span><span class="n">v</span><span class="o">-+</span>      <span class="o">+-</span><span class="n">v</span><span class="o">-+</span>
                       <span class="o">|</span><span class="n">BE</span> <span class="o">|</span>       <span class="o">|</span><span class="n">BE</span> <span class="o">|</span>      <span class="o">|</span><span class="n">BE</span> <span class="o">|</span>
                       <span class="o">+---+</span>       <span class="o">+---+</span>      <span class="o">+---+</span>
</pre></div>
</div>
<p>Stream load 中，Doris 会选定一个节点作为 Coordinator 节点。该节点负责接数据并分发数据到其他数据节点。</p>
<p>用户通过 HTTP 协议提交导入命令。如果提交到 FE，则 FE 会通过 HTTP redirect 指令将请求转发给某一个 BE。用户也可以直接提交导入命令给某一指定 BE。</p>
<p>导入的最终结果由 Coordinator BE 返回给用户。</p>
</div>
<div class="section" id="id2">
<h2>基本操作<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id3">
<h3>创建导入<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h3>
<p>Stream load 通过 HTTP 协议提交和传输数据。这里通过 <code class="docutils literal notranslate"><span class="pre">curl</span></code> 命令展示如何提交导入。</p>
<p>用户也可以通过其他 HTTP client 进行操作。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>curl --location-trusted -u user:passwd [-H &quot;&quot;...] -T data.file -XPUT http://fe_host:http_port/api/{db}/{table}/_stream_load

Header 中支持如下属性：
label， column_separator， columns， where， max_filter_ratio， partitions
格式为: -H &quot;key1:value1&quot;
</pre></div>
</div>
<p>示例：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">curl</span> <span class="o">--</span><span class="n">location</span><span class="o">-</span><span class="n">trusted</span> <span class="o">-</span><span class="n">u</span> <span class="n">root</span> <span class="o">-</span><span class="n">T</span> <span class="n">date</span> <span class="o">-</span><span class="n">H</span> <span class="s2">&quot;label:123&quot;</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">abc</span><span class="o">.</span><span class="n">com</span><span class="p">:</span><span class="mi">8030</span><span class="o">/</span><span class="n">api</span><span class="o">/</span><span class="n">test</span><span class="o">/</span><span class="n">date</span><span class="o">/</span><span class="n">_stream_load</span>
</pre></div>
</div>
<p>创建导入的详细语法帮助执行 <code class="docutils literal notranslate"><span class="pre">HELP</span> <span class="pre">STREAM</span> <span class="pre">LOAD</span></code> 查看, 下面主要介绍创建 Stream load 的部分参数意义。</p>
<div class="section" id="id4">
<h4>签名参数<a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h4>
<ul>
<li><p class="first">user/passwd</p>
<p>Stream load 由于创建导入的协议使用的是 HTTP 协议，通过 Basic access authentication 进行签名。Doris 系统会根据签名验证用户身份和导入权限。</p>
</li>
</ul>
</div>
<div class="section" id="id5">
<h4>导入任务参数<a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h4>
<p>Stream load 由于使用的是 HTTP 协议，所以所有导入任务有关的参数均设置在 Header 中。下面主要介绍了 Stream load 导入任务参数的部分参数意义。</p>
<ul>
<li><p class="first">label</p>
<p>导入任务的标识。每个导入任务，都有一个在单 database 内部唯一的 label。label 是用户在导入命令中自定义的名称。通过这个 label，用户可以查看对应导入任务的执行情况。</p>
<p>label 的另一个作用，是防止用户重复导入相同的数据。<strong>强烈推荐用户同一批次数据使用相同的 label。这样同一批次数据的重复请求只会被接受一次，保证了 At-Most-Once</strong></p>
<p>当 label 对应的导入作业状态为 CANCELLED 时，该 label 可以再次被使用。</p>
</li>
<li><p class="first">max_filter_ratio</p>
<p>导入任务的最大容忍率，默认为0容忍，取值范围是0~1。当导入的错误率超过该值，则导入失败。</p>
<p>如果用户希望忽略错误的行，可以通过设置这个参数大于 0，来保证导入可以成功。</p>
<p>计算公式为：</p>
<p><code class="docutils literal notranslate"><span class="pre">(dpp.abnorm.ALL</span> <span class="pre">/</span> <span class="pre">(dpp.abnorm.ALL</span> <span class="pre">+</span> <span class="pre">dpp.norm.ALL</span> <span class="pre">)</span> <span class="pre">)</span> <span class="pre">&gt;</span> <span class="pre">max_filter_ratio</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">dpp.abnorm.ALL</span></code> 表示数据质量不合格的行数。如类型不匹配，列数不匹配，长度不匹配等等。</p>
<p><code class="docutils literal notranslate"><span class="pre">dpp.norm.ALL</span></code> 指的是导入过程中正确数据的条数。可以通过 <code class="docutils literal notranslate"><span class="pre">SHOW</span> <span class="pre">LOAD</span></code> 命令查询导入任务的正确数据量。</p>
<p>原始文件的行数 = <code class="docutils literal notranslate"><span class="pre">dpp.abnorm.ALL</span> <span class="pre">+</span> <span class="pre">dpp.norm.ALL</span></code></p>
</li>
<li><p class="first">where</p>
<p>导入任务指定的过滤条件。Stream load 支持对原始数据指定 where 语句进行过滤。被过滤的数据将不会被导入，也不会参与 filter ratio 的计算，但会被计入<code class="docutils literal notranslate"><span class="pre">num_rows_unselected</span></code>。</p>
</li>
<li><p class="first">partition</p>
<p>待导入表的 Partition 信息，如果待导入数据不属于指定的 Partition 则不会被导入。这些数据将计入 <code class="docutils literal notranslate"><span class="pre">dpp.abnorm.ALL</span> </code></p>
</li>
<li><p class="first">columns</p>
<p>待导入数据的函数变换配置，目前 Stream load 支持的函数变换方法包含列的顺序变化以及表达式变换，其中表达式变换的方法与查询语句的一致。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>列顺序变换例子：原始数据有两列，目前表也有两列（c1,c2）但是原始文件的第一列对应的是目标表的c2列, 而原始文件的第二列对应的是目标表的c1列，则写法如下：
columns: c2,c1

表达式变换例子：原始文件有两列，目标表也有两列（c1,c2）但是原始文件的两列均需要经过函数变换才能对应目标表的两列，则写法如下：
columns: tmp_c1, tmp_c2, c1 = year(tmp_c1), c2 = mouth(tmp_c2)
其中 tmp_*是一个占位符，代表的是原始文件中的两个原始列。
</pre></div>
</div>
</li>
</ul>
</div>
</div>
<div class="section" id="id6">
<h3>返回结果<a class="headerlink" href="#id6" title="Permalink to this headline">¶</a></h3>
<p>由于 Stream load 是一种同步的导入方式，所以导入的结果会通过创建导入的返回值直接返回给用户。</p>
<p>示例：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="s2">&quot;TxnId&quot;</span><span class="p">:</span> <span class="mi">1003</span><span class="p">,</span>
    <span class="s2">&quot;Label&quot;</span><span class="p">:</span> <span class="s2">&quot;b6f3bc78-0d2c-45d9-9e4c-faa0a0149bee&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Status&quot;</span><span class="p">:</span> <span class="s2">&quot;Success&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Message&quot;</span><span class="p">:</span> <span class="s2">&quot;OK&quot;</span><span class="p">,</span>
    <span class="s2">&quot;NumberTotalRows&quot;</span><span class="p">:</span> <span class="mi">1000000</span><span class="p">,</span>
    <span class="s2">&quot;NumberLoadedRows&quot;</span><span class="p">:</span> <span class="mi">1000000</span><span class="p">,</span>
    <span class="s2">&quot;NumberFilteredRows&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="s2">&quot;NumberUnselectedRows&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
    <span class="s2">&quot;LoadBytes&quot;</span><span class="p">:</span> <span class="mi">40888898</span><span class="p">,</span>
    <span class="s2">&quot;LoadTimeMs&quot;</span><span class="p">:</span> <span class="mi">2144</span><span class="p">,</span>
    <span class="s2">&quot;ErrorURL&quot;</span><span class="p">:</span> <span class="s2">&quot;http://192.168.1.1:8042/api/_load_error_log?file=__shard_0/error_log_insert_stmt_db18266d4d9b4ee5-abb00ddd64bdf005_db18266d4d9b4ee5_abb00ddd64bdf005&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>下面主要解释了 Stream load 导入结果参数：</p>
<ul>
<li><p class="first">TxnId：导入的事务ID。用户可不感知。</p>
</li>
<li><p class="first">Label：导入 Label。由用户指定或系统自动生成。</p>
</li>
<li><p class="first">Status：导入完成状态。</p>
<p>“Success”：表示导入成功。</p>
<p>“Publish Timeout”：该状态也表示导入已经完成，只是数据可能会延迟可见，无需重试。</p>
<p>“Label Already Exists”：Label 重复，需更换 Label。</p>
<p>“Fail”：导入失败。</p>
</li>
<li><p class="first">Message：导入错误信息。</p>
</li>
<li><p class="first">NumberTotalRows：导入总处理的行数。</p>
</li>
<li><p class="first">NumberLoadedRows：成功导入的行数。</p>
</li>
<li><p class="first">NumberFilteredRows：数据质量不合格的行数。</p>
</li>
<li><p class="first">NumberUnselectedRows：被 where 条件过滤的行数。</p>
</li>
<li><p class="first">LoadBytes：导入的字节数。</p>
</li>
<li><p class="first">LoadTimeMs：导入完成时间。单位毫秒。</p>
</li>
<li><p class="first">ErrorURL：如果有数据质量问题，通过访问这个 URL 查看具体错误行。</p>
</li>
</ul>
<blockquote>
<div>注意：由于 Stream load 是同步的导入方式，所以并不会在 Doris 系统中记录导入信息，用户无法异步的通过查看导入命令看到 Stream load。使用时需监听创建导入请求的返回值获取导入结果。</div></blockquote>
</div>
<div class="section" id="id7">
<h3>取消导入<a class="headerlink" href="#id7" title="Permalink to this headline">¶</a></h3>
<p>用户无法手动取消 Stream load，Stream load 在超时或者导入错误后会被系统自动取消。</p>
</div>
</div>
<div class="section" id="id8">
<h2>相关系统配置<a class="headerlink" href="#id8" title="Permalink to this headline">¶</a></h2>
<div class="section" id="fe">
<h3>FE 配置<a class="headerlink" href="#fe" title="Permalink to this headline">¶</a></h3>
<ul>
<li><p class="first">stream_load_default_timeout_second</p>
<p>导入任务的超时时间(以秒为单位)，导入任务在设定的 timeout 时间内未完成则会被系统取消，变成 CANCELLED。</p>
<p>目前 Stream load 并不支持自定义导入的 timeout 时间，所有 Stream load 导入的超时时间是统一的，默认的 timeout 时间为300秒。如果导入的源文件无法再规定时间内完成导入，则需要调整 FE 的参数<code class="docutils literal notranslate"><span class="pre">stream_load_default_timeout_second</span></code>。</p>
</li>
</ul>
</div>
<div class="section" id="be">
<h3>BE 配置<a class="headerlink" href="#be" title="Permalink to this headline">¶</a></h3>
<ul>
<li><p class="first">streaming_load_max_mb</p>
<p>Stream load 的最大导入大小，默认为 10G，单位是 MB。如果用户的原始文件超过这个值，则需要调整 BE 的参数 <code class="docutils literal notranslate"><span class="pre">streaming_load_max_mb</span></code>。</p>
</li>
</ul>
</div>
</div>
<div class="section" id="id9">
<h2>最佳实践<a class="headerlink" href="#id9" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id10">
<h3>应用场景<a class="headerlink" href="#id10" title="Permalink to this headline">¶</a></h3>
<p>使用 Stream load 的最合适场景就是原始文件在内存中，或者在磁盘中。其次，由于 Stream load 是一种同步的导入方式，所以用户如果希望用同步方式获取导入结果，也可以使用这种导入。</p>
</div>
<div class="section" id="id11">
<h3>数据量<a class="headerlink" href="#id11" title="Permalink to this headline">¶</a></h3>
<p>由于 Stream load 的原理是由 BE 发起的导入并分发数据，建议的导入数据量在 1G 到 10G 之间。由于默认的最大 Stream load 导入数据量为 10G，所以如果要导入超过 10G 的文件需要修改 BE 的配置 <code class="docutils literal notranslate"><span class="pre">streaming_load_max_mb</span></code></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>比如：待导入文件大小为15G
修改 BE 配置 streaming_load_max_mb 为 16000 即可。
</pre></div>
</div>
<p>Stream load 的默认超时为 300秒，按照 Doris 目前最大的导入限速来看，约超过 3G 的文件就需要修改导入任务默认超时时间了。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>导入任务超时时间 = 导入数据量 / 10M/s （具体的平均导入速度需要用户根据自己的集群情况计算）
例如：导入一个 10G 的文件
timeout = 1000s 等于 10G / 10M/s
</pre></div>
</div>
</div>
<div class="section" id="id12">
<h3>完整例子<a class="headerlink" href="#id12" title="Permalink to this headline">¶</a></h3>
<p>数据情况： 数据在发送导入请求端的本地磁盘路径 /home/store_sales 中，导入的数据量约为 15G，希望导入到数据库 bj_sales 的表 store_sales 中。</p>
<p>集群情况：Stream load 的并发数不受集群大小影响。</p>
<ul>
<li><p class="first">step1: 导入文件大小是否超过默认的最大导入大小10G</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">修改</span> <span class="n">BE</span> <span class="n">conf</span>
<span class="n">streaming_load_max_mb</span> <span class="o">=</span> <span class="mi">16000</span>
</pre></div>
</div>
</li>
<li><p class="first">step2: 计算大概的导入时间是否超过默认 timeout 值</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>导入时间 ≈ 15000 / 10 = 1500s
超过了默认的 timeout 时间，需要修改 FE 的配置
stream_load_default_timeout_second = 1500
</pre></div>
</div>
</li>
<li><p class="first">step3：创建导入任务</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">curl</span> <span class="o">--</span><span class="n">location</span><span class="o">-</span><span class="n">trusted</span> <span class="o">-</span><span class="n">u</span> <span class="n">user</span><span class="p">:</span><span class="n">password</span> <span class="o">-</span><span class="n">T</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">store_sales</span> <span class="o">-</span><span class="n">H</span> <span class="s2">&quot;label:abc&quot;</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">abc</span><span class="o">.</span><span class="n">com</span><span class="p">:</span><span class="mi">8000</span><span class="o">/</span><span class="n">api</span><span class="o">/</span><span class="n">bj_sales</span><span class="o">/</span><span class="n">store_sales</span><span class="o">/</span><span class="n">_stream_load</span>
</pre></div>
</div>
</li>
</ul>
</div>
</div>
<div class="section" id="id13">
<h2>常见问题<a class="headerlink" href="#id13" title="Permalink to this headline">¶</a></h2>
<ul>
<li><p class="first">Label Already Exists</p>
<p>Stream load 的 Label 重复排查步骤如下：</p>
<ol>
<li><p class="first">是否和其他导入方式已经存在的导入 Label 冲突：</p>
<p>由于 Doris 系统中导入的 Label 不区分导入方式，所以存在其他导入方式使用了相同 Label 的问题。</p>
<p>通过 <code class="docutils literal notranslate"><span class="pre">SHOW</span> <span class="pre">LOAD</span> <span class="pre">WHERE</span> <span class="pre">LABEL</span> <span class="pre">=</span> <span class="pre">“xxx”</span></code>，其中 xxx 为重复的 Label 字符串，查看是否已经存在一个 FINISHED 导入的 Label 和用户申请创建的 Label 相同。</p>
</li>
<li><p class="first">是否 Stream load 同一个作业被重复提交了</p>
<p>由于 Stream load 是 HTTP 协议提交创建导入任务，一般各个语言的 HTTP Client 均会自带请求重试逻辑。Doris 系统在接受到第一个请求后，已经开始操作 Stream load，但是由于没有及时返回给 Client 端结果， Client 端会发生再次重试创建请求的情况。这时候 Doris 系统由于已经在操作第一个请求，所以第二个请求已经就会被报 Label Already Exists 的情况。</p>
<p>排查上述可能的方法：使用 Label 搜索 FE Master 的日志，看是否存在同一个 Label 出现了两次 <code class="docutils literal notranslate"><span class="pre">redirect</span> <span class="pre">load</span> <span class="pre">action</span> <span class="pre">to</span> <span class="pre">destination=</span> </code> 的情况。如果有就说明，请求被 Client 端重复提交了。</p>
<p>建议用户根据当前请求的数据量，计算出大致导入的时间，并根据导入超时时间改大 Client 端的请求超时时间，避免请求被 Client 端多次提交。</p>
</li>
</ol>
</li>
</ul>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="routine-load-manual.html" class="btn btn-neutral float-right" title="Routine Load" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="broker-load-manual.html" class="btn btn-neutral float-left" title="Broker Load" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, Apache Doris(Incubating)

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>