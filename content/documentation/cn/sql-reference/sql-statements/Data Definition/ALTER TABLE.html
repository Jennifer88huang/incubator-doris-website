

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>ALTER TABLE &mdash; Doris Documentations 0.11.0 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../../../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../../../" src="../../../../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../../../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../../../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../../../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../../../../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../../../../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../../../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../../search.html" />
    <link rel="next" title="ALTER VIEW" href="ALTER VIEW.html" />
    <link rel="prev" title="ALTER DATABASE" href="ALTER DATABASE.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../../../index.html" class="icon icon-home"> Doris Documentations
          

          
          </a>

          
            
            
              <div class="version">
                0.11.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../../../index.html">中文</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../../installing/index.html">编译与部署</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../getting-started/index.html">开始使用</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../administrator-guide/index.html">操作手册</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../extending-doris/index.html">扩展功能</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../internal/index.html">设计文档</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../../index.html">SQL 手册</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../../sql-functions/index.html">SQL 函数</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="../index.html">语法帮助</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="../Account Management/index.html">用户账户管理</a></li>
<li class="toctree-l4"><a class="reference internal" href="../Administration/index.html">集群管理</a></li>
<li class="toctree-l4 current"><a class="reference internal" href="index.html">DDL</a></li>
<li class="toctree-l4"><a class="reference internal" href="../Data Manipulation/index.html">DML</a></li>
<li class="toctree-l4"><a class="reference internal" href="../Data Types/index.html">数据类型</a></li>
<li class="toctree-l4"><a class="reference internal" href="../Utility/index.html">辅助命令</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../developer-guide/index.html">开发者手册</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../community/index.html">Apache 社区</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../../en/index.html">English</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../../index.html">Doris Documentations</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../../../index.html">中文</a> &raquo;</li>
        
          <li><a href="../../index.html">SQL 手册</a> &raquo;</li>
        
          <li><a href="../index.html">语法帮助</a> &raquo;</li>
        
          <li><a href="index.html">DDL</a> &raquo;</li>
        
      <li>ALTER TABLE</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            
              <a href="https://github.com/apache/incubator-doris/blob/master/docs/documentation/cn/sql-reference/sql-statements/Data Definition/ALTER TABLE.md" class="fa fa-github"> Edit on GitHub</a>
            
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <!-- 
Licensed to the Apache Software Foundation (ASF) under one
or more contributor license agreements.  See the NOTICE file
distributed with this work for additional information
regarding copyright ownership.  The ASF licenses this file
to you under the Apache License, Version 2.0 (the
"License"); you may not use this file except in compliance
with the License.  You may obtain a copy of the License at

  http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing,
software distributed under the License is distributed on an
"AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, either express or implied.  See the License for the
specific language governing permissions and limitations
under the License.
--><div class="section" id="alter-table">
<h1>ALTER TABLE<a class="headerlink" href="#alter-table" title="Permalink to this headline">¶</a></h1>
<div class="section" id="description">
<h2>description<a class="headerlink" href="#description" title="Permalink to this headline">¶</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>该语句用于对已有的 table 进行修改。如果没有指定 rollup index，默认操作 base index。
该语句分为三种操作类型： schema change 、rollup 、partition
这三种操作类型不能同时出现在一条 ALTER TABLE 语句中。
其中 schema change 和 rollup 是异步操作，任务提交成功则返回。之后可使用 SHOW ALTER 命令查看进度。
partition 是同步操作，命令返回表示执行完毕。

语法：
    ALTER TABLE [database.]table
    alter_clause1[, alter_clause2, ...];

alter_clause 分为 partition 、rollup、schema change、rename 和index五种。

partition 支持如下几种修改方式
1. 增加分区
    语法：
        ADD PARTITION [IF NOT EXISTS] partition_name 
        partition_desc [&quot;key&quot;=&quot;value&quot;]
        [DISTRIBUTED BY HASH (k1[,k2 ...]) [BUCKETS num]]
    注意：
        1) partition_desc 支持一下两种写法：
            * VALUES LESS THAN [MAXVALUE|(&quot;value1&quot;, ...)]
            * VALUES [(&quot;value1&quot;, ...), (&quot;value1&quot;, ...))
        1) 分区为左闭右开区间，如果用户仅指定右边界，系统会自动确定左边界
        2) 如果没有指定分桶方式，则自动使用建表使用的分桶方式
        3) 如指定分桶方式，只能修改分桶数，不可修改分桶方式或分桶列
        4) [&quot;key&quot;=&quot;value&quot;] 部分可以设置分区的一些属性，具体说明见 CREATE TABLE

2. 删除分区
    语法：
        DROP PARTITION [IF EXISTS] partition_name
    注意：
        1) 使用分区方式的表至少要保留一个分区。
        2) 执行 DROP PARTITION 一段时间内，可以通过 RECOVER 语句恢复被删除的 partition。详见 RECOVER 语句
        
3. 修改分区属性
    语法：
        MODIFY PARTITION partition_name SET (&quot;key&quot; = &quot;value&quot;, ...)
    说明：
        1) 当前支持修改分区的下列属性：
            - storage_medium
            - storage_cooldown_time
            - replication_num 
            — in_memory
        2) 对于单分区表，partition_name 同表名。
    
rollup 支持如下几种创建方式：
1. 创建 rollup index
    语法：
        ADD ROLLUP rollup_name (column_name1, column_name2, ...)
        [FROM from_index_name]
        [PROPERTIES (&quot;key&quot;=&quot;value&quot;, ...)]
    例子：
        ADD ROLLUP r1(col1,col2) from r0
1.2 批量创建 rollup index
    语法：
        ADD ROLLUP [rollup_name (column_name1, column_name2, ...)
                    [FROM from_index_name]
                    [PROPERTIES (&quot;key&quot;=&quot;value&quot;, ...)],...]
    例子：
        ADD ROLLUP r1(col1,col2) from r0, r2(col3,col4) from r0
1.3 注意：
        1) 如果没有指定 from_index_name，则默认从 base index 创建
        2) rollup 表中的列必须是 from_index 中已有的列
        3) 在 properties 中，可以指定存储格式。具体请参阅 CREATE TABLE
        
2. 删除 rollup index
    语法：
        DROP ROLLUP rollup_name [PROPERTIES (&quot;key&quot;=&quot;value&quot;, ...)]
    例子：
        DROP ROLLUP r1
2.1 批量删除 rollup index
    语法：DROP ROLLUP [rollup_name [PROPERTIES (&quot;key&quot;=&quot;value&quot;, ...)],...]
    例子：DROP ROLLUP r1,r2
2.2 注意：
        1) 不能删除 base index
        2) 执行 DROP ROLLUP 一段时间内，可以通过 RECOVER 语句恢复被删除的 rollup index。详见 RECOVER 语句

        
schema change 支持如下几种修改方式：
1. 向指定 index 的指定位置添加一列
    语法：
        ADD COLUMN column_name column_type [KEY | agg_type] [DEFAULT &quot;default_value&quot;]
        [AFTER column_name|FIRST]
        [TO rollup_index_name]
        [PROPERTIES (&quot;key&quot;=&quot;value&quot;, ...)]
    注意：
        1) 聚合模型如果增加 value 列，需要指定 agg_type
        2) 非聚合模型（如 DUPLICATE KEY）如果增加key列，需要指定KEY关键字
        3) 不能在 rollup index 中增加 base index 中已经存在的列
            如有需要，可以重新创建一个 rollup index）
        
2. 向指定 index 添加多列
    语法：
        ADD COLUMN (column_name1 column_type [KEY | agg_type] DEFAULT &quot;default_value&quot;, ...)
        [TO rollup_index_name]
        [PROPERTIES (&quot;key&quot;=&quot;value&quot;, ...)]
    注意：
        1) 聚合模型如果增加 value 列，需要指定agg_type
        2) 非聚合模型如果增加key列，需要指定KEY关键字
        3) 不能在 rollup index 中增加 base index 中已经存在的列
        （如有需要，可以重新创建一个 rollup index）

3. 从指定 index 中删除一列
    语法：
        DROP COLUMN column_name
        [FROM rollup_index_name]
    注意：
        1) 不能删除分区列
        2) 如果是从 base index 中删除列，则如果 rollup index 中包含该列，也会被删除
    
4. 修改指定 index 的列类型以及列位置
    语法：
        MODIFY COLUMN column_name column_type [KEY | agg_type] [NULL | NOT NULL] [DEFAULT &quot;default_value&quot;]
        [AFTER column_name|FIRST]
        [FROM rollup_index_name]
        [PROPERTIES (&quot;key&quot;=&quot;value&quot;, ...)]
    注意：
        1) 聚合模型如果修改 value 列，需要指定 agg_type
        2) 非聚合类型如果修改key列，需要指定KEY关键字
        3) 只能修改列的类型，列的其他属性维持原样（即其他属性需在语句中按照原属性显式的写出，参见 example 8）
        4) 分区列不能做任何修改
        5) 目前支持以下类型的转换（精度损失由用户保证）
            TINYINT/SMALLINT/INT/BIGINT 转换成 TINYINT/SMALLINT/INT/BIGINT/DOUBLE。
            TINTINT/SMALLINT/INT/BIGINT/LARGEINT/FLOAT/DOUBLE/DECIMAL 转换成 VARCHAR
            LARGEINT 转换成 DOUBLE
            VARCHAR 支持修改最大长度
            VARCHAR 转换成 TINTINT/SMALLINT/INT/BIGINT/LARGEINT/FLOAT/DOUBLE
            VARCHAR 转换成 DATE (目前支持&quot;%Y-%m-%d&quot;, &quot;%y-%m-%d&quot;, &quot;%Y%m%d&quot;, &quot;%y%m%d&quot;, &quot;%Y/%m/%d, &quot;%y/%m/%d&quot;六种格式化格式)
            DATETIME 转换成 DATE(仅保留年-月-日信息, 例如: `2019-12-09 21:47:05` &lt;--&gt; `2019-12-09`)
            DATE 转换成 DATETIME(时分秒自动补零， 例如: `2019-12-09` &lt;--&gt; `2019-12-09 00:00:00`)
            FLOAT 转换成 DOUBLE
            INT 转换成 DATE (如果INT类型数据不合法则转换失败，原始数据不变)
        6) 不支持从NULL转为NOT NULL
            
5. 对指定 index 的列进行重新排序
    语法：
        ORDER BY (column_name1, column_name2, ...)
        [FROM rollup_index_name]
        [PROPERTIES (&quot;key&quot;=&quot;value&quot;, ...)]
    注意：
        1) index 中的所有列都要写出来
        2) value 列在 key 列之后
        
6. 修改table的属性，目前支持修改bloom filter列, colocate_with 属性和dynamic_partition属性
    语法：
        PROPERTIES (&quot;key&quot;=&quot;value&quot;)
    注意：
        也可以合并到上面的schema change操作中来修改，见下面例子
 

rename 支持对以下名称进行修改：
1. 修改表名
    语法：
        RENAME new_table_name;
        
2. 修改 rollup index 名称
    语法：
        RENAME ROLLUP old_rollup_name new_rollup_name;
        
3. 修改 partition 名称
    语法：
        RENAME PARTITION old_partition_name new_partition_name;
bitmap index 支持如下几种修改方式
1. 创建bitmap 索引
    语法：
        ADD INDEX index_name (column [, ...],) [USING BITMAP] [COMMENT &#39;balabala&#39;];
    注意：
        1. 目前仅支持bitmap 索引
        1. BITMAP 索引仅在单列上创建
2. 删除索引
    语法：
        DROP INDEX index_name；
</pre></div>
</div>
</div>
<div class="section" id="example">
<h2>example<a class="headerlink" href="#example" title="Permalink to this headline">¶</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>[partition]
1. 增加分区, 现有分区 [MIN, 2013-01-01)，增加分区 [2013-01-01, 2014-01-01)，使用默认分桶方式
    ALTER TABLE example_db.my_table
    ADD PARTITION p1 VALUES LESS THAN (&quot;2014-01-01&quot;);

2. 增加分区，使用新的分桶数
    ALTER TABLE example_db.my_table
    ADD PARTITION p1 VALUES LESS THAN (&quot;2015-01-01&quot;)
    DISTRIBUTED BY HASH(k1) BUCKETS 20;

3. 增加分区，使用新的副本数
    ALTER TABLE example_db.my_table
    ADD PARTITION p1 VALUES LESS THAN (&quot;2015-01-01&quot;)
    (&quot;replication_num&quot;=&quot;1&quot;);

4. 修改分区副本数
    ALTER TABLE example_db.my_table
    MODIFY PARTITION p1 SET(&quot;replication_num&quot;=&quot;1&quot;);

5. 删除分区
    ALTER TABLE example_db.my_table
    DROP PARTITION p1;
    
6. 增加一个指定上下界的分区

    ALTER TABLE example_db.my_table
    ADD PARTITION p1 VALUES [(&quot;2014-01-01&quot;), (&quot;2014-02-01&quot;));

[rollup]
1. 创建 index: example_rollup_index，基于 base index（k1,k2,k3,v1,v2）。列式存储。
    ALTER TABLE example_db.my_table
    ADD ROLLUP example_rollup_index(k1, k3, v1, v2)
    PROPERTIES(&quot;storage_type&quot;=&quot;column&quot;);
    
2. 创建 index: example_rollup_index2，基于 example_rollup_index（k1,k3,v1,v2）
    ALTER TABLE example_db.my_table
    ADD ROLLUP example_rollup_index2 (k1, v1)
    FROM example_rollup_index;

3. 删除 index: example_rollup_index2
    ALTER TABLE example_db.my_table
    DROP ROLLUP example_rollup_index2;

[schema change]
1. 向 example_rollup_index 的 col1 后添加一个key列 new_col(非聚合模型)
    ALTER TABLE example_db.my_table
    ADD COLUMN new_col INT KEY DEFAULT &quot;0&quot; AFTER col1
    TO example_rollup_index;

2. 向example_rollup_index的col1后添加一个value列new_col(非聚合模型)
      ALTER TABLE example_db.my_table   
      ADD COLUMN new_col INT DEFAULT &quot;0&quot; AFTER col1    
      TO example_rollup_index;

3. 向example_rollup_index的col1后添加一个key列new_col(聚合模型)
      ALTER TABLE example_db.my_table   
      ADD COLUMN new_col INT DEFAULT &quot;0&quot; AFTER col1    
      TO example_rollup_index;

4. 向example_rollup_index的col1后添加一个value列new_col SUM聚合类型(聚合模型)
      ALTER TABLE example_db.my_table   
      ADD COLUMN new_col INT SUM DEFAULT &quot;0&quot; AFTER col1    
      TO example_rollup_index;

5. 向 example_rollup_index 添加多列(聚合模型)
    ALTER TABLE example_db.my_table
    ADD COLUMN (col1 INT DEFAULT &quot;1&quot;, col2 FLOAT SUM DEFAULT &quot;2.3&quot;)
    TO example_rollup_index;

6. 从 example_rollup_index 删除一列
    ALTER TABLE example_db.my_table
    DROP COLUMN col2
    FROM example_rollup_index;
    
7. 修改 base index 的 col1 列的类型为 BIGINT，并移动到 col2 列后面
    ALTER TABLE example_db.my_table
    MODIFY COLUMN col1 BIGINT DEFAULT &quot;1&quot; AFTER col2;

8. 修改 base index 的 val1 列最大长度。原 val1 为 (val1 VARCHAR(32) REPLACE DEFAULT &quot;abc&quot;)
    ALTER TABLE example_db.my_table
    MODIFY COLUMN val1 VARCHAR(64) REPLACE DEFAULT &quot;abc&quot;;

9. 重新排序 example_rollup_index 中的列（设原列顺序为：k1,k2,k3,v1,v2）
    ALTER TABLE example_db.my_table
    ORDER BY (k3,k1,k2,v2,v1)
    FROM example_rollup_index;
    
10. 同时执行两种操作
    ALTER TABLE example_db.my_table
    ADD COLUMN v2 INT MAX DEFAULT &quot;0&quot; AFTER k2 TO example_rollup_index,
    ORDER BY (k3,k1,k2,v2,v1) FROM example_rollup_index;

11. 修改表的 bloom filter 列
    ALTER TABLE example_db.my_table SET (&quot;bloom_filter_columns&quot;=&quot;k1,k2,k3&quot;);

    也可以合并到上面的 schema change 操作中（注意多子句的语法有少许区别）
    ALTER TABLE example_db.my_table
    DROP COLUMN col2
    PROPERTIES (&quot;bloom_filter_columns&quot;=&quot;k1,k2,k3&quot;);

12. 修改表的Colocate 属性

    ALTER TABLE example_db.my_table set (&quot;colocate_with&quot; = &quot;t1&quot;);

13. 将表的分桶方式由 Random Distribution 改为 Hash Distribution

    ALTER TABLE example_db.my_table set (&quot;distribution_type&quot; = &quot;hash&quot;);

14. 修改表的动态分区属性(支持未添加动态分区属性的表添加动态分区属性)
    ALTER TABLE example_db.my_table set (&quot;dynamic_partition_enable&quot; = &quot;false&quot;);
    
    如果需要在未添加动态分区属性的表中添加动态分区属性，则需要指定所有的动态分区属性
    ALTER TABLE example_db.my_table set (&quot;dynamic_partition.enable&quot; = &quot;true&quot;, dynamic_partition.time_unit&quot; = &quot;DAY&quot;, &quot;dynamic_partition.end&quot; = &quot;3&quot;, &quot;dynamic_partition.prefix&quot; = &quot;p&quot;, &quot;dynamic_partition.buckets&quot; = &quot;32&quot;);
15. 修改表的 in_memory 属性

    ALTER TABLE example_db.my_table set (&quot;in_memory&quot; = &quot;true&quot;);
    
    
[rename]
1. 将名为 table1 的表修改为 table2
    ALTER TABLE table1 RENAME table2;
    
2. 将表 example_table 中名为 rollup1 的 rollup index 修改为 rollup2
    ALTER TABLE example_table RENAME ROLLUP rollup1 rollup2;
    
3. 将表 example_table 中名为 p1 的 partition 修改为 p2
    ALTER TABLE example_table RENAME PARTITION p1 p2;
[index]
1. 在table1 上为siteid 创建bitmap 索引
    ALTER TABLE table1 ADD INDEX index_name (siteid) [USING BITMAP] COMMENT &#39;balabala&#39;;
2. 删除table1 上的siteid列的bitmap 索引
    ALTER TABLE table1 DROP INDEX index_name;
</pre></div>
</div>
</div>
<div class="section" id="keyword">
<h2>keyword<a class="headerlink" href="#keyword" title="Permalink to this headline">¶</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ALTER</span><span class="p">,</span><span class="n">TABLE</span><span class="p">,</span><span class="n">ROLLUP</span><span class="p">,</span><span class="n">COLUMN</span><span class="p">,</span><span class="n">PARTITION</span><span class="p">,</span><span class="n">RENAME</span>
</pre></div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="ALTER VIEW.html" class="btn btn-neutral float-right" title="ALTER VIEW" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="ALTER DATABASE.html" class="btn btn-neutral float-left" title="ALTER DATABASE" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, Apache Doris(Incubating)

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
<div role="contentinfo">
    <p></p>
    <p>

        Apache Doris(incubating) is an effort undergoing incubation at The Apache Software Foundation (ASF), sponsored by the Apache Incubator. Incubation is required of all newly accepted projects until a further review indicates that the infrastructure, communications, and decision making process have stabilized in a manner consistent with other successful ASF projects. While incubation status is not necessarily a reflection of the completeness or stability of the code, it does indicate that the project has yet to be fully endorsed by the ASF.

    </p>
</div>


</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>