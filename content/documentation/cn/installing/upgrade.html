

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>集群升级 &mdash; Doris Documentations 0.11.0 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="开始使用" href="../getting-started/index.html" />
    <link rel="prev" title="安装与部署" href="install-deploy.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../index.html" class="icon icon-home"> Doris Documentations
          

          
          </a>

          
            
            
              <div class="version">
                0.11.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">中文</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../downloads/index.html">下载</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html">编译与部署</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="compilation.html">编译</a></li>
<li class="toctree-l3"><a class="reference internal" href="install-deploy.html">安装与部署</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">集群升级</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#be">测试 BE 升级正确性</a></li>
<li class="toctree-l4"><a class="reference internal" href="#fe">测试 FE 元数据兼容性</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id2">升级准备</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id3">滚动升级</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../getting-started/index.html">开始使用</a></li>
<li class="toctree-l2"><a class="reference internal" href="../administrator-guide/index.html">操作手册</a></li>
<li class="toctree-l2"><a class="reference internal" href="../extending-doris/index.html">扩展功能</a></li>
<li class="toctree-l2"><a class="reference internal" href="../internal/index.html">设计文档</a></li>
<li class="toctree-l2"><a class="reference internal" href="../sql-reference/index.html">SQL 手册</a></li>
<li class="toctree-l2"><a class="reference internal" href="../developer-guide/index.html">开发者手册</a></li>
<li class="toctree-l2"><a class="reference internal" href="../community/index.html">Apache 社区</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../en/index.html">English</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">Doris Documentations</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../index.html">中文</a> &raquo;</li>
        
          <li><a href="index.html">编译与部署</a> &raquo;</li>
        
      <li>集群升级</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            
              <a href="https://github.com/apache/incubator-doris/blob/master/docs/documentation/cn/installing/upgrade.md" class="fa fa-github"> Edit on GitHub</a>
            
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <!-- 
Licensed to the Apache Software Foundation (ASF) under one
or more contributor license agreements.  See the NOTICE file
distributed with this work for additional information
regarding copyright ownership.  The ASF licenses this file
to you under the Apache License, Version 2.0 (the
"License"); you may not use this file except in compliance
with the License.  You may obtain a copy of the License at

  http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing,
software distributed under the License is distributed on an
"AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, either express or implied.  See the License for the
specific language governing permissions and limitations
under the License.
--><div class="section" id="id1">
<h1>集群升级<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h1>
<p>Doris 可以通过滚动升级的方式，平滑进行升级。建议按照以下步骤进行安全升级。</p>
<blockquote>
<div><p>注：</p>
<ol class="simple">
<li>以下方式均建立在高可用部署的情况下。即数据 3 副本，FE 高可用情况下。</li>
</ol>
</div></blockquote>
<div class="section" id="be">
<h2>测试 BE 升级正确性<a class="headerlink" href="#be" title="Permalink to this headline">¶</a></h2>
<ol class="simple">
<li>任意选择一个 BE 节点，部署最新的 palo_be 二进制文件。</li>
<li>重启 BE 节点，通过 BE 日志 be.INFO，查看是否启动成功。</li>
<li>如果启动失败，可以先排查原因。如果错误不可恢复，可以直接通过 DROP BACKEND 删除该 BE、清理数据后，使用上一个版本的 palo_be 重新启动 BE。然后重新 ADD BACKEND。（<strong>该方法会导致丢失一个数据副本，请务必确保3副本完整的情况下，执行这个操作！！！</strong>）</li>
</ol>
</div>
<div class="section" id="fe">
<h2>测试 FE 元数据兼容性<a class="headerlink" href="#fe" title="Permalink to this headline">¶</a></h2>
<ol class="simple">
<li><strong>重要！!元数据兼容性异常很可能导致数据无法恢复！！</strong></li>
<li>单独使用新版本部署一个测试用的 FE 进程（比如自己本地的开发机）。</li>
<li>修改测试用的 FE 的配置文件 fe.conf，将所有端口设置为<strong>与线上不同</strong>。</li>
<li>在 fe.conf 添加配置：cluster_id=123456</li>
<li>在 fe.conf 添加配置：metadata_failure_recovery=true</li>
<li>拷贝线上环境 Master FE 的元数据目录 palo-meta 到测试环境</li>
<li>将拷贝到测试环境中的 palo-meta/image/VERSION 文件中的 cluster_id 修改为 123456（即与第3步中相同）</li>
<li>在测试环境中，运行 sh bin/start_fe.sh 启动 FE</li>
<li>通过 FE 日志 fe.log 观察是否启动成功。</li>
<li>如果启动成功，运行 sh bin/stop_fe.sh 停止测试环境的 FE 进程。</li>
<li><strong>以上 2-6 步的目的是防止测试环境的FE启动后，错误连接到线上环境中。</strong></li>
</ol>
</div>
<div class="section" id="id2">
<h2>升级准备<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h2>
<ol class="simple">
<li>在完成数据正确性验证后，将 BE 和 FE 新版本的二进制文件分发到各自目录下。</li>
<li>通常小版本升级，BE 只需升级 palo_be；而 FE 只需升级 palo-fe.jar。如果是大版本升级，则可能需要升级其他文件（包括但不限于 bin/ lib/ 等等）如果你不清楚是否需要替换其他文件，建议全部替换。</li>
</ol>
</div>
<div class="section" id="id3">
<h2>滚动升级<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h2>
<ol class="simple">
<li>确认新版本的文件部署完成后。逐台重启 FE 和 BE 实例即可。</li>
<li>建议逐台重启 BE 后，再逐台重启 FE。因为通常 Doris 保证 FE 到 BE 的向后兼容性，即老版本的 FE 可以访问新版本的 BE。但可能不支持老版本的 BE 访问新版本的 FE。</li>
<li>建议确认前一个实例启动成功后，在重启下一个实例。实例启动成功的标识，请参阅安装部署文档。</li>
</ol>
</div>
</div>


           </div>
           
          </div>
          <!--
Licensed to the Apache Software Foundation (ASF) under one
or more contributor license agreements.  See the NOTICE file
distributed with this work for additional information
regarding copyright ownership.  The ASF licenses this file
to you under the Apache License, Version 2.0 (the
"License"); you may not use this file except in compliance
with the License.  You may obtain a copy of the License at
  http://www.apache.org/licenses/LICENSE-2.0
Unless required by applicable law or agreed to in writing,
software distributed under the License is distributed on an
"AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, either express or implied.  See the License for the
specific language governing permissions and limitations
under the License.
-->

<footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../getting-started/index.html" class="btn btn-neutral float-right" title="开始使用" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="install-deploy.html" class="btn btn-neutral float-left" title="安装与部署" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, Apache Doris(Incubating)

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
<div role="contentinfo">
    <p></p>
    <p>

        Apache Doris(incubating) is an effort undergoing incubation at The Apache Software Foundation (ASF), sponsored by the Apache Incubator. Incubation is required of all newly accepted projects until a further review indicates that the infrastructure, communications, and decision making process have stabilized in a manner consistent with other successful ASF projects. While incubation status is not necessarily a reflection of the completeness or stability of the code, it does indicate that the project has yet to be fully endorsed by the ASF.

    </p>
</div>


</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>