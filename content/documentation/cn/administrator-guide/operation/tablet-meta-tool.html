

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Tablet 元数据管理工具 &mdash; Doris Documentations 0.11.0 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../../" src="../../../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../../../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../../../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" />
    <link rel="next" title="数据副本管理" href="tablet-repair-and-balance.html" />
    <link rel="prev" title="多租户(Experimental)" href="multi-tenant.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../../index.html" class="icon icon-home"> Doris Documentations
          

          
          </a>

          
            
            
              <div class="version">
                0.11.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../../index.html">中文</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../downloads/index.html">下载</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../installing/index.html">编译与部署</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../getting-started/index.html">开始使用</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../index.html">操作手册</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../load-data/index.html">数据导入</a></li>
<li class="toctree-l3"><a class="reference internal" href="../alter-table/index.html">表结构变更</a></li>
<li class="toctree-l3"><a class="reference internal" href="../materialized-view/index.html">物化视图</a></li>
<li class="toctree-l3"><a class="reference internal" href="../http-actions/index.html">HTTP API</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="index.html">运维操作</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="disk-capacity.html">磁盘空间管理</a></li>
<li class="toctree-l4"><a class="reference internal" href="metadata-operation.html">元数据运维</a></li>
<li class="toctree-l4"><a class="reference internal" href="monitor-alert.html">监控和报警</a></li>
<li class="toctree-l4"><a class="reference internal" href="multi-tenant.html">多租户(Experimental)</a></li>
<li class="toctree-l4 current"><a class="current reference internal" href="#">Tablet 元数据管理工具</a></li>
<li class="toctree-l4"><a class="reference internal" href="tablet-repair-and-balance.html">数据副本管理</a></li>
<li class="toctree-l4"><a class="reference internal" href="tablet-restore-tool.html">BE Tablet数据恢复工具</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../config/index.html">配置文件</a></li>
<li class="toctree-l3"><a class="reference internal" href="../backup-restore.html">备份与恢复</a></li>
<li class="toctree-l3"><a class="reference internal" href="../broker.html">Broker</a></li>
<li class="toctree-l3"><a class="reference internal" href="../colocation-join.html">Colocation Join</a></li>
<li class="toctree-l3"><a class="reference internal" href="../dynamic-partition.html">动态分区</a></li>
<li class="toctree-l3"><a class="reference internal" href="../export-manual.html">数据导出</a></li>
<li class="toctree-l3"><a class="reference internal" href="../privilege.html">权限管理</a></li>
<li class="toctree-l3"><a class="reference internal" href="../segment-v2-usage.html">Segment V2 升级手册</a></li>
<li class="toctree-l3"><a class="reference internal" href="../small-file-mgr.html">文件管理器</a></li>
<li class="toctree-l3"><a class="reference internal" href="../sql-mode.html">SQL MODE</a></li>
<li class="toctree-l3"><a class="reference internal" href="../time-zone.html">时区</a></li>
<li class="toctree-l3"><a class="reference internal" href="../variables.html">变量</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../extending-doris/index.html">扩展功能</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../internal/index.html">设计文档</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../sql-reference/index.html">SQL 手册</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../developer-guide/index.html">开发者手册</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../community/index.html">Apache 社区</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../en/index.html">English</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../index.html">Doris Documentations</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../../index.html">中文</a> &raquo;</li>
        
          <li><a href="../index.html">操作手册</a> &raquo;</li>
        
          <li><a href="index.html">运维操作</a> &raquo;</li>
        
      <li>Tablet 元数据管理工具</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            
              <a href="https://github.com/apache/incubator-doris/blob/master/docs/documentation/cn/administrator-guide/operation/tablet-meta-tool.md" class="fa fa-github"> Edit on GitHub</a>
            
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <!-- 
Licensed to the Apache Software Foundation (ASF) under one
or more contributor license agreements.  See the NOTICE file
distributed with this work for additional information
regarding copyright ownership.  The ASF licenses this file
to you under the Apache License, Version 2.0 (the
"License"); you may not use this file except in compliance
with the License.  You may obtain a copy of the License at

  http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing,
software distributed under the License is distributed on an
"AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, either express or implied.  See the License for the
specific language governing permissions and limitations
under the License.
--><div class="section" id="tablet">
<h1>Tablet 元数据管理工具<a class="headerlink" href="#tablet" title="Permalink to this headline">¶</a></h1>
<div class="section" id="id1">
<h2>背景<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h2>
<p>在最新版本的代码中，我们在 BE 端引入了 RocksDB，用于存储 tablet 的元信息，以解决之前通过 header 文件的方式存储元信息，带来的各种功能和性能方面的问题。当前每一个数据目录（root_path），都会有一个对应的 RocksDB 实例，其中以 key-value 的方式，存放对应 root_path 上的所有 tablet 的元数据。</p>
<p>为了方便进行这些元数据的维护，我们提供了在线的 http 接口方式和离线的 meta_tool 工具以完成相关的管理操作。</p>
<p>其中 http 接口仅用于在线的查看 tablet 的元数据，可以在 BE 进程运行的状态下使用。</p>
<p>而 meta_tool 工具则仅用于离线的各类元数据管理操作，必须先停止BE进程后，才可使用。</p>
<p>meta_tool 工具存放在 BE 的 lib/ 目录下。</p>
</div>
<div class="section" id="id2">
<h2>操作<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h2>
<div class="section" id="tablet-meta">
<h3>查看 Tablet Meta<a class="headerlink" href="#tablet-meta" title="Permalink to this headline">¶</a></h3>
<p>查看 Tablet Meta 信息可以分为在线方法和离线方法</p>
<div class="section" id="id3">
<h4>在线<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h4>
<p>访问 BE 的 http 接口，获取对应的 Tablet Meta 信息：</p>
<p>api：</p>
<p><code class="docutils literal notranslate"><span class="pre">http://{host}:{port}/api/meta/header/{tablet_id}/{schema_hash}</span></code></p>
<blockquote>
<div><p>host: BE 的 hostname</p>
<p>port: BE 的 http 端口</p>
<p>tablet_id: tablet id</p>
<p>schema_hash: tablet 的 schema hash</p>
</div></blockquote>
<p>举例：</p>
<p><code class="docutils literal notranslate"><span class="pre">http://be_host:8040/api/meta/header/14156/2458238340</span></code></p>
<p>最终查询成功的话，会将 Tablet Meta 以 json 形式返回。</p>
</div>
<div class="section" id="id4">
<h4>离线<a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h4>
<p>基于 meta_tool 工具获取某个盘上的 Tablet Meta。</p>
<p>命令：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">./</span><span class="n">lib</span><span class="o">/</span><span class="n">meta_tool</span> <span class="o">--</span><span class="n">root_path</span><span class="o">=/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">root_path</span> <span class="o">--</span><span class="n">operation</span><span class="o">=</span><span class="n">get_meta</span> <span class="o">--</span><span class="n">tablet_id</span><span class="o">=</span><span class="n">xxx</span> <span class="o">--</span><span class="n">schema_hash</span><span class="o">=</span><span class="n">xxx</span>
</pre></div>
</div>
<blockquote>
<div>root_path: 在 be.conf 中配置的对应的 root_path 路径。</div></blockquote>
<p>结果也是按照 json 的格式展现 Tablet Meta。</p>
</div>
</div>
<div class="section" id="header">
<h3>加载 header<a class="headerlink" href="#header" title="Permalink to this headline">¶</a></h3>
<p>加载 header 的功能是为了完成实现 tablet 人工迁移而提供的。该功能是基于 json 格式的 Tablet Meta 实现的，所以如果涉及 shard 字段、version 信息的更改，可以直接在 Tablet Meta 的 json 内容中更改。然后使用以下的命令进行加载。</p>
<p>命令：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">./</span><span class="n">lib</span><span class="o">/</span><span class="n">meta_tool</span> <span class="o">--</span><span class="n">operation</span><span class="o">=</span><span class="n">load_meta</span> <span class="o">--</span><span class="n">root_path</span><span class="o">=/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">root_path</span> <span class="o">--</span><span class="n">json_header_path</span><span class="o">=</span><span class="n">path</span>
</pre></div>
</div>
</div>
<div class="section" id="id5">
<h3>删除 header<a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h3>
<p>为了实现从某个 be 的某个盘中删除某个 tablet 的功能。</p>
<p>命令:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">./</span><span class="n">lib</span><span class="o">/</span><span class="n">meta_tool</span> <span class="o">--</span><span class="n">operation</span><span class="o">=</span><span class="n">delete_meta</span> <span class="o">--</span><span class="n">root_path</span><span class="o">=/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">root_path</span> <span class="o">--</span><span class="n">tablet_id</span><span class="o">=</span><span class="n">xxx</span> <span class="o">--</span><span class="n">schema_hash</span><span class="o">=</span><span class="n">xxx</span>
</pre></div>
</div>
</div>
<div class="section" id="pb-tabletmeta">
<h3>展示 pb 格式的 TabletMeta<a class="headerlink" href="#pb-tabletmeta" title="Permalink to this headline">¶</a></h3>
<p>这个命令是为了查看旧的基于文件的管理的PB格式的 Tablet Meta，以 json 的格式展示 Tablet Meta。</p>
<p>命令：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">./</span><span class="n">lib</span><span class="o">/</span><span class="n">meta_tool</span> <span class="o">--</span><span class="n">operation</span><span class="o">=</span><span class="n">show_meta</span> <span class="o">--</span><span class="n">root_path</span><span class="o">=/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">root_path</span> <span class="o">--</span><span class="n">pb_header_path</span><span class="o">=</span><span class="n">path</span>
</pre></div>
</div>
</div>
</div>
</div>


           </div>
           
          </div>
          <!--
Licensed to the Apache Software Foundation (ASF) under one
or more contributor license agreements.  See the NOTICE file
distributed with this work for additional information
regarding copyright ownership.  The ASF licenses this file
to you under the Apache License, Version 2.0 (the
"License"); you may not use this file except in compliance
with the License.  You may obtain a copy of the License at
  http://www.apache.org/licenses/LICENSE-2.0
Unless required by applicable law or agreed to in writing,
software distributed under the License is distributed on an
"AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, either express or implied.  See the License for the
specific language governing permissions and limitations
under the License.
-->

<footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="tablet-repair-and-balance.html" class="btn btn-neutral float-right" title="数据副本管理" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="multi-tenant.html" class="btn btn-neutral float-left" title="多租户(Experimental)" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, Apache Doris(Incubating)

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
<div role="contentinfo">
    <p></p>
    <p>

        Apache Doris(incubating) is an effort undergoing incubation at The Apache Software Foundation (ASF), sponsored by the Apache Incubator. Incubation is required of all newly accepted projects until a further review indicates that the infrastructure, communications, and decision making process have stabilized in a manner consistent with other successful ASF projects. While incubation status is not necessarily a reflection of the completeness or stability of the code, it does indicate that the project has yet to be fully endorsed by the ASF.

    </p>
</div>


</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>