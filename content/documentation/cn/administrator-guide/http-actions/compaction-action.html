

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Compaction Action &mdash; Doris Documentations 0.11.0 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../../" src="../../../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../../../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../../../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" />
    <link rel="next" title="get_log_file" href="fe-get-log-file.html" />
    <link rel="prev" title="CANCEL LABEL" href="cancel-label.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../../index.html" class="icon icon-home"> Doris Documentations
          

          
          </a>

          
            
            
              <div class="version">
                0.11.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../../index.html">中文</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../downloads/index.html">下载</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../installing/index.html">编译与部署</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../getting-started/index.html">开始使用</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../index.html">操作手册</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../load-data/index.html">数据导入</a></li>
<li class="toctree-l3"><a class="reference internal" href="../alter-table/index.html">表结构变更</a></li>
<li class="toctree-l3"><a class="reference internal" href="../materialized-view/index.html">物化视图</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="index.html">HTTP API</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="cancel-label.html">CANCEL LABEL</a></li>
<li class="toctree-l4 current"><a class="current reference internal" href="#">Compaction Action</a></li>
<li class="toctree-l4"><a class="reference internal" href="fe-get-log-file.html">get_log_file</a></li>
<li class="toctree-l4"><a class="reference internal" href="get-label-state.html">GET LABEL STATE</a></li>
<li class="toctree-l4"><a class="reference internal" href="restore-tablet.html">RESTORE TABLET</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../operation/index.html">运维操作</a></li>
<li class="toctree-l3"><a class="reference internal" href="../config/index.html">配置文件</a></li>
<li class="toctree-l3"><a class="reference internal" href="../backup-restore.html">备份与恢复</a></li>
<li class="toctree-l3"><a class="reference internal" href="../broker.html">Broker</a></li>
<li class="toctree-l3"><a class="reference internal" href="../colocation-join.html">Colocation Join</a></li>
<li class="toctree-l3"><a class="reference internal" href="../dynamic-partition.html">动态分区</a></li>
<li class="toctree-l3"><a class="reference internal" href="../export-manual.html">数据导出</a></li>
<li class="toctree-l3"><a class="reference internal" href="../privilege.html">权限管理</a></li>
<li class="toctree-l3"><a class="reference internal" href="../segment-v2-usage.html">Segment V2 升级手册</a></li>
<li class="toctree-l3"><a class="reference internal" href="../small-file-mgr.html">文件管理器</a></li>
<li class="toctree-l3"><a class="reference internal" href="../sql-mode.html">SQL MODE</a></li>
<li class="toctree-l3"><a class="reference internal" href="../time-zone.html">时区</a></li>
<li class="toctree-l3"><a class="reference internal" href="../variables.html">变量</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../extending-doris/index.html">扩展功能</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../internal/index.html">设计文档</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../sql-reference/index.html">SQL 手册</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../developer-guide/index.html">开发者手册</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../community/index.html">Apache 社区</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../en/index.html">English</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../index.html">Doris Documentations</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../../index.html">中文</a> &raquo;</li>
        
          <li><a href="../index.html">操作手册</a> &raquo;</li>
        
          <li><a href="index.html">HTTP API</a> &raquo;</li>
        
      <li>Compaction Action</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            
              <a href="https://github.com/apache/incubator-doris/blob/master/docs/documentation/cn/administrator-guide/http-actions/compaction-action.md" class="fa fa-github"> Edit on GitHub</a>
            
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <!-- 
Licensed to the Apache Software Foundation (ASF) under one
or more contributor license agreements.  See the NOTICE file
distributed with this work for additional information
regarding copyright ownership.  The ASF licenses this file
to you under the Apache License, Version 2.0 (the
"License"); you may not use this file except in compliance
with the License.  You may obtain a copy of the License at

  http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing,
software distributed under the License is distributed on an
"AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, either express or implied.  See the License for the
specific language governing permissions and limitations
under the License.
--><div class="section" id="compaction-action">
<h1>Compaction Action<a class="headerlink" href="#compaction-action" title="Permalink to this headline">¶</a></h1>
<p>该 API 用于查看某个 BE 节点总体的 compaction 状态，或者指定 tablet 的 compaction 状态。也可以用于手动触发 Compaction。</p>
<div class="section" id="compaction">
<h2>查看 Compaction 状态<a class="headerlink" href="#compaction" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id1">
<h3>节点整体 compaction 状态<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h3>
<p>(TODO)</p>
</div>
<div class="section" id="tablet-compaction">
<h3>指定 tablet 的 compaction 状态<a class="headerlink" href="#tablet-compaction" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>curl -X GET http://be_host:webserver_port/api/compaction/show?tablet_id=xxxx\&amp;schema_hash=yyyy
</pre></div>
</div>
<p>若 tablet 不存在，返回 JSON 格式的错误：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;Fail&quot;</span><span class="p">,</span>
    <span class="s2">&quot;msg&quot;</span><span class="p">:</span> <span class="s2">&quot;Tablet not found&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>若 tablet 存在，则返回 JSON 格式的结果:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="s2">&quot;cumulative point&quot;</span><span class="p">:</span> <span class="mi">50</span><span class="p">,</span>
    <span class="s2">&quot;last cumulative failure time&quot;</span><span class="p">:</span> <span class="s2">&quot;2019-12-16 18:13:43.224&quot;</span><span class="p">,</span>
    <span class="s2">&quot;last base failure time&quot;</span><span class="p">:</span> <span class="s2">&quot;2019-12-16 18:13:23.320&quot;</span><span class="p">,</span>
    <span class="s2">&quot;last cumu success time&quot;</span><span class="p">:</span> <span class="s2">&quot;2019-12-16 18:12:15.110&quot;</span><span class="p">,</span>
    <span class="s2">&quot;last base success time&quot;</span><span class="p">:</span> <span class="s2">&quot;2019-12-16 18:11:50.780&quot;</span><span class="p">,</span>
    <span class="s2">&quot;rowsets&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="s2">&quot;[0-48] 10 DATA OVERLAPPING&quot;</span><span class="p">,</span>
        <span class="s2">&quot;[49-49] 2 DATA OVERLAPPING&quot;</span><span class="p">,</span>
        <span class="s2">&quot;[50-50] 0 DELETE NONOVERLAPPING&quot;</span><span class="p">,</span>
        <span class="s2">&quot;[51-51] 5 DATA OVERLAPPING&quot;</span>
    <span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
<p>结果说明：</p>
<ul class="simple">
<li>cumulative point：base 和 cumulative compaction 的版本分界线。在 point（不含）之前的版本由 base compaction 处理。point（含）之后的版本由 cumulative compaction 处理。</li>
<li>last cumulative failure time：上一次尝试 cumulative compaction 失败的时间。默认 10min 后才会再次尝试对该 tablet 做 cumulative compaction。</li>
<li>last base failure time：上一次尝试 base compaction 失败的时间。默认 10min 后才会再次尝试对该 tablet 做 base compaction。</li>
<li>rowsets：该 tablet 当前的 rowset 集合。如 [0-48] 表示 0-48 版本。第二位数字表示该版本中 segment 的数量。<code class="docutils literal notranslate"><span class="pre">DELETE</span></code> 表示 delete 版本。<code class="docutils literal notranslate"><span class="pre">DATA</span></code> 表示数据版本。<code class="docutils literal notranslate"><span class="pre">OVERLAPPING</span></code> 和 <code class="docutils literal notranslate"><span class="pre">NONOVERLAPPING</span></code> 表示segment数据是否重叠。</li>
</ul>
</div>
<div class="section" id="id2">
<h3>示例<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>curl -X GET http://192.168.10.24:8040/api/compaction/show?tablet_id=10015\&amp;schema_hash=1294206575
</pre></div>
</div>
</div>
</div>
<div class="section" id="id3">
<h2>手动触发 Compaction<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h2>
<p>(TODO)</p>
</div>
</div>


           </div>
           
          </div>
          <!--
Licensed to the Apache Software Foundation (ASF) under one
or more contributor license agreements.  See the NOTICE file
distributed with this work for additional information
regarding copyright ownership.  The ASF licenses this file
to you under the Apache License, Version 2.0 (the
"License"); you may not use this file except in compliance
with the License.  You may obtain a copy of the License at
  http://www.apache.org/licenses/LICENSE-2.0
Unless required by applicable law or agreed to in writing,
software distributed under the License is distributed on an
"AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, either express or implied.  See the License for the
specific language governing permissions and limitations
under the License.
-->

<footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="fe-get-log-file.html" class="btn btn-neutral float-right" title="get_log_file" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="cancel-label.html" class="btn btn-neutral float-left" title="CANCEL LABEL" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, Apache Doris(Incubating)

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
<div role="contentinfo">
    <p></p>
    <p>

        Apache Doris(incubating) is an effort undergoing incubation at The Apache Software Foundation (ASF), sponsored by the Apache Incubator. Incubation is required of all newly accepted projects until a further review indicates that the infrastructure, communications, and decision making process have stabilized in a manner consistent with other successful ASF projects. While incubation status is not necessarily a reflection of the completeness or stability of the code, it does indicate that the project has yet to be fully endorsed by the ASF.

    </p>
</div>


</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>