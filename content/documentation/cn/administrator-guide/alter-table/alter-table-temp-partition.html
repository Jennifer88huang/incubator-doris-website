

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>临时分区 &mdash; Doris Documentations 0.11.0 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../../" src="../../../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../../../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../../../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" />
    <link rel="next" title="物化视图" href="../materialized-view/index.html" />
    <link rel="prev" title="Schema Change" href="alter-table-schema-change.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../../index.html" class="icon icon-home"> Doris Documentations
          

          
          </a>

          
            
            
              <div class="version">
                0.11.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../../index.html">中文</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../downloads/index.html">下载</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../installing/index.html">编译与部署</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../getting-started/index.html">开始使用</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../index.html">操作手册</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../load-data/index.html">数据导入</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="index.html">表结构变更</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="alter-table-bitmap-index.html">Bitmap 索引</a></li>
<li class="toctree-l4"><a class="reference internal" href="alter-table-rollup.html">Rollup</a></li>
<li class="toctree-l4"><a class="reference internal" href="alter-table-schema-change.html">Schema Change</a></li>
<li class="toctree-l4 current"><a class="current reference internal" href="#">临时分区</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../materialized-view/index.html">物化视图</a></li>
<li class="toctree-l3"><a class="reference internal" href="../http-actions/index.html">HTTP API</a></li>
<li class="toctree-l3"><a class="reference internal" href="../operation/index.html">运维操作</a></li>
<li class="toctree-l3"><a class="reference internal" href="../config/index.html">配置文件</a></li>
<li class="toctree-l3"><a class="reference internal" href="../backup-restore.html">备份与恢复</a></li>
<li class="toctree-l3"><a class="reference internal" href="../broker.html">Broker</a></li>
<li class="toctree-l3"><a class="reference internal" href="../colocation-join.html">Colocation Join</a></li>
<li class="toctree-l3"><a class="reference internal" href="../dynamic-partition.html">动态分区</a></li>
<li class="toctree-l3"><a class="reference internal" href="../export-manual.html">数据导出</a></li>
<li class="toctree-l3"><a class="reference internal" href="../privilege.html">权限管理</a></li>
<li class="toctree-l3"><a class="reference internal" href="../segment-v2-usage.html">Segment V2 升级手册</a></li>
<li class="toctree-l3"><a class="reference internal" href="../small-file-mgr.html">文件管理器</a></li>
<li class="toctree-l3"><a class="reference internal" href="../sql-mode.html">SQL MODE</a></li>
<li class="toctree-l3"><a class="reference internal" href="../time-zone.html">时区</a></li>
<li class="toctree-l3"><a class="reference internal" href="../variables.html">变量</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../extending-doris/index.html">扩展功能</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../internal/index.html">设计文档</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../sql-reference/index.html">SQL 手册</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../developer-guide/index.html">开发者手册</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../community/index.html">Apache 社区</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../en/index.html">English</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../index.html">Doris Documentations</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../../index.html">中文</a> &raquo;</li>
        
          <li><a href="../index.html">操作手册</a> &raquo;</li>
        
          <li><a href="index.html">表结构变更</a> &raquo;</li>
        
      <li>临时分区</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            
              <a href="https://github.com/apache/incubator-doris/blob/master/docs/documentation/cn/administrator-guide/alter-table/alter-table-temp-partition.md" class="fa fa-github"> Edit on GitHub</a>
            
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <!-- 
Licensed to the Apache Software Foundation (ASF) under one
or more contributor license agreements.  See the NOTICE file
distributed with this work for additional information
regarding copyright ownership.  The ASF licenses this file
to you under the Apache License, Version 2.0 (the
"License"); you may not use this file except in compliance
with the License.  You may obtain a copy of the License at

  http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing,
software distributed under the License is distributed on an
"AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, either express or implied.  See the License for the
specific language governing permissions and limitations
under the License.
--><div class="section" id="id1">
<h1>临时分区<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h1>
<p>在 0.12 版本中，Doris 支持了临时分区功能。</p>
<p>临时分区是归属于某一分区表的。只有分区表可以创建临时分区。</p>
<div class="section" id="id2">
<h2>规则<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>临时分区的分区列和正式分区相同，且不可修改。</li>
<li>一张表所有临时分区之间的分区范围不可重叠，但临时分区的范围和正式分区范围可以重叠。</li>
<li>临时分区的分区名称不能和正式分区以及其他临时分区重复。</li>
</ul>
</div>
<div class="section" id="id3">
<h2>支持的操作<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h2>
<p>临时分区支持添加、删除、替换操作。</p>
<div class="section" id="id4">
<h3>添加临时分区<a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h3>
<p>可以通过 <code class="docutils literal notranslate"><span class="pre">ALTER</span> <span class="pre">TABLE</span> <span class="pre">ADD</span> <span class="pre">TEMPORARY</span> <span class="pre">PARTITION</span></code> 语句对一个表添加临时分区：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ALTER</span> <span class="n">TABLE</span> <span class="n">tbl1</span> <span class="n">ADD</span> <span class="n">TEMPORARY</span> <span class="n">PARTITION</span> <span class="n">tp1</span> <span class="n">VALUES</span> <span class="n">LESS</span> <span class="n">THAN</span><span class="p">(</span><span class="s2">&quot;2020-02-01&quot;</span><span class="p">);</span>

<span class="n">ALTER</span> <span class="n">TABLE</span> <span class="n">tbl2</span> <span class="n">ADD</span> <span class="n">TEMPORARY</span> <span class="n">PARTITION</span> <span class="n">tp1</span> <span class="n">VALUES</span> <span class="p">[(</span><span class="s2">&quot;2020-01-01&quot;</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;2020-02-01&quot;</span><span class="p">));</span>

<span class="n">ALTER</span> <span class="n">TABLE</span> <span class="n">tbl1</span> <span class="n">ADD</span> <span class="n">TEMPORARY</span> <span class="n">PARTITION</span> <span class="n">tp1</span> <span class="n">VALUES</span> <span class="n">LESS</span> <span class="n">THAN</span><span class="p">(</span><span class="s2">&quot;2020-02-01&quot;</span><span class="p">)</span>
<span class="p">(</span><span class="s2">&quot;in_memory&quot;</span> <span class="o">=</span> <span class="s2">&quot;true&quot;</span><span class="p">,</span> <span class="s2">&quot;replication_num&quot;</span> <span class="o">=</span> <span class="s2">&quot;1&quot;</span><span class="p">)</span>
<span class="n">DISTRIBUTED</span> <span class="n">BY</span> <span class="n">HASH</span><span class="p">(</span><span class="n">k1</span><span class="p">)</span> <span class="n">BUCKETS</span> <span class="mi">5</span><span class="p">;</span>
</pre></div>
</div>
<p>通过 <code class="docutils literal notranslate"><span class="pre">HELP</span> <span class="pre">ALTER</span> <span class="pre">TABLE;</span></code> 查看更多帮助和示例。</p>
<p>添加操作的一些说明：</p>
<ul class="simple">
<li>临时分区的添加和正式分区的添加操作相似。临时分区的分区范围独立于正式分区。</li>
<li>临时分区可以独立指定一些属性。包括分桶数、副本数、是否是内存表、存储介质等信息。</li>
</ul>
</div>
<div class="section" id="id5">
<h3>删除临时分区<a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h3>
<p>可以通过 <code class="docutils literal notranslate"><span class="pre">ALTER</span> <span class="pre">TABLE</span> <span class="pre">DROP</span> <span class="pre">TEMPORARY</span> <span class="pre">PARTITION</span></code> 语句删除一个表的临时分区：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ALTER</span> <span class="n">TABLE</span> <span class="n">tbl1</span> <span class="n">DROP</span> <span class="n">TEMPORARY</span> <span class="n">PARTITION</span> <span class="n">tp1</span><span class="p">;</span>
</pre></div>
</div>
<p>通过 <code class="docutils literal notranslate"><span class="pre">HELP</span> <span class="pre">ALTER</span> <span class="pre">TABLE;</span></code> 查看更多帮助和示例。</p>
<p>删除操作的一些说明：</p>
<ul class="simple">
<li>删除临时分区，不影响正式分区的数据。</li>
</ul>
</div>
<div class="section" id="id6">
<h3>替换分区<a class="headerlink" href="#id6" title="Permalink to this headline">¶</a></h3>
<p>可以通过 <code class="docutils literal notranslate"><span class="pre">ALTER</span> <span class="pre">TABLE</span> <span class="pre">REPLACE</span> <span class="pre">PARTITION</span></code> 语句将一个表的正式分区替换为临时分区。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ALTER</span> <span class="n">TABLE</span> <span class="n">tbl1</span> <span class="n">REPLACE</span> <span class="n">PARTITION</span> <span class="p">(</span><span class="n">p1</span><span class="p">)</span> <span class="n">WITH</span> <span class="n">TEMPORARY</span> <span class="n">PARTITION</span> <span class="p">(</span><span class="n">tp1</span><span class="p">);</span>

<span class="n">ALTER</span> <span class="n">TABLE</span> <span class="n">tbl1</span> <span class="n">REPLACE</span> <span class="n">PARTITION</span> <span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">)</span> <span class="n">WITH</span> <span class="n">TEMPORARY</span> <span class="n">PARTITION</span> <span class="p">(</span><span class="n">tp1</span><span class="p">,</span> <span class="n">tp2</span><span class="p">,</span> <span class="n">tp3</span><span class="p">);</span>

<span class="n">ALTER</span> <span class="n">TABLE</span> <span class="n">tbl1</span> <span class="n">REPLACE</span> <span class="n">PARTITION</span> <span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">)</span> <span class="n">WITH</span> <span class="n">TEMPORARY</span> <span class="n">PARTITION</span> <span class="p">(</span><span class="n">tp1</span><span class="p">,</span> <span class="n">tp2</span><span class="p">)</span>
<span class="n">PROPERTIES</span> <span class="p">(</span>
    <span class="s2">&quot;strict_range&quot;</span> <span class="o">=</span> <span class="s2">&quot;false&quot;</span><span class="p">,</span>
    <span class="s2">&quot;use_temp_partition_name&quot;</span> <span class="o">=</span> <span class="s2">&quot;true&quot;</span>
<span class="p">);</span>
</pre></div>
</div>
<p>通过 <code class="docutils literal notranslate"><span class="pre">HELP</span> <span class="pre">ALTER</span> <span class="pre">TABLE;</span></code> 查看更多帮助和示例。</p>
<p>替换操作有两个特殊的可选参数：</p>
<ol>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">strict_range</span></code></p>
<p>默认为 true。当该参数为 true 时，表示要被替换的所有正式分区的范围并集需要和替换的临时分区的范围并集完全相同。当置为 false 时，只需要保证替换后，新的正式分区间的范围不重叠即可。下面举例说明：</p>
<ul>
<li><p class="first">示例1</p>
<p>待替换的分区 p1, p2, p3 的范围 (=&gt; 并集)：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">),</span> <span class="p">[</span><span class="mi">20</span><span class="p">,</span> <span class="mi">30</span><span class="p">),</span> <span class="p">[</span><span class="mi">40</span><span class="p">,</span> <span class="mi">50</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">30</span><span class="p">),</span> <span class="p">[</span><span class="mi">40</span><span class="p">,</span> <span class="mi">50</span><span class="p">)</span>
</pre></div>
</div>
<p>替换分区 tp1, tp2 的范围(=&gt; 并集)：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">30</span><span class="p">),</span> <span class="p">[</span><span class="mi">40</span><span class="p">,</span> <span class="mi">45</span><span class="p">),</span> <span class="p">[</span><span class="mi">45</span><span class="p">,</span> <span class="mi">50</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">30</span><span class="p">),</span> <span class="p">[</span><span class="mi">40</span><span class="p">,</span> <span class="mi">50</span><span class="p">)</span>
</pre></div>
</div>
<p>范围并集相同，则可以使用 tp1 和 tp2 替换 p1, p2, p3。</p>
</li>
<li><p class="first">示例2</p>
<p>待替换的分区 p1 的范围 (=&gt; 并集)：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">50</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">50</span><span class="p">)</span>
</pre></div>
</div>
<p>替换分区 tp1, tp2 的范围(=&gt; 并集)：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">30</span><span class="p">),</span> <span class="p">[</span><span class="mi">40</span><span class="p">,</span> <span class="mi">50</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">30</span><span class="p">),</span> <span class="p">[</span><span class="mi">40</span><span class="p">,</span> <span class="mi">50</span><span class="p">)</span>
</pre></div>
</div>
<p>范围并集不相同，如果 <code class="docutils literal notranslate"><span class="pre">strict_range</span></code> 为 true，则不可以使用 tp1 和 tp2 替换 p1。如果为 false，且替换后的两个分区范围 <code class="docutils literal notranslate"><span class="pre">[10,</span> <span class="pre">30),</span> <span class="pre">[40,</span> <span class="pre">50)</span></code> 和其他正式分区不重叠，则可以替换。</p>
</li>
</ul>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">use_temp_partition_name</span></code></p>
<p>默认为 false。当该参数为 false，并且待替换的分区和替换分区的个数相同时，则替换后的正式分区名称维持不变。如果为 true，则替换后，正式分区的名称为替换分区的名称。下面举例说明：</p>
<ul>
<li><p class="first">示例1</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ALTER</span> <span class="n">TABLE</span> <span class="n">tbl1</span> <span class="n">REPLACE</span> <span class="n">PARTITION</span> <span class="p">(</span><span class="n">p1</span><span class="p">)</span> <span class="n">WITH</span> <span class="n">TEMPORARY</span> <span class="n">PARTITION</span> <span class="p">(</span><span class="n">tp1</span><span class="p">);</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">use_temp_partition_name</span></code> 默认为 false，则在替换后，分区的名称依然为 p1，但是相关的数据和属性都替换为 tp1 的。</p>
<p>如果 <code class="docutils literal notranslate"><span class="pre">use_temp_partition_name</span></code> 默认为 true，则在替换后，分区的名称为 tp1。p1 分区不再存在。</p>
</li>
<li><p class="first">示例2</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ALTER</span> <span class="n">TABLE</span> <span class="n">tbl1</span> <span class="n">REPLACE</span> <span class="n">PARTITION</span> <span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">)</span> <span class="n">WITH</span> <span class="n">TEMPORARY</span> <span class="n">PARTITION</span> <span class="p">(</span><span class="n">tp1</span><span class="p">);</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">use_temp_partition_name</span></code> 默认为 false，但因为待替换分区的个数和替换分区的个数不同，则该参数无效。替换后，分区名称为 tp1，p1 和 p2 不再存在。</p>
</li>
</ul>
</li>
</ol>
<p>替换操作的一些说明：</p>
<ul class="simple">
<li>分区替换成功后，被替换的分区将被删除且不可恢复。</li>
</ul>
</div>
</div>
<div class="section" id="id7">
<h2>临时分区的导入和查询<a class="headerlink" href="#id7" title="Permalink to this headline">¶</a></h2>
<p>用户可以将数据导入到临时分区，也可以指定临时分区进行查询。</p>
<ol>
<li><p class="first">导入临时分区</p>
<p>根据导入方式的不同，指定导入临时分区的语法稍有差别。这里通过示例进行简单说明</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">INSERT</span> <span class="n">INTO</span> <span class="n">tbl</span> <span class="n">TEMPORARY</span> <span class="n">PARTITION</span><span class="p">(</span><span class="n">tp1</span><span class="p">,</span> <span class="n">tp2</span><span class="p">,</span> <span class="o">...</span><span class="p">)</span> <span class="n">SELECT</span> <span class="o">....</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">curl</span> <span class="o">--</span><span class="n">location</span><span class="o">-</span><span class="n">trusted</span> <span class="o">-</span><span class="n">u</span> <span class="n">root</span><span class="p">:</span> <span class="o">-</span><span class="n">H</span> <span class="s2">&quot;label:123&quot;</span> <span class="o">-</span><span class="n">H</span> <span class="s2">&quot;temporary_partitions: tp1, tp2, ...&quot;</span> <span class="o">-</span><span class="n">T</span> <span class="n">testData</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">host</span><span class="p">:</span><span class="n">port</span><span class="o">/</span><span class="n">api</span><span class="o">/</span><span class="n">testDb</span><span class="o">/</span><span class="n">testTbl</span><span class="o">/</span><span class="n">_stream_load</span>    
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>LOAD LABEL example_db.label1
(
DATA INFILE(&quot;hdfs://hdfs_host:hdfs_port/user/palo/data/input/file&quot;)
INTO TABLE `my_table`
TEMPORARY PARTITION (tp1, tp2, ...)
...
)
WITH BROKER hdfs (&quot;username&quot;=&quot;hdfs_user&quot;, &quot;password&quot;=&quot;hdfs_password&quot;);
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">CREATE</span> <span class="n">ROUTINE</span> <span class="n">LOAD</span> <span class="n">example_db</span><span class="o">.</span><span class="n">test1</span> <span class="n">ON</span> <span class="n">example_tbl</span>
<span class="n">COLUMNS</span><span class="p">(</span><span class="n">k1</span><span class="p">,</span> <span class="n">k2</span><span class="p">,</span> <span class="n">k3</span><span class="p">,</span> <span class="n">v1</span><span class="p">,</span> <span class="n">v2</span><span class="p">,</span> <span class="n">v3</span> <span class="o">=</span> <span class="n">k1</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span>
<span class="n">TEMPORARY</span> <span class="n">PARTITIONS</span><span class="p">(</span><span class="n">tp1</span><span class="p">,</span> <span class="n">tp2</span><span class="p">,</span> <span class="o">...</span><span class="p">),</span>
<span class="n">WHERE</span> <span class="n">k1</span> <span class="o">&gt;</span> <span class="mi">100</span>
<span class="n">PROPERTIES</span>
<span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="n">FROM</span> <span class="n">KAFKA</span>
<span class="p">(</span><span class="o">...</span><span class="p">);</span>
</pre></div>
</div>
</li>
<li><p class="first">查询临时分区</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">SELECT</span> <span class="o">...</span> <span class="n">FROM</span>
<span class="n">tbl1</span> <span class="n">TEMPORARY</span> <span class="n">PARTITION</span><span class="p">(</span><span class="n">tp1</span><span class="p">,</span> <span class="n">tp2</span><span class="p">,</span> <span class="o">...</span><span class="p">)</span>
<span class="n">JOIN</span>
<span class="n">tbl2</span> <span class="n">TEMPORARY</span> <span class="n">PARTITION</span><span class="p">(</span><span class="n">tp1</span><span class="p">,</span> <span class="n">tp2</span><span class="p">,</span> <span class="o">...</span><span class="p">)</span>
<span class="n">ON</span> <span class="o">...</span>
<span class="n">WHERE</span> <span class="o">...</span><span class="p">;</span>
</pre></div>
</div>
</li>
</ol>
</div>
<div class="section" id="id8">
<h2>和其他操作的关系<a class="headerlink" href="#id8" title="Permalink to this headline">¶</a></h2>
<div class="section" id="drop">
<h3>DROP<a class="headerlink" href="#drop" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>使用 Drop 操作直接删除数据库或表后，可以通过 Recover 命令恢复数据库或表（限定时间内），但临时分区不会被恢复。</li>
<li>使用 Alter 命令删除正式分区后，可以通过 Recover 命令恢复分区（限定时间内）。操作正式分区和临时分区无关。</li>
<li>使用 Alter 命令删除临时分区后，无法通过 Recover 命令恢复临时分区。</li>
</ul>
</div>
<div class="section" id="truncate">
<h3>TRUNCATE<a class="headerlink" href="#truncate" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>使用 Truncate 命令清空表，表的临时分区会被删除，且不可恢复。</li>
<li>使用 Truncate 命令清空正式分区时，不影响临时分区。</li>
<li>不可使用 Truncate 命令清空临时分区。</li>
</ul>
</div>
<div class="section" id="alter">
<h3>ALTER<a class="headerlink" href="#alter" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>当表存在临时分区时，无法使用 Alter 命令对表进行 Schema Change、Rollup 等变更操作。</li>
<li>当表在进行变更操作时，无法对表添加临时分区。</li>
</ul>
</div>
</div>
<div class="section" id="id9">
<h2>最佳实践<a class="headerlink" href="#id9" title="Permalink to this headline">¶</a></h2>
<ol>
<li><p class="first">原子的覆盖写操作</p>
<p>某些情况下，用户希望能够重写某一分区的数据，但如果采用先删除再导入的方式进行，在中间会有一段时间无法查看数据。这是，用户可以先创建一个对应的临时分区，将新的数据导入到临时分区后，通过替换操作，原子的替换原有分区，以达到目的。</p>
</li>
<li><p class="first">修改分桶数</p>
<p>某些情况下，用户在创建分区时使用了不合适的分桶数。则用户可以先创建一个对应分区范围的临时分区，并指定新的分桶数。然后通过 <code class="docutils literal notranslate"><span class="pre">INSERT</span> <span class="pre">INTO</span></code> 命令将正式分区的数据导入到临时分区中，通过替换操作，原子的替换原有分区，以达到目的。</p>
</li>
<li><p class="first">合并或分割分区</p>
<p>某些情况下，用户希望对分区的范围进行修改，比如合并两个分区，或将一个大分区分割成多个小分区。则用户可以先建立对应合并或分割后范围的临时分区，然后通过 <code class="docutils literal notranslate"><span class="pre">INSERT</span> <span class="pre">INTO</span></code> 命令将正式分区的数据导入到临时分区中，通过替换操作，原子的替换原有分区，以达到目的。</p>
</li>
</ol>
</div>
</div>


           </div>
           
          </div>
          <!--
Licensed to the Apache Software Foundation (ASF) under one
or more contributor license agreements.  See the NOTICE file
distributed with this work for additional information
regarding copyright ownership.  The ASF licenses this file
to you under the Apache License, Version 2.0 (the
"License"); you may not use this file except in compliance
with the License.  You may obtain a copy of the License at
  http://www.apache.org/licenses/LICENSE-2.0
Unless required by applicable law or agreed to in writing,
software distributed under the License is distributed on an
"AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, either express or implied.  See the License for the
specific language governing permissions and limitations
under the License.
-->

<footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../materialized-view/index.html" class="btn btn-neutral float-right" title="物化视图" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="alter-table-schema-change.html" class="btn btn-neutral float-left" title="Schema Change" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, Apache Doris(Incubating)

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
<div role="contentinfo">
    <p></p>
    <p>

        Apache Doris(incubating) is an effort undergoing incubation at The Apache Software Foundation (ASF), sponsored by the Apache Incubator. Incubation is required of all newly accepted projects until a further review indicates that the infrastructure, communications, and decision making process have stabilized in a manner consistent with other successful ASF projects. While incubation status is not necessarily a reflection of the completeness or stability of the code, it does indicate that the project has yet to be fully endorsed by the ASF.

    </p>
</div>


</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>