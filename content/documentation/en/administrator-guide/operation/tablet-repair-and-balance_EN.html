

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Data replica management &mdash; Doris Documentations 0.11.0 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../../" src="../../../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../../../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../../../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" />
    <link rel="next" title="Backup and Recovery" href="../backup-restore_EN.html" />
    <link rel="prev" title="Tablet metadata management tool" href="tablet-meta-tool_EN.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../../index.html" class="icon icon-home"> Doris Documentations
          

          
          </a>

          
            
            
              <div class="version">
                0.11.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../cn/index.html">中文</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../index.html">English</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../installing/index.html">Compilation and deployment</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../getting-started/index.html">Getting started</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../index.html">Administrator Guide</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../load-data/index.html">Load Data</a></li>
<li class="toctree-l3"><a class="reference internal" href="../http-actions/index.html">HTTP API</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="index.html">Maintainence Operation</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="metadata-operation_EN.html">Metadata Operations and Maintenance</a></li>
<li class="toctree-l4"><a class="reference internal" href="monitor-alert_EN.html">Monitoring and alarming</a></li>
<li class="toctree-l4"><a class="reference internal" href="multi-tenant_EN.html">Multi-tenancy(Exprimental)</a></li>
<li class="toctree-l4"><a class="reference internal" href="tablet-meta-tool_EN.html">Tablet metadata management tool</a></li>
<li class="toctree-l4 current"><a class="current reference internal" href="#">Data replica management</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../backup-restore_EN.html">Backup and Recovery</a></li>
<li class="toctree-l3"><a class="reference internal" href="../colocation-join_EN.html">Colocation Join</a></li>
<li class="toctree-l3"><a class="reference internal" href="../export_manual_EN.html">Data export</a></li>
<li class="toctree-l3"><a class="reference internal" href="../privilege_EN.html">Authority Management</a></li>
<li class="toctree-l3"><a class="reference internal" href="../small-file-mgr_EN.html">File Manager</a></li>
<li class="toctree-l3"><a class="reference internal" href="../time-zone_EN.html">Time zone</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../extending-doris/index.html">Extending Ability</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../internal/index.html">Design Documents</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../sql-reference/index.html">SQL Manual</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../community/index.html">Apache Commnity</a></li>
</ul>
</li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../index.html">Doris Documentations</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../../index.html">English</a> &raquo;</li>
        
          <li><a href="../index.html">Administrator Guide</a> &raquo;</li>
        
          <li><a href="index.html">Maintainence Operation</a> &raquo;</li>
        
      <li>Data replica management</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            
              <a href="https://github.com/apache/incubator-doris/blob/master/docs/documentation/en/administrator-guide/operation/tablet-repair-and-balance_EN.md" class="fa fa-github"> Edit on GitHub</a>
            
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="data-replica-management">
<h1>Data replica management<a class="headerlink" href="#data-replica-management" title="Permalink to this headline">¶</a></h1>
<p>Beginning with version 0.9.0, Doris introduced an optimized replica management strategy and supported a richer replica status viewing tool. This document focuses on Doris data replica balancing, repair scheduling strategies, and replica management operations and maintenance methods. Help users to more easily master and manage the replica status in the cluster.</p>
<blockquote>
<div>Repairing and balancing copies of tables with Collocation attributes can be referred to <code class="docutils literal notranslate"><span class="pre">docs/documentation/cn/administrator-guide/colocation-join.md'.</span></code></div></blockquote>
<div class="section" id="noun-interpretation">
<h2>Noun Interpretation<a class="headerlink" href="#noun-interpretation" title="Permalink to this headline">¶</a></h2>
<ol class="simple">
<li>Tablet: The logical fragmentation of a Doris table, where a table has multiple fragmentations.</li>
<li>Replica: A sliced copy, defaulting to three copies of a slice.</li>
<li>Healthy Replica: A healthy copy that survives at Backend and has a complete version.</li>
<li>Tablet Checker (TC): A resident background thread that scans all Tablets regularly, checks the status of these Tablets, and decides whether to send them to Tablet Scheduler based on the results.</li>
<li>Tablet Scheduler (TS): A resident background thread that handles Tablets sent by Tablet Checker that need to be repaired. At the same time, cluster replica balancing will be carried out.</li>
<li>Tablet SchedCtx (TSC): is a tablet encapsulation. When TC chooses a tablet, it encapsulates it as a TSC and sends it to TS.</li>
<li>Storage Medium: Storage medium. Doris supports specifying different storage media for partition granularity, including SSD and HDD. The replica scheduling strategy is also scheduled for different storage media.</li>
</ol>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>
              <span class="o">+--------+</span>              <span class="o">+-----------+</span>
              <span class="o">|</span>  <span class="n">Meta</span>  <span class="o">|</span>              <span class="o">|</span>  <span class="n">Backends</span> <span class="o">|</span>
              <span class="o">+---^----+</span>              <span class="o">+------^----+</span>
                  <span class="o">|</span> <span class="o">|</span>                        <span class="o">|</span> <span class="mf">3.</span> <span class="n">Send</span> <span class="n">clone</span> <span class="n">tasks</span>
 <span class="mf">1.</span> <span class="n">Check</span> <span class="n">tablets</span> <span class="o">|</span> <span class="o">|</span>                        <span class="o">|</span>
           <span class="o">+--------</span><span class="n">v</span><span class="o">------+</span>        <span class="o">+-----------------+</span>
           <span class="o">|</span> <span class="n">TabletChecker</span> <span class="o">+--------&gt;</span> <span class="n">TabletScheduler</span> <span class="o">|</span>
           <span class="o">+---------------+</span>        <span class="o">+-----------------+</span>
                   <span class="mf">2.</span> <span class="n">Waiting</span> <span class="n">to</span> <span class="n">be</span> <span class="n">scheduled</span>
</pre></div>
</div>
<p>The figure above is a simplified workflow.</p>
</div>
<div class="section" id="duplicate-status">
<h2>Duplicate status<a class="headerlink" href="#duplicate-status" title="Permalink to this headline">¶</a></h2>
<p>Multiple copies of a Tablet may cause state inconsistencies due to certain circumstances. Doris will attempt to automatically fix the inconsistent copies of these states so that the cluster can recover from the wrong state as soon as possible.</p>
<p><strong>The health status of a Replica is as follows:</strong></p>
<ol>
<li><p class="first">BAD</p>
<p>That is, the copy is damaged. Includes, but is not limited to, the irrecoverable damaged status of copies caused by disk failures, BUGs, etc.</p>
</li>
<li><p class="first">VERSION_MISSING</p>
<p>Version missing. Each batch of imports in Doris corresponds to a data version. A copy of the data consists of several consecutive versions. However, due to import errors, delays and other reasons, the data version of some copies may be incomplete.</p>
</li>
<li><p class="first">HEALTHY</p>
<p>Health copy. That is, a copy of the normal data, and the BE node where the copy is located is in a normal state (heartbeat is normal and not in the offline process).</p>
</li>
</ol>
<p><strong>The health status of a Tablet is determined by the status of all its copies. There are the following categories:</strong></p>
<ol>
<li><p class="first">REPLICA_MISSING</p>
<p>The copy is missing. That is, the number of surviving copies is less than the expected number of copies.</p>
</li>
<li><p class="first">VERSION_INCOMPLETE</p>
<p>The number of surviving copies is greater than or equal to the number of expected copies, but the number of healthy copies is less than the number of expected copies.</p>
</li>
<li><p class="first">REPLICA_RELOCATING</p>
<p>Have a full number of live copies of the replication num version, but the BE nodes where some copies are located are in unavailable state (such as decommission)</p>
</li>
<li><p class="first">REPLICA_MISSING_IN_CLUSTER</p>
<p>When using multi-cluster, the number of healthy replicas is greater than or equal to the expected number of replicas, but the number of replicas in the corresponding cluster is less than the expected number of replicas.</p>
</li>
<li><p class="first">REDUNDANT</p>
<p>Duplicate redundancy. Healthy replicas are in the corresponding cluster, but the number of replicas is larger than the expected number. Or there’s a spare copy of unavailable.</p>
</li>
<li><p class="first">FORCE_REDUNDANT</p>
<p>This is a special state. It only occurs when the number of expected replicas is greater than or equal to the number of available nodes, and when the Tablet is in the state of replica missing. In this case, you need to delete a copy first to ensure that there are available nodes for creating a new copy.</p>
</li>
<li><p class="first">COLOCATE_MISMATCH</p>
<p>Fragmentation status of tables for Collocation attributes. Represents that the distribution of fragmented copies is inconsistent with the specified distribution of Colocation Group.</p>
</li>
<li><p class="first">COLOCATE_REDUNDANT</p>
<p>Fragmentation status of tables for Collocation attributes. Represents the fragmented copy redundancy of the Colocation table.</p>
</li>
<li><p class="first">HEALTHY</p>
<p>Healthy fragmentation, that is, conditions [1-5] are not satisfied.</p>
</li>
</ol>
</div>
<div class="section" id="replica-repair">
<h2>Replica Repair<a class="headerlink" href="#replica-repair" title="Permalink to this headline">¶</a></h2>
<p>As a resident background process, Tablet Checker regularly checks the status of all fragments. For unhealthy fragmentation, it will be sent to Tablet Scheduler for scheduling and repair. The actual operation of repair is accomplished by clone task on BE. FE is only responsible for generating these clone tasks.</p>
<blockquote>
<div><p>Note 1: The main idea of replica repair is to make the number of fragmented replicas reach the desired value by creating or completing them first. Then delete the redundant copy.</p>
<p>Note 2: A clone task is to complete the process of copying specified data from a specified remote end to a specified destination.</p>
</div></blockquote>
<p>For different states, we adopt different repair methods:</p>
<ol>
<li><p class="first">REPLICA_MISSING/REPLICA_RELOCATING</p>
<p>Select a low-load, available BE node as the destination. Choose a healthy copy as the source. Clone tasks copy a complete copy from the source to the destination. For replica completion, we will directly select an available BE node, regardless of the storage medium.</p>
</li>
<li><p class="first">VERSION_INCOMPLETE</p>
<p>Select a relatively complete copy as the destination. Choose a healthy copy as the source. The clone task attempts to copy the missing version from the source to the destination.</p>
</li>
<li><p class="first">REPLICA_MISSING_IN_CLUSTER</p>
<p>This state processing method is the same as REPLICAMISSING.</p>
</li>
<li><p class="first">REDUNDANT</p>
<p>Usually, after repair, there will be redundant copies in fragmentation. We select a redundant copy to delete it. The selection of redundant copies follows the following priorities:</p>
<ol class="simple">
<li>The BE where the copy is located has been offline.</li>
<li>The copy is damaged</li>
<li>The copy is lost in BE or offline</li>
<li>The replica is in the CLONE state (which is an intermediate state during clone task execution)</li>
<li>The copy has version missing</li>
<li>The cluster where the copy is located is incorrect</li>
<li>The BE node where the replica is located has a high load</li>
</ol>
</li>
<li><p class="first">FORCE_REDUNDANT</p>
<p>Unlike REDUNDANT, because at this point Tablet has a copy missing, because there are no additional available nodes for creating new copies. So at this point, a copy must be deleted to free up a available node for creating a new copy.
The order of deleting copies is the same as REDUNDANT.</p>
</li>
<li><p class="first">COLOCATE_MISMATCH</p>
<p>Select one of the replica distribution BE nodes specified in Colocation Group as the destination node for replica completion.</p>
</li>
<li><p class="first">COLOCATE_REDUNDANT</p>
<p>Delete a copy on a BE node that is distributed by a copy specified in a non-Colocation Group.</p>
<p>Doris does not deploy a copy of the same Tablet on a different BE of the same host when selecting a replica node. It ensures that even if all BEs on the same host are deactivated, all copies will not be lost.</p>
</li>
</ol>
<div class="section" id="scheduling-priority">
<h3>Scheduling priority<a class="headerlink" href="#scheduling-priority" title="Permalink to this headline">¶</a></h3>
<p>Waiting for the scheduled fragments in Tablet Scheduler gives different priorities depending on the status. High priority fragments will be scheduled first. There are currently several priorities.</p>
<ol class="simple">
<li>VERY_HIGH<ul>
<li>REDUNDANT. For slices with duplicate redundancy, we give priority to them. Logically, duplicate redundancy is the least urgent, but because it is the fastest to handle and can quickly release resources (such as disk space, etc.), we give priority to it.</li>
<li>FORCE_REDUNDANT. Ditto.</li>
</ul>
</li>
<li>HIGH<ul>
<li>REPLICA_MISSING and most copies are missing (for example, 2 copies are missing in 3 copies)</li>
<li>VERSION_INCOMPLETE and most copies are missing</li>
<li>COLOCATE_MISMATCH We hope that the fragmentation related to the Collocation table can be repaired as soon as possible.</li>
<li>COLOCATE_REDUNDANT</li>
</ul>
</li>
<li>NORMAL<ul>
<li>REPLICA_MISSING, but most survive (for example, three copies lost one)</li>
<li>VERSION_INCOMPLETE, but most copies are complete</li>
<li>REPLICA_RELOCATING and relocate is required for most replicas (e.g. 3 replicas with 2 replicas)</li>
</ul>
</li>
<li>LOW<ul>
<li>REPLICA_MISSING_IN_CLUSTER</li>
<li>REPLICA_RELOCATING most copies stable</li>
</ul>
</li>
</ol>
</div>
<div class="section" id="manual-priority">
<h3>Manual priority<a class="headerlink" href="#manual-priority" title="Permalink to this headline">¶</a></h3>
<p>The system will automatically determine the scheduling priority. Sometimes, however, users want the fragmentation of some tables or partitions to be repaired faster. So we provide a command that the user can specify that a slice of a table or partition is repaired first:</p>
<p><code class="docutils literal notranslate"><span class="pre">ADMIN</span> <span class="pre">REPAIR</span> <span class="pre">TABLE</span> <span class="pre">tbl</span> <span class="pre">[PARTITION</span> <span class="pre">(p1,</span> <span class="pre">p2,</span> <span class="pre">...)];</span></code></p>
<p>This command tells TC to give VERY HIGH priority to the problematic tables or partitions that need to be repaired first when scanning Tablets.</p>
<blockquote>
<div>Note: This command is only a hint, which does not guarantee that the repair will be successful, and the priority will change with the scheduling of TS. And when Master FE switches or restarts, this information will be lost.</div></blockquote>
<p>Priority can be cancelled by the following commands:</p>
<p><code class="docutils literal notranslate"><span class="pre">ADMIN</span> <span class="pre">CANCEL</span> <span class="pre">REPAIR</span> <span class="pre">TABLE</span> <span class="pre">tbl</span> <span class="pre">[PARTITION</span> <span class="pre">(p1,</span> <span class="pre">p2,</span> <span class="pre">...)];</span></code></p>
</div>
<div class="section" id="priority-scheduling">
<h3>Priority scheduling<a class="headerlink" href="#priority-scheduling" title="Permalink to this headline">¶</a></h3>
<p>Priority ensures that severely damaged fragments can be repaired first, and improves system availability. But if the high priority repair task fails all the time, the low priority task will never be scheduled. Therefore, we will dynamically adjust the priority of tasks according to the running status of tasks, so as to ensure that all tasks have the opportunity to be scheduled.</p>
<ul class="simple">
<li>If the scheduling fails for five consecutive times (e.g., no resources can be obtained, no suitable source or destination can be found, etc.), the priority will be lowered.</li>
<li>If not scheduled for 30 minutes, priority will be raised.</li>
<li>The priority of the same tablet task is adjusted at least five minutes apart.</li>
</ul>
<p>At the same time, in order to ensure the weight of the initial priority, we stipulate that the initial priority is VERY HIGH, and the lowest is lowered to NORMAL. When the initial priority is LOW, it is raised to HIGH at most. The priority adjustment here also adjusts the priority set manually by the user.</p>
</div>
</div>
<div class="section" id="duplicate-equilibrium">
<h2>Duplicate Equilibrium<a class="headerlink" href="#duplicate-equilibrium" title="Permalink to this headline">¶</a></h2>
<p>Doris automatically balances replicas within the cluster. The main idea of balancing is to create a replica of some fragments on low-load nodes, and then delete the replicas of these fragments on high-load nodes. At the same time, because of the existence of different storage media, there may or may not exist one or two storage media on different BE nodes in the same cluster. We require that fragments of storage medium A be stored in storage medium A as far as possible after equalization. So we divide the BE nodes of the cluster according to the storage medium. Then load balancing scheduling is carried out for different BE node sets of storage media.</p>
<p>Similarly, replica balancing ensures that a copy of the same table will not be deployed on the BE of the same host.</p>
<div class="section" id="be-node-load">
<h3>BE Node Load<a class="headerlink" href="#be-node-load" title="Permalink to this headline">¶</a></h3>
<p>We use Cluster LoadStatistics (CLS) to represent the load balancing of each backend in a cluster. Tablet Scheduler triggers cluster equilibrium based on this statistic. We currently calculate a load Score for each BE as the BE load score by using <strong>disk usage</strong> and <strong>number of copies</strong>. The higher the score, the heavier the load on the BE.</p>
<p>Disk usage and number of copies have a weight factor, which is <strong>capacityCoefficient</strong> and <strong>replicaNumCoefficient</strong>, respectively. The sum of them is <strong>constant to 1</strong>. Among them, capacityCoefficient will dynamically adjust according to actual disk utilization. When the overall disk utilization of a BE is below 50%, the capacityCoefficient value is 0.5, and if the disk utilization is above 75% (configurable through the FE configuration item <code class="docutils literal notranslate"><span class="pre">capacity_used_percent_high_water</span></code>), the value is 1. If the utilization rate is between 50% and 75%, the weight coefficient increases smoothly. The formula is as follows:</p>
<p><code class="docutils literal notranslate"><span class="pre">capacityCoefficient</span> <span class="pre">=</span> <span class="pre">2</span> <span class="pre">*</span> <span class="pre">Disk</span> <span class="pre">Utilization</span> <span class="pre">-</span> <span class="pre">0.5</span></code></p>
<p>The weight coefficient ensures that when disk utilization is too high, the backend load score will be higher to ensure that the BE load is reduced as soon as possible.</p>
<p>Tablet Scheduler updates CLS every 1 minute.</p>
</div>
<div class="section" id="equilibrium-strategy">
<h3>Equilibrium strategy<a class="headerlink" href="#equilibrium-strategy" title="Permalink to this headline">¶</a></h3>
<p>Tablet Scheduler uses Load Balancer to select a certain number of healthy fragments as candidate fragments for balance in each round of scheduling. In the next scheduling, balanced scheduling will be attempted based on these candidate fragments.</p>
</div>
</div>
<div class="section" id="resource-control">
<h2>Resource control<a class="headerlink" href="#resource-control" title="Permalink to this headline">¶</a></h2>
<p>Both replica repair and balancing are accomplished by replica copies between BEs. If the same BE performs too many tasks at the same time, it will bring a lot of IO pressure. Therefore, Doris controls the number of tasks that can be performed on each node during scheduling. The smallest resource control unit is the disk (that is, a data path specified in be.conf). By default, we configure two slots per disk for replica repair. A clone task occupies one slot at the source and one slot at the destination. If the number of slots is zero, no more tasks will be assigned to this disk. The number of slots can be configured by FE’s <code class="docutils literal notranslate"><span class="pre">schedule_slot_num_per_path</span></code> parameter.</p>
<p>In addition, by default, we provide two separate slots per disk for balancing tasks. The purpose is to prevent high-load nodes from losing space by balancing because slots are occupied by repair tasks.</p>
</div>
<div class="section" id="duplicate-status-view">
<h2>Duplicate Status View<a class="headerlink" href="#duplicate-status-view" title="Permalink to this headline">¶</a></h2>
<p>Duplicate status view mainly looks at the status of the duplicate, as well as the status of the duplicate repair and balancing tasks. Most of these states <strong>exist only in</strong> Master FE nodes. Therefore, the following commands need to be executed directly to Master FE.</p>
<div class="section" id="id1">
<h3>Duplicate status<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h3>
<ol>
<li><p class="first">Global state checking</p>
<p>Through <code class="docutils literal notranslate"><span class="pre">SHOW</span> <span class="pre">PROC'/</span> <span class="pre">statistic';</span> </code>commands can view the replica status of the entire cluster.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">+----------+-----------------------------+----------+--------------+----------+-----------+------------+--------------------+-----------------------+</span>
<span class="o">|</span> <span class="n">DbId</span>     <span class="o">|</span> <span class="n">DbName</span>                      <span class="o">|</span> <span class="n">TableNum</span> <span class="o">|</span> <span class="n">PartitionNum</span> <span class="o">|</span> <span class="n">IndexNum</span> <span class="o">|</span> <span class="n">TabletNum</span> <span class="o">|</span> <span class="n">ReplicaNum</span> <span class="o">|</span> <span class="n">UnhealthyTabletNum</span> <span class="o">|</span> <span class="n">InconsistentTabletNum</span> <span class="o">|</span>
<span class="o">+----------+-----------------------------+----------+--------------+----------+-----------+------------+--------------------+-----------------------+</span>
<span class="o">|</span> <span class="mi">35153636</span> <span class="o">|</span> <span class="n">default_cluster</span><span class="p">:</span><span class="n">DF_Newrisk</span>  <span class="o">|</span> <span class="mi">3</span>        <span class="o">|</span> <span class="mi">3</span>            <span class="o">|</span> <span class="mi">3</span>        <span class="o">|</span> <span class="mi">96</span>        <span class="o">|</span> <span class="mi">288</span>        <span class="o">|</span> <span class="mi">0</span>                  <span class="o">|</span> <span class="mi">0</span>                     <span class="o">|</span>
<span class="o">|</span> <span class="mi">48297972</span> <span class="o">|</span> <span class="n">default_cluster</span><span class="p">:</span><span class="n">PaperData</span>   <span class="o">|</span> <span class="mi">0</span>        <span class="o">|</span> <span class="mi">0</span>            <span class="o">|</span> <span class="mi">0</span>        <span class="o">|</span> <span class="mi">0</span>         <span class="o">|</span> <span class="mi">0</span>          <span class="o">|</span> <span class="mi">0</span>                  <span class="o">|</span> <span class="mi">0</span>                     <span class="o">|</span>
<span class="o">|</span> <span class="mi">5909381</span>  <span class="o">|</span> <span class="n">default_cluster</span><span class="p">:</span><span class="n">UM_TEST</span>     <span class="o">|</span> <span class="mi">7</span>        <span class="o">|</span> <span class="mi">7</span>            <span class="o">|</span> <span class="mi">10</span>       <span class="o">|</span> <span class="mi">320</span>       <span class="o">|</span> <span class="mi">960</span>        <span class="o">|</span> <span class="mi">1</span>                  <span class="o">|</span> <span class="mi">0</span>                     <span class="o">|</span>
<span class="o">|</span> <span class="n">Total</span>    <span class="o">|</span> <span class="mi">240</span>                         <span class="o">|</span> <span class="mi">10</span>       <span class="o">|</span> <span class="mi">10</span>           <span class="o">|</span> <span class="mi">13</span>       <span class="o">|</span> <span class="mi">416</span>       <span class="o">|</span> <span class="mi">1248</span>       <span class="o">|</span> <span class="mi">1</span>                  <span class="o">|</span> <span class="mi">0</span>                     <span class="o">|</span>
<span class="o">+----------+-----------------------------+----------+--------------+----------+-----------+------------+--------------------+-----------------------+</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">UnhealthyTabletNum</span></code> column shows how many Tablets are in an unhealthy state in the corresponding database. <code class="docutils literal notranslate"><span class="pre">The</span> <span class="pre">Inconsistent</span> <span class="pre">Tablet</span> <span class="pre">Num</span></code> column shows how many Tablets are in an inconsistent replica state in the corresponding database. The last <code class="docutils literal notranslate"><span class="pre">Total</span></code> line counts the entire cluster. Normally <code class="docutils literal notranslate"><span class="pre">Unhealth</span> <span class="pre">Tablet</span> <span class="pre">Num</span></code> and <code class="docutils literal notranslate"><span class="pre">Inconsistent</span> <span class="pre">Tablet</span> <span class="pre">Num</span></code> should be 0. If it’s not zero, you can further see which Tablets are there. As shown in the figure above, one table in the UM_TEST database is not healthy, you can use the following command to see which one is.</p>
<p><code class="docutils literal notranslate"><span class="pre">SHOW</span> <span class="pre">PROC</span> <span class="pre">'/statistic/5909381';</span></code></p>
<p>Among them `5909381’is the corresponding DbId.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">+------------------+---------------------+</span>
<span class="o">|</span> <span class="n">UnhealthyTablets</span> <span class="o">|</span> <span class="n">InconsistentTablets</span> <span class="o">|</span>
<span class="o">+------------------+---------------------+</span>
<span class="o">|</span> <span class="p">[</span><span class="mi">40467980</span><span class="p">]</span>       <span class="o">|</span> <span class="p">[]</span>                  <span class="o">|</span>
<span class="o">+------------------+---------------------+</span>
</pre></div>
</div>
<p>The figure above shows the specific unhealthy Tablet ID (40467980). Later we’ll show you how to view the status of each copy of a specific Tablet.</p>
</li>
<li><p class="first">Table (partition) level status checking</p>
<p>Users can view the status of a copy of a specified table or partition through the following commands and filter the status through a WHERE statement. If you look at table tbl1, the state on partitions P1 and P2 is a copy of NORMAL:</p>
<p><code class="docutils literal notranslate"><span class="pre">ADMIN</span> <span class="pre">SHOW</span> <span class="pre">REPLICA</span> <span class="pre">STATUS</span> <span class="pre">FROM</span> <span class="pre">tbl1</span> <span class="pre">PARTITION</span> <span class="pre">(p1,</span> <span class="pre">p2)</span> <span class="pre">WHERE</span> <span class="pre">STATUS</span> <span class="pre">=</span> <span class="pre">&quot;NORMAL&quot;;</span></code></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">+----------+-----------+-----------+---------+-------------------+--------------------+------------------+------------+------------+-------+--------+--------+</span>
<span class="o">|</span> <span class="n">TabletId</span> <span class="o">|</span> <span class="n">ReplicaId</span> <span class="o">|</span> <span class="n">BackendId</span> <span class="o">|</span> <span class="n">Version</span> <span class="o">|</span> <span class="n">LastFailedVersion</span> <span class="o">|</span> <span class="n">LastSuccessVersion</span> <span class="o">|</span> <span class="n">CommittedVersion</span> <span class="o">|</span> <span class="n">SchemaHash</span> <span class="o">|</span> <span class="n">VersionNum</span> <span class="o">|</span> <span class="n">IsBad</span> <span class="o">|</span> <span class="n">State</span>  <span class="o">|</span> <span class="n">Status</span> <span class="o">|</span>
<span class="o">+----------+-----------+-----------+---------+-------------------+--------------------+------------------+------------+------------+-------+--------+--------+</span>
<span class="o">|</span> <span class="mi">29502429</span> <span class="o">|</span> <span class="mi">29502432</span>  <span class="o">|</span> <span class="mi">10006</span>     <span class="o">|</span> <span class="mi">2</span>       <span class="o">|</span> <span class="o">-</span><span class="mi">1</span>                <span class="o">|</span> <span class="mi">2</span>                  <span class="o">|</span> <span class="mi">1</span>                <span class="o">|</span> <span class="o">-</span><span class="mi">1</span>         <span class="o">|</span> <span class="mi">2</span>          <span class="o">|</span> <span class="n">false</span> <span class="o">|</span> <span class="n">NORMAL</span> <span class="o">|</span> <span class="n">OK</span>     <span class="o">|</span>
<span class="o">|</span> <span class="mi">29502429</span> <span class="o">|</span> <span class="mi">36885996</span>  <span class="o">|</span> <span class="mi">10002</span>     <span class="o">|</span> <span class="mi">2</span>       <span class="o">|</span> <span class="o">-</span><span class="mi">1</span>                <span class="o">|</span> <span class="o">-</span><span class="mi">1</span>                 <span class="o">|</span> <span class="mi">1</span>                <span class="o">|</span> <span class="o">-</span><span class="mi">1</span>         <span class="o">|</span> <span class="mi">2</span>          <span class="o">|</span> <span class="n">false</span> <span class="o">|</span> <span class="n">NORMAL</span> <span class="o">|</span> <span class="n">OK</span>     <span class="o">|</span>
<span class="o">|</span> <span class="mi">29502429</span> <span class="o">|</span> <span class="mi">48100551</span>  <span class="o">|</span> <span class="mi">10007</span>     <span class="o">|</span> <span class="mi">2</span>       <span class="o">|</span> <span class="o">-</span><span class="mi">1</span>                <span class="o">|</span> <span class="o">-</span><span class="mi">1</span>                 <span class="o">|</span> <span class="mi">1</span>                <span class="o">|</span> <span class="o">-</span><span class="mi">1</span>         <span class="o">|</span> <span class="mi">2</span>          <span class="o">|</span> <span class="n">false</span> <span class="o">|</span> <span class="n">NORMAL</span> <span class="o">|</span> <span class="n">OK</span>     <span class="o">|</span>
<span class="o">|</span> <span class="mi">29502433</span> <span class="o">|</span> <span class="mi">29502434</span>  <span class="o">|</span> <span class="mi">10001</span>     <span class="o">|</span> <span class="mi">2</span>       <span class="o">|</span> <span class="o">-</span><span class="mi">1</span>                <span class="o">|</span> <span class="mi">2</span>                  <span class="o">|</span> <span class="mi">1</span>                <span class="o">|</span> <span class="o">-</span><span class="mi">1</span>         <span class="o">|</span> <span class="mi">2</span>          <span class="o">|</span> <span class="n">false</span> <span class="o">|</span> <span class="n">NORMAL</span> <span class="o">|</span> <span class="n">OK</span>     <span class="o">|</span>
<span class="o">|</span> <span class="mi">29502433</span> <span class="o">|</span> <span class="mi">44900737</span>  <span class="o">|</span> <span class="mi">10004</span>     <span class="o">|</span> <span class="mi">2</span>       <span class="o">|</span> <span class="o">-</span><span class="mi">1</span>                <span class="o">|</span> <span class="o">-</span><span class="mi">1</span>                 <span class="o">|</span> <span class="mi">1</span>                <span class="o">|</span> <span class="o">-</span><span class="mi">1</span>         <span class="o">|</span> <span class="mi">2</span>          <span class="o">|</span> <span class="n">false</span> <span class="o">|</span> <span class="n">NORMAL</span> <span class="o">|</span> <span class="n">OK</span>     <span class="o">|</span>
<span class="o">|</span> <span class="mi">29502433</span> <span class="o">|</span> <span class="mi">48369135</span>  <span class="o">|</span> <span class="mi">10006</span>     <span class="o">|</span> <span class="mi">2</span>       <span class="o">|</span> <span class="o">-</span><span class="mi">1</span>                <span class="o">|</span> <span class="o">-</span><span class="mi">1</span>                 <span class="o">|</span> <span class="mi">1</span>                <span class="o">|</span> <span class="o">-</span><span class="mi">1</span>         <span class="o">|</span> <span class="mi">2</span>          <span class="o">|</span> <span class="n">false</span> <span class="o">|</span> <span class="n">NORMAL</span> <span class="o">|</span> <span class="n">OK</span>     <span class="o">|</span>
<span class="o">+----------+-----------+-----------+---------+-------------------+--------------------+------------------+------------+------------+-------+--------+--------+</span>
</pre></div>
</div>
<p>The status of all copies is shown here. Where <code class="docutils literal notranslate"><span class="pre">IsBad</span></code> is listed as <code class="docutils literal notranslate"><span class="pre">true</span></code>, the copy is damaged. The <code class="docutils literal notranslate"><span class="pre">Status</span></code> column displays other states. Specific status description, you can see help through <code class="docutils literal notranslate"><span class="pre">HELP</span> <span class="pre">ADMIN</span> <span class="pre">SHOW</span> <span class="pre">REPLICA</span> <span class="pre">STATUS</span></code>.</p>
<p><code class="docutils literal notranslate"><span class="pre">The</span> <span class="pre">ADMIN</span> <span class="pre">SHOW</span> <span class="pre">REPLICA</span> <span class="pre">STATUS</span></code>command is mainly used to view the health status of copies. Users can also view additional information about copies of a specified table by using the following commands:</p>
<p><code class="docutils literal notranslate"><span class="pre">SHOW</span> <span class="pre">TABLET</span> <span class="pre">FROM</span> <span class="pre">tbl1;</span></code></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">+----------+-----------+-----------+---------+-------------+-------------------+-----------------------+------------------+----------------------+---------------+----------+----------+--------+-------------------------+--------------+-----------------</span>	<span class="o">-+--------------+----------------------+</span>
<span class="o">|</span> <span class="n">TabletId</span> <span class="o">|</span> <span class="n">ReplicaId</span> <span class="o">|</span> <span class="n">BackendId</span> <span class="o">|</span> <span class="n">Version</span> <span class="o">|</span> <span class="n">VersionHash</span> <span class="o">|</span> <span class="n">LstSuccessVersion</span> <span class="o">|</span> <span class="n">LstSuccessVersionHash</span> <span class="o">|</span> <span class="n">LstFailedVersion</span> <span class="o">|</span> <span class="n">LstFailedVersionHash</span> <span class="o">|</span> <span class="n">LstFailedTime</span> <span class="o">|</span> <span class="n">DataSize</span> <span class="o">|</span> <span class="n">RowCount</span> <span class="o">|</span> <span class="n">State</span>  <span class="o">|</span> <span class="n">LstConsistencyCheckTime</span> <span class="o">|</span> <span class="n">CheckVersion</span> <span class="o">|</span> 	<span class="n">CheckVersionHash</span> <span class="o">|</span> <span class="n">VersionCount</span> <span class="o">|</span> <span class="n">PathHash</span>             <span class="o">|</span>
<span class="o">+----------+-----------+-----------+---------+-------------+-------------------+-----------------------+------------------+----------------------+---------------+----------+----------+--------+-------------------------+--------------+-----------------</span>	<span class="o">-+--------------+----------------------+</span>
<span class="o">|</span> <span class="mi">29502429</span> <span class="o">|</span> <span class="mi">29502432</span>  <span class="o">|</span> <span class="mi">10006</span>     <span class="o">|</span> <span class="mi">2</span>       <span class="o">|</span> <span class="mi">0</span>           <span class="o">|</span> <span class="mi">2</span>                 <span class="o">|</span> <span class="mi">0</span>                     <span class="o">|</span> <span class="o">-</span><span class="mi">1</span>               <span class="o">|</span> <span class="mi">0</span>                    <span class="o">|</span> <span class="n">N</span><span class="o">/</span><span class="n">A</span>           <span class="o">|</span> <span class="mi">784</span>      <span class="o">|</span> <span class="mi">0</span>        <span class="o">|</span> <span class="n">NORMAL</span> <span class="o">|</span> <span class="n">N</span><span class="o">/</span><span class="n">A</span>                     <span class="o">|</span> <span class="o">-</span><span class="mi">1</span>           <span class="o">|</span> 	<span class="o">-</span><span class="mi">1</span>               <span class="o">|</span> <span class="mi">2</span>            <span class="o">|</span> <span class="o">-</span><span class="mi">5822326203532286804</span> <span class="o">|</span>
<span class="o">|</span> <span class="mi">29502429</span> <span class="o">|</span> <span class="mi">36885996</span>  <span class="o">|</span> <span class="mi">10002</span>     <span class="o">|</span> <span class="mi">2</span>       <span class="o">|</span> <span class="mi">0</span>           <span class="o">|</span> <span class="o">-</span><span class="mi">1</span>                <span class="o">|</span> <span class="mi">0</span>                     <span class="o">|</span> <span class="o">-</span><span class="mi">1</span>               <span class="o">|</span> <span class="mi">0</span>                    <span class="o">|</span> <span class="n">N</span><span class="o">/</span><span class="n">A</span>           <span class="o">|</span> <span class="mi">784</span>      <span class="o">|</span> <span class="mi">0</span>        <span class="o">|</span> <span class="n">NORMAL</span> <span class="o">|</span> <span class="n">N</span><span class="o">/</span><span class="n">A</span>                     <span class="o">|</span> <span class="o">-</span><span class="mi">1</span>           <span class="o">|</span> 	<span class="o">-</span><span class="mi">1</span>               <span class="o">|</span> <span class="mi">2</span>            <span class="o">|</span> <span class="o">-</span><span class="mi">1441285706148429853</span> <span class="o">|</span>
<span class="o">|</span> <span class="mi">29502429</span> <span class="o">|</span> <span class="mi">48100551</span>  <span class="o">|</span> <span class="mi">10007</span>     <span class="o">|</span> <span class="mi">2</span>       <span class="o">|</span> <span class="mi">0</span>           <span class="o">|</span> <span class="o">-</span><span class="mi">1</span>                <span class="o">|</span> <span class="mi">0</span>                     <span class="o">|</span> <span class="o">-</span><span class="mi">1</span>               <span class="o">|</span> <span class="mi">0</span>                    <span class="o">|</span> <span class="n">N</span><span class="o">/</span><span class="n">A</span>           <span class="o">|</span> <span class="mi">784</span>      <span class="o">|</span> <span class="mi">0</span>        <span class="o">|</span> <span class="n">NORMAL</span> <span class="o">|</span> <span class="n">N</span><span class="o">/</span><span class="n">A</span>                     <span class="o">|</span> <span class="o">-</span><span class="mi">1</span>           <span class="o">|</span> 	<span class="o">-</span><span class="mi">1</span>               <span class="o">|</span> <span class="mi">2</span>            <span class="o">|</span> <span class="o">-</span><span class="mi">4784691547051455525</span> <span class="o">|</span>
<span class="o">+----------+-----------+-----------+---------+-------------+-------------------+-----------------------+------------------+----------------------+---------------+----------+----------+--------+-------------------------+--------------+-----------------</span>	<span class="o">-+--------------+----------------------+</span>  
</pre></div>
</div>
<p>The figure above shows some additional information, including copy size, number of rows, number of versions, where the data path is located.</p>
<blockquote>
<div><p>Note: The contents of the `State’column shown here do not represent the health status of the replica, but the status of the replica under certain tasks, such as CLONE, SCHEMA CHANGE, ROLLUP, etc.</p>
</div></blockquote>
<p>In addition, users can check the distribution of replicas in a specified table or partition by following commands.</p>
<p><code class="docutils literal notranslate"><span class="pre">ADMIN</span> <span class="pre">SHOW</span> <span class="pre">REPLICA</span> <span class="pre">DISTRIBUTION</span> <span class="pre">FROM</span> <span class="pre">tbl1;</span></code></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">+-----------+------------+-------+---------+</span>
<span class="o">|</span> <span class="n">BackendId</span> <span class="o">|</span> <span class="n">ReplicaNum</span> <span class="o">|</span> <span class="n">Graph</span> <span class="o">|</span> <span class="n">Percent</span> <span class="o">|</span>
<span class="o">+-----------+------------+-------+---------+</span>
<span class="o">|</span> <span class="mi">10000</span>     <span class="o">|</span> <span class="mi">7</span>          <span class="o">|</span>       <span class="o">|</span> <span class="mf">7.29</span> <span class="o">%</span>  <span class="o">|</span>
<span class="o">|</span> <span class="mi">10001</span>     <span class="o">|</span> <span class="mi">9</span>          <span class="o">|</span>       <span class="o">|</span> <span class="mf">9.38</span> <span class="o">%</span>  <span class="o">|</span>
<span class="o">|</span> <span class="mi">10002</span>     <span class="o">|</span> <span class="mi">7</span>          <span class="o">|</span>       <span class="o">|</span> <span class="mf">7.29</span> <span class="o">%</span>  <span class="o">|</span>
<span class="o">|</span> <span class="mi">10003</span>     <span class="o">|</span> <span class="mi">7</span>          <span class="o">|</span>       <span class="o">|</span> <span class="mf">7.29</span> <span class="o">%</span>  <span class="o">|</span>
<span class="o">|</span> <span class="mi">10004</span>     <span class="o">|</span> <span class="mi">9</span>          <span class="o">|</span>       <span class="o">|</span> <span class="mf">9.38</span> <span class="o">%</span>  <span class="o">|</span>
<span class="o">|</span> <span class="mi">10005</span>     <span class="o">|</span> <span class="mi">11</span>         <span class="o">|</span> <span class="o">&gt;</span>     <span class="o">|</span> <span class="mf">11.46</span> <span class="o">%</span> <span class="o">|</span>
<span class="o">|</span> <span class="mi">10006</span>     <span class="o">|</span> <span class="mi">18</span>         <span class="o">|</span> <span class="o">&gt;</span>     <span class="o">|</span> <span class="mf">18.75</span> <span class="o">%</span> <span class="o">|</span>
<span class="o">|</span> <span class="mi">10007</span>     <span class="o">|</span> <span class="mi">15</span>         <span class="o">|</span> <span class="o">&gt;</span>     <span class="o">|</span> <span class="mf">15.62</span> <span class="o">%</span> <span class="o">|</span>
<span class="o">|</span> <span class="mi">10008</span>     <span class="o">|</span> <span class="mi">13</span>         <span class="o">|</span> <span class="o">&gt;</span>     <span class="o">|</span> <span class="mf">13.54</span> <span class="o">%</span> <span class="o">|</span>
<span class="o">+-----------+------------+-------+---------+</span>
</pre></div>
</div>
<p>Here we show the number and percentage of replicas of table tbl1 on each BE node, as well as a simple graphical display.</p>
</li>
<li><p class="first">Tablet level status checking</p>
<p>When we want to locate a specific Tablet, we can use the following command to view the status of a specific Tablet. For example, check the tablet with ID 2950253:</p>
<p><code class="docutils literal notranslate"><span class="pre">SHOW</span> <span class="pre">TABLET</span> <span class="pre">29502553;</span></code></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">+------------------------+-----------+---------------+-----------+----------+----------+-------------+----------+--------+---------------------------------------------------------------------------+</span>
<span class="o">|</span> <span class="n">DbName</span>                 <span class="o">|</span> <span class="n">TableName</span> <span class="o">|</span> <span class="n">PartitionName</span> <span class="o">|</span> <span class="n">IndexName</span> <span class="o">|</span> <span class="n">DbId</span>     <span class="o">|</span> <span class="n">TableId</span>  <span class="o">|</span> <span class="n">PartitionId</span> <span class="o">|</span> <span class="n">IndexId</span>  <span class="o">|</span> <span class="n">IsSync</span> <span class="o">|</span> <span class="n">DetailCmd</span>                                                                 <span class="o">|</span>
<span class="o">+------------------------+-----------+---------------+-----------+----------+----------+-------------+----------+--------+---------------------------------------------------------------------------+</span>
<span class="o">|</span> <span class="n">default_cluster</span><span class="p">:</span><span class="n">test</span>   <span class="o">|</span> <span class="n">test</span>      <span class="o">|</span> <span class="n">test</span>          <span class="o">|</span> <span class="n">test</span>      <span class="o">|</span> <span class="mi">29502391</span> <span class="o">|</span> <span class="mi">29502428</span> <span class="o">|</span> <span class="mi">29502427</span>    <span class="o">|</span> <span class="mi">29502428</span> <span class="o">|</span> <span class="n">true</span>   <span class="o">|</span> <span class="n">SHOW</span> <span class="n">PROC</span> <span class="s1">&#39;/dbs/29502391/29502428/partitions/29502427/29502428/29502553&#39;</span><span class="p">;</span> <span class="o">|</span>
<span class="o">+------------------------+-----------+---------------+-----------+----------+----------+-------------+----------+--------+---------------------------------------------------------------------------+</span>
</pre></div>
</div>
<p>The figure above shows the database, tables, partitions, roll-up tables and other information corresponding to this tablet. The user can copy the command in the <code class="docutils literal notranslate"><span class="pre">DetailCmd</span></code> command to continue executing:</p>
<p><code class="docutils literal notranslate"><span class="pre">Show</span> <span class="pre">Proc'/DBS/29502391/29502428/Partitions/29502427/29502428/29502553;</span></code></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">+-----------+-----------+---------+-------------+-------------------+-----------------------+------------------+----------------------+---------------+------------+----------+----------+--------+-------+--------------+----------------------+</span>
<span class="o">|</span> <span class="n">ReplicaId</span> <span class="o">|</span> <span class="n">BackendId</span> <span class="o">|</span> <span class="n">Version</span> <span class="o">|</span> <span class="n">VersionHash</span> <span class="o">|</span> <span class="n">LstSuccessVersion</span> <span class="o">|</span> <span class="n">LstSuccessVersionHash</span> <span class="o">|</span> <span class="n">LstFailedVersion</span> <span class="o">|</span> <span class="n">LstFailedVersionHash</span> <span class="o">|</span> <span class="n">LstFailedTime</span> <span class="o">|</span> <span class="n">SchemaHash</span> <span class="o">|</span> <span class="n">DataSize</span> <span class="o">|</span> <span class="n">RowCount</span> <span class="o">|</span> <span class="n">State</span>  <span class="o">|</span> <span class="n">IsBad</span> <span class="o">|</span> <span class="n">VersionCount</span> <span class="o">|</span> <span class="n">PathHash</span>             <span class="o">|</span>
<span class="o">+-----------+-----------+---------+-------------+-------------------+-----------------------+------------------+----------------------+---------------+------------+----------+----------+--------+-------+--------------+----------------------+</span>
<span class="o">|</span> <span class="mi">43734060</span>  <span class="o">|</span> <span class="mi">10004</span>     <span class="o">|</span> <span class="mi">2</span>       <span class="o">|</span> <span class="mi">0</span>           <span class="o">|</span> <span class="o">-</span><span class="mi">1</span>                <span class="o">|</span> <span class="mi">0</span>                     <span class="o">|</span> <span class="o">-</span><span class="mi">1</span>               <span class="o">|</span> <span class="mi">0</span>                    <span class="o">|</span> <span class="n">N</span><span class="o">/</span><span class="n">A</span>           <span class="o">|</span> <span class="o">-</span><span class="mi">1</span>         <span class="o">|</span> <span class="mi">784</span>      <span class="o">|</span> <span class="mi">0</span>        <span class="o">|</span> <span class="n">NORMAL</span> <span class="o">|</span> <span class="n">false</span> <span class="o">|</span> <span class="mi">2</span>            <span class="o">|</span> <span class="o">-</span><span class="mi">8566523878520798656</span> <span class="o">|</span>
<span class="o">|</span> <span class="mi">29502555</span>  <span class="o">|</span> <span class="mi">10002</span>     <span class="o">|</span> <span class="mi">2</span>       <span class="o">|</span> <span class="mi">0</span>           <span class="o">|</span> <span class="mi">2</span>                 <span class="o">|</span> <span class="mi">0</span>                     <span class="o">|</span> <span class="o">-</span><span class="mi">1</span>               <span class="o">|</span> <span class="mi">0</span>                    <span class="o">|</span> <span class="n">N</span><span class="o">/</span><span class="n">A</span>           <span class="o">|</span> <span class="o">-</span><span class="mi">1</span>         <span class="o">|</span> <span class="mi">784</span>      <span class="o">|</span> <span class="mi">0</span>        <span class="o">|</span> <span class="n">NORMAL</span> <span class="o">|</span> <span class="n">false</span> <span class="o">|</span> <span class="mi">2</span>            <span class="o">|</span> <span class="mi">1885826196444191611</span>  <span class="o">|</span>
<span class="o">|</span> <span class="mi">39279319</span>  <span class="o">|</span> <span class="mi">10007</span>     <span class="o">|</span> <span class="mi">2</span>       <span class="o">|</span> <span class="mi">0</span>           <span class="o">|</span> <span class="o">-</span><span class="mi">1</span>                <span class="o">|</span> <span class="mi">0</span>                     <span class="o">|</span> <span class="o">-</span><span class="mi">1</span>               <span class="o">|</span> <span class="mi">0</span>                    <span class="o">|</span> <span class="n">N</span><span class="o">/</span><span class="n">A</span>           <span class="o">|</span> <span class="o">-</span><span class="mi">1</span>         <span class="o">|</span> <span class="mi">784</span>      <span class="o">|</span> <span class="mi">0</span>        <span class="o">|</span> <span class="n">NORMAL</span> <span class="o">|</span> <span class="n">false</span> <span class="o">|</span> <span class="mi">2</span>            <span class="o">|</span> <span class="mi">1656508631294397870</span>  <span class="o">|</span>
<span class="o">+-----------+-----------+---------+-------------+-------------------+-----------------------+------------------+----------------------+---------------+------------+----------+----------+--------+-------+--------------+----------------------+</span>
</pre></div>
</div>
<p>The figure above shows all replicas of the corresponding Tablet. The content shown here is the same as <code class="docutils literal notranslate"><span class="pre">SHOW</span> <span class="pre">TABLET</span> <span class="pre">FROM</span> <span class="pre">tbl1;</span></code>. But here you can clearly see the status of all copies of a specific Tablet.</p>
</li>
</ol>
</div>
<div class="section" id="duplicate-scheduling-task">
<h3>Duplicate Scheduling Task<a class="headerlink" href="#duplicate-scheduling-task" title="Permalink to this headline">¶</a></h3>
<ol>
<li><p class="first">View tasks waiting to be scheduled</p>
<p><code class="docutils literal notranslate"><span class="pre">SHOW</span> <span class="pre">PROC</span> <span class="pre">'/cluster_balance/pending_tablets';</span></code></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">+----------+--------+-----------------+---------+----------+----------+-------+---------+--------+----------+---------+---------------------+---------------------+---------------------+----------+------+-------------+---------------+---------------------+------------+---------------------+--------+---------------------+-------------------------------+</span>
<span class="o">|</span> <span class="n">TabletId</span> <span class="o">|</span> <span class="n">Type</span>   <span class="o">|</span> <span class="n">Status</span>          <span class="o">|</span> <span class="n">State</span>   <span class="o">|</span> <span class="n">OrigPrio</span> <span class="o">|</span> <span class="n">DynmPrio</span> <span class="o">|</span> <span class="n">SrcBe</span> <span class="o">|</span> <span class="n">SrcPath</span> <span class="o">|</span> <span class="n">DestBe</span> <span class="o">|</span> <span class="n">DestPath</span> <span class="o">|</span> <span class="n">Timeout</span> <span class="o">|</span> <span class="n">Create</span>              <span class="o">|</span> <span class="n">LstSched</span>            <span class="o">|</span> <span class="n">LstVisit</span>            <span class="o">|</span> <span class="n">Finished</span> <span class="o">|</span> <span class="n">Rate</span> <span class="o">|</span> <span class="n">FailedSched</span> <span class="o">|</span> <span class="n">FailedRunning</span> <span class="o">|</span> <span class="n">LstAdjPrio</span>          <span class="o">|</span> <span class="n">VisibleVer</span> <span class="o">|</span> <span class="n">VisibleVerHash</span>      <span class="o">|</span> <span class="n">CmtVer</span> <span class="o">|</span> <span class="n">CmtVerHash</span>          <span class="o">|</span> <span class="n">ErrMsg</span>                        <span class="o">|</span>
<span class="o">+----------+--------+-----------------+---------+----------+----------+-------+---------+--------+----------+---------+---------------------+---------------------+---------------------+----------+------+-------------+---------------+---------------------+------------+---------------------+--------+---------------------+-------------------------------+</span>
<span class="o">|</span> <span class="mi">4203036</span>  <span class="o">|</span> <span class="n">REPAIR</span> <span class="o">|</span> <span class="n">REPLICA_MISSING</span> <span class="o">|</span> <span class="n">PENDING</span> <span class="o">|</span> <span class="n">HIGH</span>     <span class="o">|</span> <span class="n">LOW</span>      <span class="o">|</span> <span class="o">-</span><span class="mi">1</span>    <span class="o">|</span> <span class="o">-</span><span class="mi">1</span>      <span class="o">|</span> <span class="o">-</span><span class="mi">1</span>     <span class="o">|</span> <span class="o">-</span><span class="mi">1</span>       <span class="o">|</span> <span class="mi">0</span>       <span class="o">|</span> <span class="mi">2019</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">21</span> <span class="mi">15</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">20</span> <span class="o">|</span> <span class="mi">2019</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">24</span> <span class="mi">11</span><span class="p">:</span><span class="mi">18</span><span class="p">:</span><span class="mi">41</span> <span class="o">|</span> <span class="mi">2019</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">24</span> <span class="mi">11</span><span class="p">:</span><span class="mi">18</span><span class="p">:</span><span class="mi">41</span> <span class="o">|</span> <span class="n">N</span><span class="o">/</span><span class="n">A</span>      <span class="o">|</span> <span class="n">N</span><span class="o">/</span><span class="n">A</span>  <span class="o">|</span> <span class="mi">2</span>           <span class="o">|</span> <span class="mi">0</span>             <span class="o">|</span> <span class="mi">2019</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">21</span> <span class="mi">15</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">43</span> <span class="o">|</span> <span class="mi">1</span>          <span class="o">|</span> <span class="mi">0</span>                   <span class="o">|</span> <span class="mi">2</span>      <span class="o">|</span> <span class="mi">0</span>                   <span class="o">|</span> <span class="n">unable</span> <span class="n">to</span> <span class="n">find</span> <span class="n">source</span> <span class="n">replica</span> <span class="o">|</span>
<span class="o">+----------+--------+-----------------+---------+----------+----------+-------+---------+--------+----------+---------+---------------------+---------------------+---------------------+----------+------+-------------+---------------+---------------------+------------+---------------------+--------+---------------------+-------------------------------+</span>
</pre></div>
</div>
<p>The specific meanings of each column are as follows:</p>
<ul class="simple">
<li>TabletId: The ID of the Tablet waiting to be scheduled. A scheduling task is for only one Tablet</li>
<li>Type: Task type, which can be REPAIR (repair) or BALANCE (balance)</li>
<li>Status: The current status of the Tablet, such as REPLICAMISSING (copy missing)</li>
<li>State: The status of the scheduling task may be PENDING/RUNNING/FINISHED/CANCELLED/TIMEOUT/UNEXPECTED</li>
<li>OrigPrio: Initial Priority</li>
<li>DynmPrio: Current dynamically adjusted priority</li>
<li>SrcBe: ID of the BE node at the source end</li>
<li>SrcPath: hash value of the path of the BE node at the source end</li>
<li>DestBe: ID of destination BE node</li>
<li>DestPath: hash value of the path of the destination BE node</li>
<li>Timeout: When the task is scheduled successfully, the timeout time of the task is displayed here in units of seconds.</li>
<li>Create: The time when the task was created</li>
<li>LstSched: The last time a task was scheduled</li>
<li>LstVisit: The last time a task was accessed. Here “accessed” refers to the processing time points associated with the task, including scheduling, task execution reporting, and so on.</li>
<li>Finished: Task End Time</li>
<li>Rate: Clone Task Data Copy Rate</li>
<li>Failed Sched: Number of Task Scheduling Failures</li>
<li>Failed Running: Number of task execution failures</li>
<li>LstAdjPrio: Time of last priority adjustment</li>
<li>CmtVer/CmtVerHash/VisibleVer/VisibleVerHash: version information for clone tasks</li>
<li>ErrMsg: Error messages that occur when tasks are scheduled and run</li>
</ul>
</li>
<li><p class="first">View running tasks</p>
<p><code class="docutils literal notranslate"><span class="pre">SHOW</span> <span class="pre">PROC</span> <span class="pre">'/cluster_balance/running_tablets';</span></code></p>
<p>The columns in the result have the same meaning as <code class="docutils literal notranslate"><span class="pre">pending_tablets</span></code>.</p>
</li>
<li><p class="first">View completed tasks</p>
<p><code class="docutils literal notranslate"><span class="pre">SHOW</span> <span class="pre">PROC</span> <span class="pre">'/cluster_balance/history_tablets';</span></code></p>
<p>By default, we reserve only the last 1,000 completed tasks. The columns in the result have the same meaning as <code class="docutils literal notranslate"><span class="pre">pending_tablets</span></code>. If <code class="docutils literal notranslate"><span class="pre">State</span></code> is listed as <code class="docutils literal notranslate"><span class="pre">FINISHED</span></code>, the task is normally completed. For others, you can see the specific reason based on the error information in the <code class="docutils literal notranslate"><span class="pre">ErrMsg</span></code> column.</p>
</li>
</ol>
</div>
</div>
<div class="section" id="viewing-cluster-load-and-scheduling-resources">
<h2>Viewing Cluster Load and Scheduling Resources<a class="headerlink" href="#viewing-cluster-load-and-scheduling-resources" title="Permalink to this headline">¶</a></h2>
<ol>
<li><p class="first">Cluster load</p>
<p>You can view the current load of the cluster by following commands:</p>
<p><code class="docutils literal notranslate"><span class="pre">SHOW</span> <span class="pre">PROC</span> <span class="pre">'/cluster_balance/cluster_load_stat';</span></code></p>
<p>First of all, we can see the division of different storage media:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">+---------------+</span>
<span class="o">|</span> <span class="n">StorageMedium</span> <span class="o">|</span>
<span class="o">+---------------+</span>
<span class="o">|</span> <span class="n">HDD</span>           <span class="o">|</span>
<span class="o">|</span> <span class="n">SSD</span>           <span class="o">|</span>
<span class="o">+---------------+</span>
</pre></div>
</div>
<p>Click on a storage medium to see the equilibrium state of the BE node that contains the storage medium:</p>
<p><code class="docutils literal notranslate"><span class="pre">SHOW</span> <span class="pre">PROC</span> <span class="pre">'/cluster_balance/cluster_load_stat/HDD';</span></code></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">+----------+-----------------+-----------+---------------+----------------+-------------+------------+----------+-----------+--------------------+-------+</span>
<span class="o">|</span> <span class="n">BeId</span>     <span class="o">|</span> <span class="n">Cluster</span>         <span class="o">|</span> <span class="n">Available</span> <span class="o">|</span> <span class="n">UsedCapacity</span>  <span class="o">|</span> <span class="n">Capacity</span>       <span class="o">|</span> <span class="n">UsedPercent</span> <span class="o">|</span> <span class="n">ReplicaNum</span> <span class="o">|</span> <span class="n">CapCoeff</span> <span class="o">|</span> <span class="n">ReplCoeff</span> <span class="o">|</span> <span class="n">Score</span>              <span class="o">|</span> <span class="n">Class</span> <span class="o">|</span>
<span class="o">+----------+-----------------+-----------+---------------+----------------+-------------+------------+----------+-----------+--------------------+-------+</span>
<span class="o">|</span> <span class="mi">10003</span>    <span class="o">|</span> <span class="n">default_cluster</span> <span class="o">|</span> <span class="n">true</span>      <span class="o">|</span> <span class="mi">3477875259079</span> <span class="o">|</span> <span class="mi">19377459077121</span> <span class="o">|</span> <span class="mf">17.948</span>      <span class="o">|</span> <span class="mi">493477</span>     <span class="o">|</span> <span class="mf">0.5</span>      <span class="o">|</span> <span class="mf">0.5</span>       <span class="o">|</span> <span class="mf">0.9284678149967587</span> <span class="o">|</span> <span class="n">MID</span>   <span class="o">|</span>
<span class="o">|</span> <span class="mi">10002</span>    <span class="o">|</span> <span class="n">default_cluster</span> <span class="o">|</span> <span class="n">true</span>      <span class="o">|</span> <span class="mi">3607326225443</span> <span class="o">|</span> <span class="mi">19377459077121</span> <span class="o">|</span> <span class="mf">18.616</span>      <span class="o">|</span> <span class="mi">496928</span>     <span class="o">|</span> <span class="mf">0.5</span>      <span class="o">|</span> <span class="mf">0.5</span>       <span class="o">|</span> <span class="mf">0.948660871419998</span>  <span class="o">|</span> <span class="n">MID</span>   <span class="o">|</span>
<span class="o">|</span> <span class="mi">10005</span>    <span class="o">|</span> <span class="n">default_cluster</span> <span class="o">|</span> <span class="n">true</span>      <span class="o">|</span> <span class="mi">3523518578241</span> <span class="o">|</span> <span class="mi">19377459077121</span> <span class="o">|</span> <span class="mf">18.184</span>      <span class="o">|</span> <span class="mi">545331</span>     <span class="o">|</span> <span class="mf">0.5</span>      <span class="o">|</span> <span class="mf">0.5</span>       <span class="o">|</span> <span class="mf">0.9843539990641831</span> <span class="o">|</span> <span class="n">MID</span>   <span class="o">|</span>
<span class="o">|</span> <span class="mi">10001</span>    <span class="o">|</span> <span class="n">default_cluster</span> <span class="o">|</span> <span class="n">true</span>      <span class="o">|</span> <span class="mi">3535547090016</span> <span class="o">|</span> <span class="mi">19377459077121</span> <span class="o">|</span> <span class="mf">18.246</span>      <span class="o">|</span> <span class="mi">558067</span>     <span class="o">|</span> <span class="mf">0.5</span>      <span class="o">|</span> <span class="mf">0.5</span>       <span class="o">|</span> <span class="mf">0.9981869446537612</span> <span class="o">|</span> <span class="n">MID</span>   <span class="o">|</span>
<span class="o">|</span> <span class="mi">10006</span>    <span class="o">|</span> <span class="n">default_cluster</span> <span class="o">|</span> <span class="n">true</span>      <span class="o">|</span> <span class="mi">3636050364835</span> <span class="o">|</span> <span class="mi">19377459077121</span> <span class="o">|</span> <span class="mf">18.764</span>      <span class="o">|</span> <span class="mi">547543</span>     <span class="o">|</span> <span class="mf">0.5</span>      <span class="o">|</span> <span class="mf">0.5</span>       <span class="o">|</span> <span class="mf">1.0011489897614072</span> <span class="o">|</span> <span class="n">MID</span>   <span class="o">|</span>
<span class="o">|</span> <span class="mi">10004</span>    <span class="o">|</span> <span class="n">default_cluster</span> <span class="o">|</span> <span class="n">true</span>      <span class="o">|</span> <span class="mi">3506558163744</span> <span class="o">|</span> <span class="mi">15501967261697</span> <span class="o">|</span> <span class="mf">22.620</span>      <span class="o">|</span> <span class="mi">468957</span>     <span class="o">|</span> <span class="mf">0.5</span>      <span class="o">|</span> <span class="mf">0.5</span>       <span class="o">|</span> <span class="mf">1.0228319835582569</span> <span class="o">|</span> <span class="n">MID</span>   <span class="o">|</span>
<span class="o">|</span> <span class="mi">10007</span>    <span class="o">|</span> <span class="n">default_cluster</span> <span class="o">|</span> <span class="n">true</span>      <span class="o">|</span> <span class="mi">4036460478905</span> <span class="o">|</span> <span class="mi">19377459077121</span> <span class="o">|</span> <span class="mf">20.831</span>      <span class="o">|</span> <span class="mi">551645</span>     <span class="o">|</span> <span class="mf">0.5</span>      <span class="o">|</span> <span class="mf">0.5</span>       <span class="o">|</span> <span class="mf">1.057279369420761</span>  <span class="o">|</span> <span class="n">MID</span>   <span class="o">|</span>
<span class="o">|</span> <span class="mi">10000</span>    <span class="o">|</span> <span class="n">default_cluster</span> <span class="o">|</span> <span class="n">true</span>      <span class="o">|</span> <span class="mi">4369719923760</span> <span class="o">|</span> <span class="mi">19377459077121</span> <span class="o">|</span> <span class="mf">22.551</span>      <span class="o">|</span> <span class="mi">547175</span>     <span class="o">|</span> <span class="mf">0.5</span>      <span class="o">|</span> <span class="mf">0.5</span>       <span class="o">|</span> <span class="mf">1.0964036415787461</span> <span class="o">|</span> <span class="n">MID</span>   <span class="o">|</span>
<span class="o">+----------+-----------------+-----------+---------------+----------------+-------------+------------+----------+-----------+--------------------+-------+</span>
</pre></div>
</div>
<p>Some of these columns have the following meanings:</p>
<ul class="simple">
<li>Available: True means that BE heartbeat is normal and not offline.</li>
<li>UsedCapacity: Bytes, the size of disk space used on BE</li>
<li>Capacity: Bytes, the total disk space size on BE</li>
<li>UsedPercent: Percentage, disk space utilization on BE</li>
<li>ReplicaNum: Number of copies on BE</li>
<li>CapCoeff/ReplCoeff: Weight Coefficient of Disk Space and Copy Number</li>
<li>Score: Load score. The higher the score, the heavier the load.</li>
<li>Class: Classified by load, LOW/MID/HIGH. Balanced scheduling moves copies from high-load nodes to low-load nodes</li>
</ul>
<p>Users can further view the utilization of each path on a BE, such as the BE with ID 10001:</p>
<p><code class="docutils literal notranslate"><span class="pre">SHOW</span> <span class="pre">PROC</span> <span class="pre">'/cluster_balance/cluster_load_stat/HDD/10001';</span></code></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">+------------------+------------------+---------------+---------------+---------+--------+----------------------+</span>
<span class="o">|</span> <span class="n">RootPath</span>         <span class="o">|</span> <span class="n">DataUsedCapacity</span> <span class="o">|</span> <span class="n">AvailCapacity</span> <span class="o">|</span> <span class="n">TotalCapacity</span> <span class="o">|</span> <span class="n">UsedPct</span> <span class="o">|</span> <span class="n">State</span>  <span class="o">|</span> <span class="n">PathHash</span>             <span class="o">|</span>
<span class="o">+------------------+------------------+---------------+---------------+---------+--------+----------------------+</span>
<span class="o">|</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">disk4</span><span class="o">/</span><span class="n">palo</span> <span class="o">|</span> <span class="mf">498.757</span> <span class="n">GB</span>       <span class="o">|</span> <span class="mf">3.033</span> <span class="n">TB</span>      <span class="o">|</span> <span class="mf">3.525</span> <span class="n">TB</span>      <span class="o">|</span> <span class="mf">13.94</span> <span class="o">%</span> <span class="o">|</span> <span class="n">ONLINE</span> <span class="o">|</span> <span class="mi">4883406271918338267</span>  <span class="o">|</span>
<span class="o">|</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">disk3</span><span class="o">/</span><span class="n">palo</span> <span class="o">|</span> <span class="mf">704.200</span> <span class="n">GB</span>       <span class="o">|</span> <span class="mf">2.832</span> <span class="n">TB</span>      <span class="o">|</span> <span class="mf">3.525</span> <span class="n">TB</span>      <span class="o">|</span> <span class="mf">19.65</span> <span class="o">%</span> <span class="o">|</span> <span class="n">ONLINE</span> <span class="o">|</span> <span class="o">-</span><span class="mi">5467083960906519443</span> <span class="o">|</span>
<span class="o">|</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">disk1</span><span class="o">/</span><span class="n">palo</span> <span class="o">|</span> <span class="mf">512.833</span> <span class="n">GB</span>       <span class="o">|</span> <span class="mf">3.007</span> <span class="n">TB</span>      <span class="o">|</span> <span class="mf">3.525</span> <span class="n">TB</span>      <span class="o">|</span> <span class="mf">14.69</span> <span class="o">%</span> <span class="o">|</span> <span class="n">ONLINE</span> <span class="o">|</span> <span class="o">-</span><span class="mi">7733211489989964053</span> <span class="o">|</span>
<span class="o">|</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">disk2</span><span class="o">/</span><span class="n">palo</span> <span class="o">|</span> <span class="mf">881.955</span> <span class="n">GB</span>       <span class="o">|</span> <span class="mf">2.656</span> <span class="n">TB</span>      <span class="o">|</span> <span class="mf">3.525</span> <span class="n">TB</span>      <span class="o">|</span> <span class="mf">24.65</span> <span class="o">%</span> <span class="o">|</span> <span class="n">ONLINE</span> <span class="o">|</span> <span class="mi">4870995507205544622</span>  <span class="o">|</span>
<span class="o">|</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">disk5</span><span class="o">/</span><span class="n">palo</span> <span class="o">|</span> <span class="mf">694.992</span> <span class="n">GB</span>       <span class="o">|</span> <span class="mf">2.842</span> <span class="n">TB</span>      <span class="o">|</span> <span class="mf">3.525</span> <span class="n">TB</span>      <span class="o">|</span> <span class="mf">19.36</span> <span class="o">%</span> <span class="o">|</span> <span class="n">ONLINE</span> <span class="o">|</span> <span class="mi">1916696897889786739</span>  <span class="o">|</span>
<span class="o">+------------------+------------------+---------------+---------------+---------+--------+----------------------+</span>
</pre></div>
</div>
<p>The disk usage of each data path on the specified BE is shown here.</p>
</li>
<li><p class="first">Scheduling resources</p>
<p>Users can view the current slot usage of each node through the following commands:</p>
<p><code class="docutils literal notranslate"><span class="pre">SHOW</span> <span class="pre">PROC</span> <span class="pre">'/cluster_balance/working_slots';</span></code></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">+----------+----------------------+------------+------------+-------------+----------------------+</span>
<span class="o">|</span> <span class="n">BeId</span>     <span class="o">|</span> <span class="n">PathHash</span>             <span class="o">|</span> <span class="n">AvailSlots</span> <span class="o">|</span> <span class="n">TotalSlots</span> <span class="o">|</span> <span class="n">BalanceSlot</span> <span class="o">|</span> <span class="n">AvgRate</span>              <span class="o">|</span>
<span class="o">+----------+----------------------+------------+------------+-------------+----------------------+</span>
<span class="o">|</span> <span class="mi">10000</span>    <span class="o">|</span> <span class="mi">8110346074333016794</span>  <span class="o">|</span> <span class="mi">2</span>          <span class="o">|</span> <span class="mi">2</span>          <span class="o">|</span> <span class="mi">2</span>           <span class="o">|</span> <span class="mf">2.459007474009069E7</span>  <span class="o">|</span>
<span class="o">|</span> <span class="mi">10000</span>    <span class="o">|</span> <span class="o">-</span><span class="mi">5617618290584731137</span> <span class="o">|</span> <span class="mi">2</span>          <span class="o">|</span> <span class="mi">2</span>          <span class="o">|</span> <span class="mi">2</span>           <span class="o">|</span> <span class="mf">2.4730105014001578E7</span> <span class="o">|</span>
<span class="o">|</span> <span class="mi">10001</span>    <span class="o">|</span> <span class="mi">4883406271918338267</span>  <span class="o">|</span> <span class="mi">2</span>          <span class="o">|</span> <span class="mi">2</span>          <span class="o">|</span> <span class="mi">2</span>           <span class="o">|</span> <span class="mf">1.6711402709780257E7</span> <span class="o">|</span>
<span class="o">|</span> <span class="mi">10001</span>    <span class="o">|</span> <span class="o">-</span><span class="mi">5467083960906519443</span> <span class="o">|</span> <span class="mi">2</span>          <span class="o">|</span> <span class="mi">2</span>          <span class="o">|</span> <span class="mi">2</span>           <span class="o">|</span> <span class="mf">2.7540126380326536E7</span> <span class="o">|</span>
<span class="o">|</span> <span class="mi">10002</span>    <span class="o">|</span> <span class="mi">9137404661108133814</span>  <span class="o">|</span> <span class="mi">2</span>          <span class="o">|</span> <span class="mi">2</span>          <span class="o">|</span> <span class="mi">2</span>           <span class="o">|</span> <span class="mf">2.417217089806745E7</span>  <span class="o">|</span>
<span class="o">|</span> <span class="mi">10002</span>    <span class="o">|</span> <span class="mi">1885826196444191611</span>  <span class="o">|</span> <span class="mi">2</span>          <span class="o">|</span> <span class="mi">2</span>          <span class="o">|</span> <span class="mi">2</span>           <span class="o">|</span> <span class="mf">1.6327378456676323E7</span> <span class="o">|</span>
<span class="o">+----------+----------------------+------------+------------+-------------+----------------------+</span>
</pre></div>
</div>
<p>In this paper, data path is used as granularity to show the current use of slot. Among them, `AvgRate’is the copy rate of clone task in bytes/seconds on the path of historical statistics.</p>
</li>
<li><p class="first">Priority repair view</p>
<p>The following command allows you to view the priority repaired tables or partitions set by the `ADMIN REPAIR TABLE’command.</p>
<p><code class="docutils literal notranslate"><span class="pre">SHOW</span> <span class="pre">PROC</span> <span class="pre">'/cluster_balance/priority_repair'</span></code>;</p>
<p>Among them, `Remaining TimeMs’indicates that these priority fixes will be automatically removed from the priority fix queue after this time. In order to prevent resources from being occupied due to the failure of priority repair.</p>
</li>
</ol>
<div class="section" id="scheduler-statistical-status-view">
<h3>Scheduler Statistical Status View<a class="headerlink" href="#scheduler-statistical-status-view" title="Permalink to this headline">¶</a></h3>
<p>We have collected some statistics of Tablet Checker and Tablet Scheduler during their operation, which can be viewed through the following commands:</p>
<p><code class="docutils literal notranslate"><span class="pre">SHOW</span> <span class="pre">PROC</span> <span class="pre">'/cluster_balance/sched_stat'</span></code>;</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">+---------------------------------------------------+-------------+</span>
<span class="o">|</span> <span class="n">Item</span>                                              <span class="o">|</span> <span class="n">Value</span>       <span class="o">|</span>
<span class="o">+---------------------------------------------------+-------------+</span>
<span class="o">|</span> <span class="n">num</span> <span class="n">of</span> <span class="n">tablet</span> <span class="n">check</span> <span class="nb">round</span>                         <span class="o">|</span> <span class="mi">12041</span>       <span class="o">|</span>
<span class="o">|</span> <span class="n">cost</span> <span class="n">of</span> <span class="n">tablet</span> <span class="n">check</span><span class="p">(</span><span class="n">ms</span><span class="p">)</span>                          <span class="o">|</span> <span class="mi">7162342</span>     <span class="o">|</span>
<span class="o">|</span> <span class="n">num</span> <span class="n">of</span> <span class="n">tablet</span> <span class="n">checked</span> <span class="ow">in</span> <span class="n">tablet</span> <span class="n">checker</span>           <span class="o">|</span> <span class="mi">18793506362</span> <span class="o">|</span>
<span class="o">|</span> <span class="n">num</span> <span class="n">of</span> <span class="n">unhealthy</span> <span class="n">tablet</span> <span class="n">checked</span> <span class="ow">in</span> <span class="n">tablet</span> <span class="n">checker</span> <span class="o">|</span> <span class="mi">7043900</span>     <span class="o">|</span>
<span class="o">|</span> <span class="n">num</span> <span class="n">of</span> <span class="n">tablet</span> <span class="n">being</span> <span class="n">added</span> <span class="n">to</span> <span class="n">tablet</span> <span class="n">scheduler</span>     <span class="o">|</span> <span class="mi">1153</span>        <span class="o">|</span>
<span class="o">|</span> <span class="n">num</span> <span class="n">of</span> <span class="n">tablet</span> <span class="n">schedule</span> <span class="nb">round</span>                      <span class="o">|</span> <span class="mi">49538</span>       <span class="o">|</span>
<span class="o">|</span> <span class="n">cost</span> <span class="n">of</span> <span class="n">tablet</span> <span class="n">schedule</span><span class="p">(</span><span class="n">ms</span><span class="p">)</span>                       <span class="o">|</span> <span class="mi">49822</span>       <span class="o">|</span>
<span class="o">|</span> <span class="n">num</span> <span class="n">of</span> <span class="n">tablet</span> <span class="n">being</span> <span class="n">scheduled</span>                     <span class="o">|</span> <span class="mi">4356200</span>     <span class="o">|</span>
<span class="o">|</span> <span class="n">num</span> <span class="n">of</span> <span class="n">tablet</span> <span class="n">being</span> <span class="n">scheduled</span> <span class="n">succeeded</span>           <span class="o">|</span> <span class="mi">320</span>         <span class="o">|</span>
<span class="o">|</span> <span class="n">num</span> <span class="n">of</span> <span class="n">tablet</span> <span class="n">being</span> <span class="n">scheduled</span> <span class="n">failed</span>              <span class="o">|</span> <span class="mi">4355594</span>     <span class="o">|</span>
<span class="o">|</span> <span class="n">num</span> <span class="n">of</span> <span class="n">tablet</span> <span class="n">being</span> <span class="n">scheduled</span> <span class="n">discard</span>             <span class="o">|</span> <span class="mi">286</span>         <span class="o">|</span>
<span class="o">|</span> <span class="n">num</span> <span class="n">of</span> <span class="n">tablet</span> <span class="n">priority</span> <span class="n">upgraded</span>                   <span class="o">|</span> <span class="mi">0</span>           <span class="o">|</span>
<span class="o">|</span> <span class="n">num</span> <span class="n">of</span> <span class="n">tablet</span> <span class="n">priority</span> <span class="n">downgraded</span>                 <span class="o">|</span> <span class="mi">1096</span>        <span class="o">|</span>
<span class="o">|</span> <span class="n">num</span> <span class="n">of</span> <span class="n">clone</span> <span class="n">task</span>                                 <span class="o">|</span> <span class="mi">230</span>         <span class="o">|</span>
<span class="o">|</span> <span class="n">num</span> <span class="n">of</span> <span class="n">clone</span> <span class="n">task</span> <span class="n">succeeded</span>                       <span class="o">|</span> <span class="mi">228</span>         <span class="o">|</span>
<span class="o">|</span> <span class="n">num</span> <span class="n">of</span> <span class="n">clone</span> <span class="n">task</span> <span class="n">failed</span>                          <span class="o">|</span> <span class="mi">2</span>           <span class="o">|</span>
<span class="o">|</span> <span class="n">num</span> <span class="n">of</span> <span class="n">clone</span> <span class="n">task</span> <span class="n">timeout</span>                         <span class="o">|</span> <span class="mi">2</span>           <span class="o">|</span>
<span class="o">|</span> <span class="n">num</span> <span class="n">of</span> <span class="n">replica</span> <span class="n">missing</span> <span class="n">error</span>                      <span class="o">|</span> <span class="mi">4354857</span>     <span class="o">|</span>
<span class="o">|</span> <span class="n">num</span> <span class="n">of</span> <span class="n">replica</span> <span class="n">version</span> <span class="n">missing</span> <span class="n">error</span>              <span class="o">|</span> <span class="mi">967</span>         <span class="o">|</span>
<span class="o">|</span> <span class="n">num</span> <span class="n">of</span> <span class="n">replica</span> <span class="n">relocating</span>                         <span class="o">|</span> <span class="mi">0</span>           <span class="o">|</span>
<span class="o">|</span> <span class="n">num</span> <span class="n">of</span> <span class="n">replica</span> <span class="n">redundant</span> <span class="n">error</span>                    <span class="o">|</span> <span class="mi">90</span>          <span class="o">|</span>
<span class="o">|</span> <span class="n">num</span> <span class="n">of</span> <span class="n">replica</span> <span class="n">missing</span> <span class="ow">in</span> <span class="n">cluster</span> <span class="n">error</span>           <span class="o">|</span> <span class="mi">0</span>           <span class="o">|</span>
<span class="o">|</span> <span class="n">num</span> <span class="n">of</span> <span class="n">balance</span> <span class="n">scheduled</span>                          <span class="o">|</span> <span class="mi">0</span>           <span class="o">|</span>
<span class="o">+---------------------------------------------------+-------------+</span>
</pre></div>
</div>
<p>The meanings of each line are as follows:</p>
<ul class="simple">
<li>num of tablet check round：Tablet Checker 检查次数</li>
<li>cost of tablet check(ms)：Tablet Checker 检查总耗时</li>
<li>num of tablet checked in tablet checker：Tablet Checker 检查过的 tablet 数量</li>
<li>num of unhealthy tablet checked in tablet checker：Tablet Checker 检查过的不健康的 tablet 数量</li>
<li>num of tablet being added to tablet scheduler：被提交到 Tablet Scheduler 中的 tablet 数量</li>
<li>num of tablet schedule round：Tablet Scheduler 运行次数</li>
<li>cost of tablet schedule(ms)：Tablet Scheduler 运行总耗时</li>
<li>num of tablet being scheduled：被调度的 Tablet 总数量</li>
<li>num of tablet being scheduled succeeded：被成功调度的 Tablet 总数量</li>
<li>num of tablet being scheduled failed：调度失败的 Tablet 总数量</li>
<li>num of tablet being scheduled discard：调度失败且被抛弃的 Tablet 总数量</li>
<li>num of tablet priority upgraded：优先级上调次数</li>
<li>num of tablet priority downgraded：优先级下调次数</li>
<li>num of clone task: number of clone tasks generated</li>
<li>num of clone task succeeded：clone 任务成功的数量</li>
<li>num of clone task failed：clone 任务失败的数量</li>
<li>num of clone task timeout：clone 任务超时的数量</li>
<li>num of replica missing error: the number of tablets whose status is checked is the missing copy</li>
<li>num of replica version missing error：检查的状态为版本缺失的 tablet 的数量（该统计值包括了 num of replica relocating 和 num of replica missing in cluster error）
*num of replica relocation <em>29366;</em> 24577;*replica relocation tablet *</li>
<li>num of replica redundant error: Number of tablets whose checked status is replica redundant</li>
<li>num of replica missing in cluster error：检查的状态为不在对应 cluster 的 tablet 的数量</li>
<li>num of balance scheduled：均衡调度的次数</li>
</ul>
<blockquote>
<div>Note: The above states are only historical accumulative values. We also print these statistics regularly in the FE logs, where the values in parentheses represent the number of changes in each statistical value since the last printing dependence of the statistical information.</div></blockquote>
</div>
</div>
<div class="section" id="relevant-configuration-instructions">
<h2>Relevant configuration instructions<a class="headerlink" href="#relevant-configuration-instructions" title="Permalink to this headline">¶</a></h2>
<div class="section" id="adjustable-parameters">
<h3>Adjustable parameters<a class="headerlink" href="#adjustable-parameters" title="Permalink to this headline">¶</a></h3>
<p>The following adjustable parameters are all configurable parameters in fe.conf.</p>
<ul class="simple">
<li>use_new_tablet_scheduler<ul>
<li>Description: Whether to enable the new replica scheduling mode. The new replica scheduling method is the replica scheduling method introduced in this document. If turned on, <code class="docutils literal notranslate"><span class="pre">disable_colocate_join</span></code> must be <code class="docutils literal notranslate"><span class="pre">true</span></code>. Because the new scheduling strategy does not support data fragmentation scheduling of co-locotion tables for the time being.</li>
<li>Default value:true</li>
<li>Importance: High</li>
</ul>
</li>
<li>tablet_repair_delay_factor_second<ul>
<li>Note: For different scheduling priorities, we will delay different time to start repairing. In order to prevent a large number of unnecessary replica repair tasks from occurring in the process of routine restart and upgrade. This parameter is a reference coefficient. For HIGH priority, the delay is the reference coefficient * 1; for NORMAL priority, the delay is the reference coefficient * 2; for LOW priority, the delay is the reference coefficient * 3. That is, the lower the priority, the longer the delay waiting time. If the user wants to repair the copy as soon as possible, this parameter can be reduced appropriately.</li>
<li>Default value: 60 seconds</li>
<li>Importance: High</li>
</ul>
</li>
<li>schedule_slot_num_per_path<ul>
<li>Note: The default number of slots allocated to each disk for replica repair. This number represents the number of replica repair tasks that a disk can run simultaneously. If you want to repair the copy faster, you can adjust this parameter appropriately. The higher the single value, the greater the impact on IO.</li>
<li>Default value: 2</li>
<li>Importance: High</li>
</ul>
</li>
<li>balance_load_score_threshold<ul>
<li>Description: Threshold of Cluster Equilibrium. The default is 0.1, or 10%. When the load core of a BE node is not higher than or less than 10% of the average load core, we think that the node is balanced. If you want to make the cluster load more even, you can adjust this parameter appropriately.</li>
<li>Default value: 0.1</li>
<li>Importance:</li>
</ul>
</li>
<li>storage_high_watermark_usage_percent 和 storage_min_left_capacity_bytes<ul>
<li>Description: These two parameters represent the upper limit of the maximum space utilization of a disk and the lower limit of the minimum space remaining, respectively. When the space utilization of a disk is greater than the upper limit or the remaining space is less than the lower limit, the disk will no longer be used as the destination address for balanced scheduling.</li>
<li>Default values: 0.85 and 1048576000 (1GB)</li>
<li>Importance:</li>
</ul>
</li>
<li>disable_balance<ul>
<li>Description: Control whether to turn off the balancing function. When replicas are in equilibrium, some functions, such as ALTER TABLE, will be banned. Equilibrium can last for a long time. Therefore, if the user wants to do the prohibited operation as soon as possible. This parameter can be set to true to turn off balanced scheduling.</li>
<li>Default value:true</li>
<li>Importance:</li>
</ul>
</li>
</ul>
</div>
<div class="section" id="unadjustable-parameters">
<h3>Unadjustable parameters<a class="headerlink" href="#unadjustable-parameters" title="Permalink to this headline">¶</a></h3>
<p>The following parameters do not support modification for the time being, just for illustration.</p>
<ul>
<li><p class="first">Tablet Checker scheduling interval</p>
<p>Tablet Checker schedules checks every 20 seconds.</p>
</li>
<li><p class="first">Tablet Scheduler scheduling interval</p>
<p>Tablet Scheduler schedules every five seconds</p>
</li>
<li><p class="first">Number of Tablet Scheduler Schedules per Batch</p>
<p>Tablet Scheduler schedules up to 50 tablets at a time.</p>
</li>
<li><p class="first">Tablet Scheduler Maximum Waiting Schedule and Number of Tasks in Operation</p>
<p>The maximum number of waiting tasks and running tasks is 2000. When over 2000, Tablet Checker will no longer generate new scheduling tasks to Tablet Scheduler.</p>
</li>
<li><p class="first">Tablet Scheduler Maximum Balanced Task Number</p>
<p>The maximum number of balanced tasks is 500. When more than 500, there will be no new balancing tasks.</p>
</li>
<li><p class="first">Number of slots per disk for balancing tasks</p>
<p>The number of slots per disk for balancing tasks is 2. This slot is independent of the slot used for replica repair.</p>
</li>
<li><p class="first">Update interval of cluster equilibrium</p>
<p>Tablet Scheduler recalculates the load score of the cluster every 20 seconds.</p>
</li>
<li><p class="first">Minimum and Maximum Timeout for Clone Tasks</p>
<p>A clone task timeout time range is 3 minutes to 2 hours. The specific timeout is calculated by the size of the tablet. The formula is (tablet size)/ (5MB/s). When a clone task fails three times, the task terminates.</p>
</li>
<li><p class="first">Dynamic Priority Adjustment Strategy</p>
<p>The minimum priority adjustment interval is 5 minutes. When a tablet schedule fails five times, priority is lowered. When a tablet is not scheduled for 30 minutes, priority is raised.</p>
</li>
</ul>
</div>
</div>
<div class="section" id="relevant-issues">
<h2>Relevant issues<a class="headerlink" href="#relevant-issues" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>In some cases, the default replica repair and balancing strategy may cause the network to be full (mostly in the case of gigabit network cards and a large number of disks per BE). At this point, some parameters need to be adjusted to reduce the number of simultaneous balancing and repair tasks.</li>
<li>Current balancing strategies for copies of Colocate Table do not guarantee that copies of the same Tablet will not be distributed on the BE of the same host. However, the repair strategy of the copy of Colocate Table detects this distribution error and corrects it. However, it may occur that after correction, the balancing strategy regards the replicas as unbalanced and rebalances them. As a result, the Colocate Group can not achieve stability because of the continuous alternation between the two states. In view of this situation, we suggest that when using Colocate attribute, we try to ensure that the cluster is isomorphic, so as to reduce the probability that replicas are distributed on the same host.</li>
</ul>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../backup-restore_EN.html" class="btn btn-neutral float-right" title="Backup and Recovery" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="tablet-meta-tool_EN.html" class="btn btn-neutral float-left" title="Tablet metadata management tool" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, Apache Doris(Incubating)

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
<div role="contentinfo">
    <p></p>
    <p>

        Apache Doris is an effort undergoing incubation at The Apache Software Foundation (ASF), sponsored by the name of Apache TLP sponsor. Incubation is required of all newly accepted projects until a further review indicates that the infrastructure, communications, and decision making process have stabilized in a manner consistent with other successful ASF projects. While incubation status is not necessarily a reflection of the completeness or stability of the code, it does indicate that the project has yet to be fully endorsed by the ASF.

    </p>
</div>


</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>