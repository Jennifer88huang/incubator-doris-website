

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Scheam Change &mdash; Doris Documentations 0.11.0 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../../" src="../../../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../../../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../../../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" />
    <link rel="next" title="HTTP API" href="../http-actions/index.html" />
    <link rel="prev" title="Rollup" href="alter-table-rollup_EN.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../../index.html" class="icon icon-home"> Doris Documentations
          

          
          </a>

          
            
            
              <div class="version">
                0.11.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../cn/index.html">中文</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../index.html">English</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../downloads/index.html">Downloads</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../installing/index.html">Compilation and Deployment</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../getting-started/index.html">Getting Started</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../index.html">Administrator Guide</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../load-data/index.html">Load Data</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="index.html">Schema Change</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="alter-table-bitmap-index_EN.html">Bitmap Index</a></li>
<li class="toctree-l4"><a class="reference internal" href="alter-table-rollup_EN.html">Rollup</a></li>
<li class="toctree-l4 current"><a class="current reference internal" href="#">Scheam Change</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../http-actions/index.html">HTTP API</a></li>
<li class="toctree-l3"><a class="reference internal" href="../operation/index.html">Maintainence Operation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../config/index.html">Configuration</a></li>
<li class="toctree-l3"><a class="reference internal" href="../backup-restore_EN.html">Backup and Recovery</a></li>
<li class="toctree-l3"><a class="reference internal" href="../broker_EN.html">Broker</a></li>
<li class="toctree-l3"><a class="reference internal" href="../colocation-join_EN.html">Colocation Join</a></li>
<li class="toctree-l3"><a class="reference internal" href="../dynamic-partition_EN.html">Dynamic Partition</a></li>
<li class="toctree-l3"><a class="reference internal" href="../export_manual_EN.html">Data export</a></li>
<li class="toctree-l3"><a class="reference internal" href="../privilege_EN.html">Authority Management</a></li>
<li class="toctree-l3"><a class="reference internal" href="../small-file-mgr_EN.html">File Manager</a></li>
<li class="toctree-l3"><a class="reference internal" href="../sql-mode_EN.html">SQL MODE</a></li>
<li class="toctree-l3"><a class="reference internal" href="../time-zone_EN.html">Time zone</a></li>
<li class="toctree-l3"><a class="reference internal" href="../variables_EN.html">Variable</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../extending-doris/index.html">Extending Ability</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../internal/index.html">Design Documents</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../sql-reference/index.html">SQL Manual</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../developer-guide/index.html">Developer Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../community/index.html">Apache Commnity</a></li>
</ul>
</li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../index.html">Doris Documentations</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../../index.html">English</a> &raquo;</li>
        
          <li><a href="../index.html">Administrator Guide</a> &raquo;</li>
        
          <li><a href="index.html">Schema Change</a> &raquo;</li>
        
      <li>Scheam Change</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            
              <a href="https://github.com/apache/incubator-doris/blob/master/docs/documentation/en/administrator-guide/alter-table/alter-table-schema-change_EN.md" class="fa fa-github"> Edit on GitHub</a>
            
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <!-- 
Licensed to the Apache Software Foundation (ASF) under one
or more contributor license agreements.  See the NOTICE file
distributed with this work for additional information
regarding copyright ownership.  The ASF licenses this file
to you under the Apache License, Version 2.0 (the
"License"); you may not use this file except in compliance
with the License.  You may obtain a copy of the License at

  http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing,
software distributed under the License is distributed on an
"AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, either express or implied.  See the License for the
specific language governing permissions and limitations
under the License.
--><div class="section" id="scheam-change">
<h1>Scheam Change<a class="headerlink" href="#scheam-change" title="Permalink to this headline">¶</a></h1>
<p>Users can modify the schema of existing tables through the Scheam Change operation. Doris currently supports the following modifications:</p>
<ul class="simple">
<li>Add and delete columns</li>
<li>Modify column type</li>
<li>Adjust column order</li>
<li>Add and modify Bloom Filter</li>
<li>Add and delete bitmap index</li>
</ul>
<p>This document mainly describes how to create a Scheam Change job, as well as some considerations and frequently asked questions about Scheam Change.</p>
<div class="section" id="glossary">
<h2>Glossary<a class="headerlink" href="#glossary" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>Base Table：When each table is created, it corresponds to a base table. The base table stores the complete data of this table. Rollups are usually created based on the data in the base table (and can also be created from other rollups).</li>
<li>Index：Materialized index. Rollup or Base Table are both called materialized indexes.</li>
<li>Transaction：Each import task is a transaction, and each transaction has a unique incrementing Transaction ID.</li>
<li>Rollup：Roll-up tables based on base tables or other rollups.</li>
</ul>
</div>
<div class="section" id="basic-principles">
<h2>Basic Principles<a class="headerlink" href="#basic-principles" title="Permalink to this headline">¶</a></h2>
<p>The basic process of executing a Schema Change is to generate a copy of the index data of the new schema from the data of the original index. Among them, two parts of data conversion are required. One is the conversion of existing historical data, and the other is the conversion of newly arrived imported data during the execution of Schema Change.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">+----------+</span>
<span class="o">|</span> <span class="n">Load</span> <span class="n">Job</span> <span class="o">|</span>
<span class="o">+----+-----+</span>
     <span class="o">|</span>
     <span class="o">|</span> <span class="n">Load</span> <span class="n">job</span> <span class="n">generates</span> <span class="n">both</span> <span class="n">origin</span> <span class="ow">and</span> <span class="n">new</span> <span class="n">index</span> <span class="n">data</span>
     <span class="o">|</span>
     <span class="o">|</span>      <span class="o">+------------------+</span> <span class="o">+---------------+</span>
     <span class="o">|</span>      <span class="o">|</span> <span class="n">Origin</span> <span class="n">Index</span>     <span class="o">|</span> <span class="o">|</span> <span class="n">Origin</span> <span class="n">Index</span>  <span class="o">|</span>
     <span class="o">+------&gt;</span> <span class="n">New</span> <span class="n">Incoming</span> <span class="n">Data</span><span class="o">|</span> <span class="o">|</span> <span class="n">History</span> <span class="n">Data</span>  <span class="o">|</span>
     <span class="o">|</span>      <span class="o">+------------------+</span> <span class="o">+------+--------+</span>
     <span class="o">|</span>                                  <span class="o">|</span>
     <span class="o">|</span>                                  <span class="o">|</span> <span class="n">Convert</span> <span class="n">history</span> <span class="n">data</span>
     <span class="o">|</span>                                  <span class="o">|</span>
     <span class="o">|</span>      <span class="o">+------------------+</span> <span class="o">+------</span><span class="n">v</span><span class="o">--------+</span>
     <span class="o">|</span>      <span class="o">|</span> <span class="n">New</span> <span class="n">Index</span>        <span class="o">|</span> <span class="o">|</span> <span class="n">New</span> <span class="n">Index</span>     <span class="o">|</span>
     <span class="o">+------&gt;</span> <span class="n">New</span> <span class="n">Incoming</span> <span class="n">Data</span><span class="o">|</span> <span class="o">|</span> <span class="n">History</span> <span class="n">Data</span>  <span class="o">|</span>
            <span class="o">+------------------+</span> <span class="o">+---------------+</span>
</pre></div>
</div>
<p>Before starting the conversion of historical data, Doris will obtain a latest transaction ID. And wait for all import transactions before this Transaction ID to complete. This Transaction ID becomes a watershed. This means that Doris guarantees that all import tasks after the watershed will generate data for both the original Index and the new Index. In this way, when the historical data conversion is completed, the data in the new Index can be guaranteed to be complete.</p>
</div>
<div class="section" id="create-job">
<h2>Create Job<a class="headerlink" href="#create-job" title="Permalink to this headline">¶</a></h2>
<p>The specific syntax for creating a Scheam Change can be found in the description of the Scheam Change section in the help <code class="docutils literal notranslate"><span class="pre">HELP</span> <span class="pre">ALTER</span> <span class="pre">TABLE</span></code>.</p>
<p>The creation of Scheam Change is an asynchronous process. After the job is submitted successfully, the user needs to view the job progress through the <code class="docutils literal notranslate"><span class="pre">SHOW</span> <span class="pre">ALTER</span> <span class="pre">TABLE</span> <span class="pre">COLUMN</span></code> command.</p>
</div>
<div class="section" id="view-job">
<h2>View Job<a class="headerlink" href="#view-job" title="Permalink to this headline">¶</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">SHOW</span> <span class="pre">ALTER</span> <span class="pre">TABLE</span> <span class="pre">COLUMN</span></code> You can view the Schema Change jobs that are currently executing or completed. When multiple indexes are involved in a Schema Change job, the command displays multiple lines, each corresponding to an index. For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>        <span class="n">JobId</span><span class="p">:</span> <span class="mi">20021</span>
    <span class="n">TableName</span><span class="p">:</span> <span class="n">tbl1</span>
   <span class="n">CreateTime</span><span class="p">:</span> <span class="mi">2019</span><span class="o">-</span><span class="mi">08</span><span class="o">-</span><span class="mi">05</span> <span class="mi">23</span><span class="p">:</span><span class="mi">03</span><span class="p">:</span><span class="mi">13</span>
   <span class="n">FinishTime</span><span class="p">:</span> <span class="mi">2019</span><span class="o">-</span><span class="mi">08</span><span class="o">-</span><span class="mi">05</span> <span class="mi">23</span><span class="p">:</span><span class="mi">03</span><span class="p">:</span><span class="mi">42</span>
    <span class="n">IndexName</span><span class="p">:</span> <span class="n">tbl1</span>
      <span class="n">IndexId</span><span class="p">:</span> <span class="mi">20022</span>
<span class="n">OriginIndexId</span><span class="p">:</span> <span class="mi">20017</span>
<span class="n">SchemaVersion</span><span class="p">:</span> <span class="mi">2</span><span class="p">:</span><span class="mi">792557838</span>
<span class="n">TransactionId</span><span class="p">:</span> <span class="mi">10023</span>
        <span class="n">State</span><span class="p">:</span> <span class="n">FINISHED</span>
          <span class="n">Msg</span><span class="p">:</span>
     <span class="n">Progress</span><span class="p">:</span> <span class="n">N</span><span class="o">/</span><span class="n">A</span>
      <span class="n">Timeout</span><span class="p">:</span> <span class="mi">86400</span>
</pre></div>
</div>
<ul class="simple">
<li>JobId: A unique ID for each Schema Change job.</li>
<li>TableName: The table name of the base table corresponding to Schema Change.</li>
<li>CreateTime: Job creation time.</li>
<li>FinishedTime: The end time of the job. If it is not finished, “N / A” is displayed.</li>
<li>IndexName: The name of an Index involved in this modification.</li>
<li>IndexId: The unique ID of the new Index.</li>
<li>OriginIndexId: The unique ID of the old Index.</li>
<li>SchemaVersion: Displayed in M: N format. M is the version of this Schema Change, and N is the corresponding hash value. With each Schema Change, the version is incremented.</li>
<li>TransactionId: the watershed transaction ID of the conversion history data.</li>
<li>State: The phase of the operation.
&nbsp;&nbsp;&nbsp;&nbsp;* PENDING: The job is waiting in the queue to be scheduled.
&nbsp;&nbsp;&nbsp;&nbsp;* WAITING_TXN: Wait for the import task before the watershed transaction ID to complete.
&nbsp;&nbsp;&nbsp;&nbsp;* RUNNING: Historical data conversion.
&nbsp;&nbsp;&nbsp;&nbsp;* FINISHED: The operation was successful.
&nbsp;&nbsp;&nbsp;&nbsp;* CANCELLED: The job failed.</li>
<li>Msg: If the job fails, a failure message is displayed here.</li>
<li>Progress: operation progress. Progress is displayed only in the RUNNING state. Progress is displayed in M ​​/ N. Where N is the total number of copies involved in the Schema Change. M is the number of copies of historical data conversion completed.</li>
<li>Timeout: Job timeout time. Unit of second.</li>
</ul>
</div>
<div class="section" id="cancel-job">
<h2>Cancel Job<a class="headerlink" href="#cancel-job" title="Permalink to this headline">¶</a></h2>
<p>In the case that the job status is not FINISHED or CANCELLED, you can cancel the Schema Change job with the following command:
<code class="docutils literal notranslate"><span class="pre">CANCEL</span> <span class="pre">ALTER</span> <span class="pre">TABLE</span> <span class="pre">COLUMN</span> <span class="pre">FROM</span> <span class="pre">tbl_name;</span></code></p>
</div>
<div class="section" id="best-practice">
<h2>Best Practice<a class="headerlink" href="#best-practice" title="Permalink to this headline">¶</a></h2>
<p>Schema Change can make multiple changes to multiple indexes in one job. For example:
Source Schema：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">+-----------+-------+------+------+------+---------+-------+</span>
<span class="o">|</span> <span class="n">IndexName</span> <span class="o">|</span> <span class="n">Field</span> <span class="o">|</span> <span class="n">Type</span> <span class="o">|</span> <span class="n">Null</span> <span class="o">|</span> <span class="n">Key</span>  <span class="o">|</span> <span class="n">Default</span> <span class="o">|</span> <span class="n">Extra</span> <span class="o">|</span>
<span class="o">+-----------+-------+------+------+------+---------+-------+</span>
<span class="o">|</span> <span class="n">tbl1</span>      <span class="o">|</span> <span class="n">k1</span>    <span class="o">|</span> <span class="n">INT</span>  <span class="o">|</span> <span class="n">No</span>   <span class="o">|</span> <span class="n">true</span> <span class="o">|</span> <span class="n">N</span><span class="o">/</span><span class="n">A</span>     <span class="o">|</span>       <span class="o">|</span>
<span class="o">|</span>           <span class="o">|</span> <span class="n">k2</span>    <span class="o">|</span> <span class="n">INT</span>  <span class="o">|</span> <span class="n">No</span>   <span class="o">|</span> <span class="n">true</span> <span class="o">|</span> <span class="n">N</span><span class="o">/</span><span class="n">A</span>     <span class="o">|</span>       <span class="o">|</span>
<span class="o">|</span>           <span class="o">|</span> <span class="n">k3</span>    <span class="o">|</span> <span class="n">INT</span>  <span class="o">|</span> <span class="n">No</span>   <span class="o">|</span> <span class="n">true</span> <span class="o">|</span> <span class="n">N</span><span class="o">/</span><span class="n">A</span>     <span class="o">|</span>       <span class="o">|</span>
<span class="o">|</span>           <span class="o">|</span>       <span class="o">|</span>      <span class="o">|</span>      <span class="o">|</span>      <span class="o">|</span>         <span class="o">|</span>       <span class="o">|</span>
<span class="o">|</span> <span class="n">rollup2</span>   <span class="o">|</span> <span class="n">k2</span>    <span class="o">|</span> <span class="n">INT</span>  <span class="o">|</span> <span class="n">No</span>   <span class="o">|</span> <span class="n">true</span> <span class="o">|</span> <span class="n">N</span><span class="o">/</span><span class="n">A</span>     <span class="o">|</span>       <span class="o">|</span>
<span class="o">|</span>           <span class="o">|</span>       <span class="o">|</span>      <span class="o">|</span>      <span class="o">|</span>      <span class="o">|</span>         <span class="o">|</span>       <span class="o">|</span>
<span class="o">|</span> <span class="n">rollup1</span>   <span class="o">|</span> <span class="n">k1</span>    <span class="o">|</span> <span class="n">INT</span>  <span class="o">|</span> <span class="n">No</span>   <span class="o">|</span> <span class="n">true</span> <span class="o">|</span> <span class="n">N</span><span class="o">/</span><span class="n">A</span>     <span class="o">|</span>       <span class="o">|</span>
<span class="o">|</span>           <span class="o">|</span> <span class="n">k2</span>    <span class="o">|</span> <span class="n">INT</span>  <span class="o">|</span> <span class="n">No</span>   <span class="o">|</span> <span class="n">true</span> <span class="o">|</span> <span class="n">N</span><span class="o">/</span><span class="n">A</span>     <span class="o">|</span>       <span class="o">|</span>
<span class="o">+-----------+-------+------+------+------+---------+-------+</span>
</pre></div>
</div>
<p>You can add a row k4 to both rollup1 and rollup2 by adding the following k5 to rollup2:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ALTER</span> <span class="n">TABLE</span> <span class="n">tbl1</span>
<span class="n">ADD</span> <span class="n">COLUMN</span> <span class="n">k4</span> <span class="n">INT</span> <span class="n">default</span> <span class="s2">&quot;1&quot;</span> <span class="n">to</span> <span class="n">rollup1</span><span class="p">,</span>
<span class="n">ADD</span> <span class="n">COLUMN</span> <span class="n">k4</span> <span class="n">INT</span> <span class="n">default</span> <span class="s2">&quot;1&quot;</span> <span class="n">to</span> <span class="n">rollup2</span><span class="p">,</span>
<span class="n">ADD</span> <span class="n">COLUMN</span> <span class="n">k5</span> <span class="n">INT</span> <span class="n">default</span> <span class="s2">&quot;1&quot;</span> <span class="n">to</span> <span class="n">rollup2</span><span class="p">;</span>
</pre></div>
</div>
<p>When completion, the Schema becomes:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">+-----------+-------+------+------+------+---------+-------+</span>
<span class="o">|</span> <span class="n">IndexName</span> <span class="o">|</span> <span class="n">Field</span> <span class="o">|</span> <span class="n">Type</span> <span class="o">|</span> <span class="n">Null</span> <span class="o">|</span> <span class="n">Key</span>  <span class="o">|</span> <span class="n">Default</span> <span class="o">|</span> <span class="n">Extra</span> <span class="o">|</span>
<span class="o">+-----------+-------+------+------+------+---------+-------+</span>
<span class="o">|</span> <span class="n">tbl1</span>      <span class="o">|</span> <span class="n">k1</span>    <span class="o">|</span> <span class="n">INT</span>  <span class="o">|</span> <span class="n">No</span>   <span class="o">|</span> <span class="n">true</span> <span class="o">|</span> <span class="n">N</span><span class="o">/</span><span class="n">A</span>     <span class="o">|</span>       <span class="o">|</span>
<span class="o">|</span>           <span class="o">|</span> <span class="n">k2</span>    <span class="o">|</span> <span class="n">INT</span>  <span class="o">|</span> <span class="n">No</span>   <span class="o">|</span> <span class="n">true</span> <span class="o">|</span> <span class="n">N</span><span class="o">/</span><span class="n">A</span>     <span class="o">|</span>       <span class="o">|</span>
<span class="o">|</span>           <span class="o">|</span> <span class="n">k3</span>    <span class="o">|</span> <span class="n">INT</span>  <span class="o">|</span> <span class="n">No</span>   <span class="o">|</span> <span class="n">true</span> <span class="o">|</span> <span class="n">N</span><span class="o">/</span><span class="n">A</span>     <span class="o">|</span>       <span class="o">|</span>
<span class="o">|</span>           <span class="o">|</span> <span class="n">k4</span>    <span class="o">|</span> <span class="n">INT</span>  <span class="o">|</span> <span class="n">No</span>   <span class="o">|</span> <span class="n">true</span> <span class="o">|</span> <span class="mi">1</span>       <span class="o">|</span>       <span class="o">|</span>
<span class="o">|</span>           <span class="o">|</span> <span class="n">k5</span>    <span class="o">|</span> <span class="n">INT</span>  <span class="o">|</span> <span class="n">No</span>   <span class="o">|</span> <span class="n">true</span> <span class="o">|</span> <span class="mi">1</span>       <span class="o">|</span>       <span class="o">|</span>
<span class="o">|</span>           <span class="o">|</span>       <span class="o">|</span>      <span class="o">|</span>      <span class="o">|</span>      <span class="o">|</span>         <span class="o">|</span>       <span class="o">|</span>
<span class="o">|</span> <span class="n">rollup2</span>   <span class="o">|</span> <span class="n">k2</span>    <span class="o">|</span> <span class="n">INT</span>  <span class="o">|</span> <span class="n">No</span>   <span class="o">|</span> <span class="n">true</span> <span class="o">|</span> <span class="n">N</span><span class="o">/</span><span class="n">A</span>     <span class="o">|</span>       <span class="o">|</span>
<span class="o">|</span>           <span class="o">|</span> <span class="n">k4</span>    <span class="o">|</span> <span class="n">INT</span>  <span class="o">|</span> <span class="n">No</span>   <span class="o">|</span> <span class="n">true</span> <span class="o">|</span> <span class="mi">1</span>       <span class="o">|</span>       <span class="o">|</span>
<span class="o">|</span>           <span class="o">|</span> <span class="n">k5</span>    <span class="o">|</span> <span class="n">INT</span>  <span class="o">|</span> <span class="n">No</span>   <span class="o">|</span> <span class="n">true</span> <span class="o">|</span> <span class="mi">1</span>       <span class="o">|</span>       <span class="o">|</span>
<span class="o">|</span>           <span class="o">|</span>       <span class="o">|</span>      <span class="o">|</span>      <span class="o">|</span>      <span class="o">|</span>         <span class="o">|</span>       <span class="o">|</span>
<span class="o">|</span> <span class="n">rollup1</span>   <span class="o">|</span> <span class="n">k1</span>    <span class="o">|</span> <span class="n">INT</span>  <span class="o">|</span> <span class="n">No</span>   <span class="o">|</span> <span class="n">true</span> <span class="o">|</span> <span class="n">N</span><span class="o">/</span><span class="n">A</span>     <span class="o">|</span>       <span class="o">|</span>
<span class="o">|</span>           <span class="o">|</span> <span class="n">k2</span>    <span class="o">|</span> <span class="n">INT</span>  <span class="o">|</span> <span class="n">No</span>   <span class="o">|</span> <span class="n">true</span> <span class="o">|</span> <span class="n">N</span><span class="o">/</span><span class="n">A</span>     <span class="o">|</span>       <span class="o">|</span>
<span class="o">|</span>           <span class="o">|</span> <span class="n">k4</span>    <span class="o">|</span> <span class="n">INT</span>  <span class="o">|</span> <span class="n">No</span>   <span class="o">|</span> <span class="n">true</span> <span class="o">|</span> <span class="mi">1</span>       <span class="o">|</span>       <span class="o">|</span>
<span class="o">+-----------+-------+------+------+------+---------+-------+</span>
</pre></div>
</div>
<p>As you can see, the base table tbl1 also automatically added k4, k5 columns. That is, columns added to any rollup are automatically added to the Base table.</p>
<p>At the same time, columns that already exist in the Base table are not allowed to be added to Rollup. If you need to do this, you can re-create a Rollup with the new columns and then delete the original Rollup.</p>
</div>
<div class="section" id="notice">
<h2>Notice<a class="headerlink" href="#notice" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>Only one Schema Change job can be running on a table at a time.</li>
<li>Schema Change operation does not block import and query operations.</li>
<li>The partition column and bucket column cannot be modified.</li>
<li>If there is a value column aggregated by REPLACE in the schema, the Key column is not allowed to be deleted.</li>
</ul>
<p>If the Key column is deleted, Doris cannot determine the value of the REPLACE column.
&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp; All non-Key columns of the Unique data model table are REPLACE aggregated.</p>
<ul class="simple">
<li>When adding a value column whose aggregation type is SUM or REPLACE, the default value of this column has no meaning to historical data.</li>
</ul>
<p>Because the historical data has lost the detailed information, the default value cannot actually reflect the aggregated value.</p>
<ul class="simple">
<li>When modifying the column type, fields other than Type need to be completed according to the information on the original column.</li>
</ul>
<p>If you modify the column <code class="docutils literal notranslate"><span class="pre">k1</span> <span class="pre">INT</span> <span class="pre">SUM</span> <span class="pre">NULL</span> <span class="pre">DEFAULT&quot;</span> <span class="pre">1</span> <span class="pre">&quot;</span></code> as type BIGINT, you need to execute the following command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>```ALTER TABLE tbl1 MODIFY COLUMN `k1` BIGINT SUM NULL DEFAULT &quot;1&quot;; ```
</pre></div>
</div>
<p>Note that in addition to the new column types, such as the aggregation mode, Nullable attributes, and default values must be completed according to the original information.</p>
<ul class="simple">
<li>Modifying column names, aggregation types, nullable attributes, default values, and column comments is not supported.</li>
</ul>
</div>
<div class="section" id="faq">
<h2>FAQ<a class="headerlink" href="#faq" title="Permalink to this headline">¶</a></h2>
<ul>
<li><p class="first">the execution speed of Schema Change</p>
<p>At present, the execution speed of Schema Change is estimated to be about 10MB / s according to the worst efficiency. To be conservative, users can set the timeout for jobs based on this rate.</p>
</li>
<li><p class="first">Submit job error <code class="docutils literal notranslate"><span class="pre">Table</span> <span class="pre">xxx</span> <span class="pre">is</span> <span class="pre">not</span> <span class="pre">stable.</span> <span class="pre">...</span></code></p>
<p>Schema Change can only be started when the table data is complete and unbalanced. If some data shard copies of the table are incomplete, or if some copies are undergoing an equalization operation, the submission is rejected.
&nbsp;&nbsp;&nbsp;&nbsp;
Whether the data shard copy is complete can be checked with the following command:
<code class="docutils literal notranslate"><span class="pre">ADMIN</span> <span class="pre">SHOW</span> <span class="pre">REPLICA</span> <span class="pre">STATUS</span> <span class="pre">FROM</span> <span class="pre">tbl</span> <span class="pre">WHERE</span> <span class="pre">STATUS</span> <span class="pre">!=</span> <span class="pre">&quot;OK&quot;;</span></code></p>
<p>If a result is returned, there is a problem with the copy. These problems are usually fixed automatically by the system. You can also use the following commands to repair this table first:<code class="docutils literal notranslate"><span class="pre">ADMIN</span> <span class="pre">REPAIR</span> <span class="pre">TABLE</span> <span class="pre">tbl1;</span></code></p>
<p>You can check if there are running balancing tasks with the following command:</p>
<p><code class="docutils literal notranslate"><span class="pre">SHOW</span> <span class="pre">PROC</span> <span class="pre">&quot;/cluster_balance/pending_tablets&quot;;</span></code></p>
<p>You can wait for the balancing task to complete, or temporarily disable the balancing operation with the following command:</p>
<p><code class="docutils literal notranslate"><span class="pre">ADMIN</span> <span class="pre">SET</span> <span class="pre">FRONTEND</span> <span class="pre">CONFIG</span> <span class="pre">(&quot;disable_balance&quot;</span> <span class="pre">=</span> <span class="pre">&quot;true&quot;);</span></code></p>
</li>
</ul>
</div>
<div class="section" id="configurations">
<h2>Configurations<a class="headerlink" href="#configurations" title="Permalink to this headline">¶</a></h2>
<div class="section" id="fe-configurations">
<h3>FE Configurations<a class="headerlink" href="#fe-configurations" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">alter_table_timeout_second</span></code>：The default timeout for the job is 86400 seconds.</li>
</ul>
</div>
<div class="section" id="be-configurations">
<h3>BE Configurations<a class="headerlink" href="#be-configurations" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">alter_tablet_worker_count</span></code>：Number of threads used to perform historical data conversion on the BE side. The default is 3. If you want to speed up the Schema Change job, you can increase this parameter appropriately and restart the BE. But too many conversion threads can cause increased IO pressure and affect other operations. This thread is shared with the Rollup job.</li>
</ul>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../http-actions/index.html" class="btn btn-neutral float-right" title="HTTP API" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="alter-table-rollup_EN.html" class="btn btn-neutral float-left" title="Rollup" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, Apache Doris(Incubating)

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
<div role="contentinfo">
    <p></p>
    <p>

        Apache Doris(incubating) is an effort undergoing incubation at The Apache Software Foundation (ASF), sponsored by the Apache Incubator. Incubation is required of all newly accepted projects until a further review indicates that the infrastructure, communications, and decision making process have stabilized in a manner consistent with other successful ASF projects. While incubation status is not necessarily a reflection of the completeness or stability of the code, it does indicate that the project has yet to be fully endorsed by the ASF.

    </p>
</div>


</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>