

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Introduction Overview &mdash; Doris Documentations 0.11.0 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../../" src="../../../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../../../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../../../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" />
    <link rel="next" title="Broker Load" href="broker-load-manual_EN.html" />
    <link rel="prev" title="Load Data" href="index.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../../index.html" class="icon icon-home"> Doris Documentations
          

          
          </a>

          
            
            
              <div class="version">
                0.11.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../cn/index.html">中文</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../index.html">English</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../installing/index.html">Compilation and deployment</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../getting-started/index.html">Getting started</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../index.html">Administrator Guide</a><ul class="current">
<li class="toctree-l3 current"><a class="reference internal" href="index.html">Load Data</a><ul class="current">
<li class="toctree-l4 current"><a class="current reference internal" href="#">Introduction Overview</a></li>
<li class="toctree-l4"><a class="reference internal" href="broker-load-manual_EN.html">Broker Load</a></li>
<li class="toctree-l4"><a class="reference internal" href="stream-load-manual_EN.html">Stream load</a></li>
<li class="toctree-l4"><a class="reference internal" href="routine-load-manual_EN.html">Routine Load</a></li>
<li class="toctree-l4"><a class="reference internal" href="insert-into-manual_EN.html">Insert Into</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../http-actions/index.html">HTTP API</a></li>
<li class="toctree-l3"><a class="reference internal" href="../operation/index.html">Maintainence Operation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../backup-restore_EN.html">Backup and Recovery</a></li>
<li class="toctree-l3"><a class="reference internal" href="../colocation-join_EN.html">Colocation Join</a></li>
<li class="toctree-l3"><a class="reference internal" href="../export_manual_EN.html">Data export</a></li>
<li class="toctree-l3"><a class="reference internal" href="../privilege_EN.html">Authority Management</a></li>
<li class="toctree-l3"><a class="reference internal" href="../small-file-mgr_EN.html">File Manager</a></li>
<li class="toctree-l3"><a class="reference internal" href="../time-zone_EN.html">Time zone</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../extending-doris/index.html">Extending Ability</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../internal/index.html">Design Documents</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../sql-reference/index.html">SQL Manual</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../community/index.html">Apache Commnity</a></li>
</ul>
</li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../index.html">Doris Documentations</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../../index.html">English</a> &raquo;</li>
        
          <li><a href="../index.html">Administrator Guide</a> &raquo;</li>
        
          <li><a href="index.html">Load Data</a> &raquo;</li>
        
      <li>Introduction Overview</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            
              <a href="https://github.com/apache/incubator-doris/blob/master/docs/documentation/en/administrator-guide/load-data/load-manual_EN.md" class="fa fa-github"> Edit on GitHub</a>
            
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="introduction-overview">
<h1>Introduction Overview<a class="headerlink" href="#introduction-overview" title="Permalink to this headline">¶</a></h1>
<p>The Load function is to import the user’s raw data into Doris. After successful import, users can query data through Mysql client.</p>
<p>Doris supports multiple imports. It is recommended to read this document in full first, and then to view the detailed documents of their respective import modes according to the selected import mode.</p>
<div class="section" id="basic-concepts">
<h2>Basic concepts<a class="headerlink" href="#basic-concepts" title="Permalink to this headline">¶</a></h2>
<ol class="simple">
<li>Frontend (FE): Metadata and scheduling nodes of Doris system. In the import process, it is mainly responsible for the generation of import planning and the scheduling of import tasks.</li>
<li>Backend (BE): The computing and storage nodes of Doris system. In the import process, it is mainly responsible for ETL and storage of data.</li>
<li>Broker: Broker is an independent stateless process. It encapsulates the file system interface and provides Doris with the ability to read files in the remote storage system.</li>
<li>Load job: The import job reads the source data submitted by the user, transforms or cleans it, and imports the data into the Doris system. After the import is completed, the data can be queried by the user.</li>
<li>Label: All import jobs have a Label. Label is unique in a database and can be specified by the user or automatically generated by the system to identify an import job. The same Label can only be used for a successful import job.</li>
<li>MySQL Protocol/HTTP Protocol: Doris provides two kinds of access protocol interfaces. MySQL protocol and HTTP protocol. Part of the import mode uses MySQL protocol interface to submit jobs, and part of the import mode uses HTTP protocol interface to submit jobs.</li>
</ol>
</div>
<div class="section" id="load-mode">
<h2>Load mode<a class="headerlink" href="#load-mode" title="Permalink to this headline">¶</a></h2>
<p>To adapt to different data import requirements, Doris system provides five different import methods. Each import mode supports different data sources and has different usage modes (asynchronous, synchronous).</p>
<p>All import methods support CSV data format. Broker load also supports parquet data format.</p>
<p>For instructions on each import mode, please refer to the operation manual for a single import mode.</p>
<ul>
<li><p class="first">Broker load</p>
<p>Access and read external data sources (such as HDFS) through the Broker process and import them into Doris. The user submits the import job through Mysql protocol and executes it asynchronously. View the import results through the <code class="docutils literal notranslate"><span class="pre">SHOW</span> <span class="pre">LOAD</span></code> command.</p>
</li>
<li><p class="first">Stream load</p>
<p>Users submit requests through HTTP protocol and create imports with raw data. It is mainly used to quickly import data from local files or data streams into Doris. The Import command returns the import result synchronously.</p>
</li>
<li><p class="first">Insert</p>
<p>Similar to the Insert statement in MySQL, Doris provides <code class="docutils literal notranslate"><span class="pre">INSERT</span> <span class="pre">INTO</span> <span class="pre">tbl</span> <span class="pre">SELECT</span> <span class="pre">...;</span></code>reading data from Doris’s table and importing it into another table. Or by <code class="docutils literal notranslate"><span class="pre">INSERT</span> <span class="pre">INTO</span> <span class="pre">tbl</span> <span class="pre">VALUES</span> <span class="pre">(...);</span></code> Insert a single piece of data.</p>
</li>
<li><p class="first">Multi load</p>
<p>Users submit multiple import jobs through HTTP protocol. Multi Load guarantees the atomic validity of multiple import jobs.</p>
</li>
<li><p class="first">Routine load</p>
<p>Users submit routine import jobs through MySQL protocol, generate a resident thread, read and import data from data sources (such as Kafka) uninterruptedly into Doris.</p>
</li>
</ul>
</div>
<div class="section" id="basic-principles">
<h2>Basic Principles<a class="headerlink" href="#basic-principles" title="Permalink to this headline">¶</a></h2>
<div class="section" id="import-execution-process">
<h3>Import execution process<a class="headerlink" href="#import-execution-process" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">+---------+</span>      <span class="o">+---------+</span>      <span class="o">+----------+</span>      <span class="o">+-----------+</span>
<span class="o">|</span>         <span class="o">|</span>      <span class="o">|</span>         <span class="o">|</span>      <span class="o">|</span>          <span class="o">|</span>      <span class="o">|</span>           <span class="o">|</span>
<span class="o">|</span> <span class="n">PENDING</span> <span class="o">+-----&gt;+</span>   <span class="n">ETL</span>   <span class="o">+-----&gt;+</span> <span class="n">LOADING</span>  <span class="o">+-----&gt;+</span> <span class="n">FINISHED</span>  <span class="o">|</span>
<span class="o">|</span>         <span class="o">|</span>      <span class="o">|</span>         <span class="o">|</span>      <span class="o">|</span>          <span class="o">|</span>      <span class="o">|</span>           <span class="o">|</span>
<span class="o">+---------+</span>      <span class="o">+---+-----+</span>      <span class="o">+----+-----+</span>      <span class="o">+-----------+</span>
     <span class="o">|</span>               <span class="o">|</span>                 <span class="o">|</span>
     <span class="o">|</span>               <span class="o">|</span>                 <span class="o">|</span>
     <span class="o">|</span>               <span class="o">|</span>                 <span class="o">|</span>
     <span class="o">|</span>               <span class="o">|</span>                 <span class="o">|</span>            <span class="o">+-----------+</span>
     <span class="o">|</span>               <span class="o">|</span>                 <span class="o">|</span>            <span class="o">|</span>           <span class="o">|</span>
     <span class="o">+---------------+-----------------+------------&gt;</span> <span class="n">CANCELLED</span> <span class="o">|</span>
                                                    <span class="o">|</span>           <span class="o">|</span>
                                                    <span class="o">+-----------+</span>
</pre></div>
</div>
<p>As shown above, an import operation mainly goes through the four stages above.</p>
<ul class="simple">
<li>PENDING (not required): Only Broker Load has this stage. Broker Load is submitted by the user and stays at this stage for a short time until it is scheduled by Scheduler in FE. Scheduler’s schedule interval is 5 seconds.</li>
<li>ETL (not required): This stage exists before version 0.10.0 (included), mainly for transforming raw data according to user declaration and filtering raw data that does not meet the requirements. In the version after 0.10.0, the ETL phase no longer exists, and the work of data transformation is merged into the LOADING phase.</li>
<li>LOADING: This stage is mainly used to push the transformed data into the corresponding BE storage before version 0.10.0 (including). In the version after 0.10.0, the data is cleaned and changed first, and then sent to BE storage. When all imported data are imported, the process of waiting for validity enters, and Load job is still LOADING.</li>
<li>FINISHED: After all the data involved in Load Job takes effect, the state of Load Job becomes FINISHED. Data imported after FINISHED can be queried.</li>
<li>CANCELLED: Before job FINISH, jobs may be cancelled and entered the CANCELLED state. For example, the user manually cancels, or imports errors. CANCELLED is also the final state of Load Job and cannot be executed again.</li>
</ul>
<p>In the above stage, except for the PENDING to LOADING stage, which is scheduled by Scheduler, the transfer before other stages is implemented by callback mechanism.</p>
</div>
<div class="section" id="label-and-atomicity">
<h3>Label and Atomicity<a class="headerlink" href="#label-and-atomicity" title="Permalink to this headline">¶</a></h3>
<p>Doris provides atomic assurance for all import methods. It ensures that the data in the same import operation is valid for atoms. There will be no case of importing only part of the data.</p>
<p>At the same time, each import job has a Label designated by the user or automatically generated by the system. Label is unique in a database. When an import job corresponding to a Label is successful enough, the import job cannot be submitted repeatedly using the Label. If the import job corresponding to Label fails, it can be reused.</p>
<p>Users can use Label mechanism to ensure that the data corresponding to Label can be imported at most once, at the level of At-Most-One semantics.</p>
</div>
</div>
<div class="section" id="synchronization-and-asynchronization">
<h2>Synchronization and asynchronization<a class="headerlink" href="#synchronization-and-asynchronization" title="Permalink to this headline">¶</a></h2>
<p>Doris’s current import methods fall into two categories, synchronous and asynchronous. If an external program accesses Doris’s import function, it is necessary to determine which type of import mode is used and then determine the access logic.</p>
<div class="section" id="synchronization">
<h3>Synchronization<a class="headerlink" href="#synchronization" title="Permalink to this headline">¶</a></h3>
<p>Synchronized import means that users create import tasks, Doris executes import synchronously, and returns user import results after execution. Users can directly determine whether the import is successful or not by synchronizing the results returned by creating the import task command.</p>
<p>The import methods of synchronous type are <strong>Stream load</strong>, <strong>Insert</strong>.</p>
<p>Operation steps:</p>
<ol class="simple">
<li>Users (external systems) create import tasks.</li>
<li>Doris returns the import result.</li>
<li>The user (external system) judges the import result and can submit the import task again if it fails.</li>
</ol>
<p><em>Note: If the user returns the import synchronously and the amount of data imported is too large, it may take a long time to create the import request to return the result.</em></p>
</div>
<div class="section" id="asynchronism">
<h3>Asynchronism<a class="headerlink" href="#asynchronism" title="Permalink to this headline">¶</a></h3>
<p>Asynchronous import means that after the user creates the import task, Doris directly returns to the successful creation. <strong>Successful creation does not mean that data has been imported into</strong>. The import task will be executed asynchronously. After successful creation, users need to send a polling command to check the status of the import job. If the creation fails, you can judge whether it needs to be created again based on the failure information.</p>
<p>The ways to import asynchronous types are: <strong>Broker load</strong>, <strong>Multi load</strong>.</p>
<p>Operation steps:</p>
<ol class="simple">
<li>Users (external systems) create import tasks.</li>
<li>Doris returns the import creation result.</li>
<li>User (external system) judges the result of import creation, success enters 4, failure returns to retry to create import, return to 1.</li>
<li>The user (external system) polls to see the import task until the status changes to FINISHED or CANCELLED.</li>
</ol>
</div>
<div class="section" id="notes">
<h3>Notes<a class="headerlink" href="#notes" title="Permalink to this headline">¶</a></h3>
<p>Neither asynchronous nor synchronous import types should be retried endlessly after Doris returns an import failure or an import creation failure. <strong>After a limited number of retries and failures, the external system retains the failure information. Most of the retries fail because of the problem of using method or data itself.</strong></p>
</div>
</div>
<div class="section" id="best-practices">
<h2>Best Practices<a class="headerlink" href="#best-practices" title="Permalink to this headline">¶</a></h2>
<p>When users access Doris import, they usually use program access mode to ensure that data is imported into Doris regularly. Below is a brief description of the best practices for program access to Doris.</p>
<ol class="simple">
<li>Choose the appropriate import mode: According to the location of the data source, choose the import mode. For example, if raw data is stored on HDFS, import it using Broker load.</li>
<li>Protocol for determining the import mode: If Broker load import mode is selected, external systems need to be able to submit and view import jobs regularly using MySQL protocol.</li>
<li>Determine the type of import mode: import mode is synchronous or asynchronous. For example, Broker load is an asynchronous import mode. After submitting the creation import, the external system must call the check import command to determine whether the import is successful or not based on the results of the check import command.</li>
<li>Label generation strategy: Label generation strategy needs to be satisfied, and each batch of data is unique and fixed. Doris can then guarantee At-Most-Once.</li>
<li>The program itself guarantees At-Least-Once: The external system needs to guarantee its own At-Least-Once, so that Exactly-Once of the import process can be guaranteed.</li>
</ol>
</div>
<div class="section" id="general-system-configuration">
<h2>General System Configuration<a class="headerlink" href="#general-system-configuration" title="Permalink to this headline">¶</a></h2>
<p>The following sections explain several system-level configurations that are common to all imports.</p>
<div class="section" id="fe-configuration">
<h3>FE configuration<a class="headerlink" href="#fe-configuration" title="Permalink to this headline">¶</a></h3>
<p>The following configuration belongs to the system configuration of FE, which can be modified by modifying the configuration file <code class="docutils literal notranslate"><span class="pre">fe.conf</span></code>.</p>
<ul>
<li><p class="first">max_load_timeout_second 和 min_load_timeout_second</p>
<p>The two configurations mean the maximum import timeout time and the minimum import timeout time in seconds. The default maximum timeout time is 3 days and the default minimum timeout time is 1 second. User-defined import timeouts should not exceed this range. This parameter is applicable to all import modes.</p>
</li>
<li><p class="first">desired_max_waiting_jobs</p>
<p>The maximum number of imported tasks in the waiting queue is 100 by default. New import requests are rejected when the number of imports in the PENDING state (i.e. waiting for execution) in FE exceeds that value.</p>
<p>This configuration is only valid for asynchronous execution of imports. When the number of import waiting for asynchronous execution exceeds the default value, subsequent creation of import requests will be rejected.</p>
</li>
<li><p class="first">max_running_txn_num_per_db</p>
<p>The implication of this configuration is that the maximum number of imports running in each database (no distinction between import types, uniform counting). When the current database is running more than the maximum number of imports, subsequent imports will not be executed. If the job is imported synchronously, the import will be rejected. If it is an asynchronous import job. The job will wait in the queue.</p>
</li>
</ul>
</div>
<div class="section" id="be-configuration">
<h3>BE configuration<a class="headerlink" href="#be-configuration" title="Permalink to this headline">¶</a></h3>
<p>The following configuration belongs to the BE system configuration, which can be modified by modifying the BE configuration file <code class="docutils literal notranslate"><span class="pre">be.conf</span></code>.</p>
<ul>
<li><p class="first">push_write_mbytes_per_sec</p>
<p>Writing speed limit for a single Tablet on BE. The default is 10, or 10MB/s. Usually the maximum write speed of BE to a single Tablet is between 10 and 30 MB/s, depending on Schema and the system. This parameter can be adjusted appropriately to control the import speed.</p>
</li>
<li><p class="first">write_buffer_size</p>
<p>The imported data will be written to a memtable on BE, and the memtable will not be written back to disk until it reaches the threshold. The default size is 100MB. Too small threshold may result in a large number of small files on BE. This threshold can be increased appropriately to reduce the number of files. However, excessive thresholds can lead to RPC timeouts, as shown in the configuration instructions below.</p>
</li>
<li><p class="first">tablet_writer_rpc_timeout_sec</p>
<p>During the import process, a Batch (1024 rows) RPC timeout is sent. Default 600 seconds. Because the RPC may involve multiple memtable writes, it may cause RPC timeouts, which can be adjusted appropriately to reduce timeout errors (such as <code class="docutils literal notranslate"><span class="pre">send</span> <span class="pre">batch</span> <span class="pre">fail</span></code>). At the same time, if the <code class="docutils literal notranslate"><span class="pre">write_buffer_size</span></code> configuration is increased, this parameter needs to be adjusted appropriately.</p>
</li>
<li><p class="first">streaming_load_rpc_max_alive_time_sec</p>
<p>During the import process, Doris opens a Writer for each Tablet to receive and write data. This parameter specifies Writer’s waiting timeout time. If Writer does not receive any data at this time, Writer will be destroyed automatically. When the system processing speed is slow, Writer may not receive the next batch of data for a long time, resulting in import error: <code class="docutils literal notranslate"><span class="pre">Tablet</span> <span class="pre">Writer</span> <span class="pre">add</span> <span class="pre">batch</span> <span class="pre">with</span> <span class="pre">unknown</span> <span class="pre">id</span></code>. This configuration can be increased appropriately at this time. The default is 600 seconds.</p>
</li>
</ul>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="broker-load-manual_EN.html" class="btn btn-neutral float-right" title="Broker Load" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="index.html" class="btn btn-neutral float-left" title="Load Data" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, Apache Doris(Incubating)

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
<div role="contentinfo">
    <p></p>
    <p>

        Apache Doris is an effort undergoing incubation at The Apache Software Foundation (ASF), sponsored by the name of Apache TLP sponsor. Incubation is required of all newly accepted projects until a further review indicates that the infrastructure, communications, and decision making process have stabilized in a manner consistent with other successful ASF projects. While incubation status is not necessarily a reflection of the completeness or stability of the code, it does indicate that the project has yet to be fully endorsed by the ASF.

    </p>
</div>


</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>