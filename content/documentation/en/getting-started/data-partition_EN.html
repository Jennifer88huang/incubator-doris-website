

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Data Partition &mdash; Doris Documentations 0.11.0 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="Data Model, ROLLUP and Prefix Index" href="data-model-rollup_EN.html" />
    <link rel="prev" title="Best Practices" href="best-practice_EN.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../index.html" class="icon icon-home"> Doris Documentations
          

          
          </a>

          
            
            
              <div class="version">
                0.11.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../cn/index.html">中文</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">English</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../installing/index.html">Compilation and deployment</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html">Getting started</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="basic-usage_EN.html">Guidelines for Basic Use</a></li>
<li class="toctree-l3"><a class="reference internal" href="advance-usage_EN.html">Advanced Use Guide</a></li>
<li class="toctree-l3"><a class="reference internal" href="best-practice_EN.html">Best Practices</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Data Partition</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#basic-concepts">Basic Concepts</a></li>
<li class="toctree-l4"><a class="reference internal" href="#data-division">Data division</a></li>
<li class="toctree-l4"><a class="reference internal" href="#common-problem">common problem</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="data-model-rollup_EN.html">Data Model, ROLLUP and Prefix Index</a></li>
<li class="toctree-l3"><a class="reference internal" href="hit-the-rollup_EN.html">Rollup and query</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../administrator-guide/index.html">Administrator Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="../extending-doris/index.html">Extending Ability</a></li>
<li class="toctree-l2"><a class="reference internal" href="../internal/index.html">Design Documents</a></li>
<li class="toctree-l2"><a class="reference internal" href="../sql-reference/index.html">SQL Manual</a></li>
<li class="toctree-l2"><a class="reference internal" href="../developer-guide/index.html">Developer Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="../community/index.html">Apache Commnity</a></li>
</ul>
</li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">Doris Documentations</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../index.html">English</a> &raquo;</li>
        
          <li><a href="index.html">Getting started</a> &raquo;</li>
        
      <li>Data Partition</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            
              <a href="https://github.com/apache/incubator-doris/blob/master/docs/documentation/en/getting-started/data-partition_EN.md" class="fa fa-github"> Edit on GitHub</a>
            
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <!-- 
Licensed to the Apache Software Foundation (ASF) under one
or more contributor license agreements.  See the NOTICE file
distributed with this work for additional information
regarding copyright ownership.  The ASF licenses this file
to you under the Apache License, Version 2.0 (the
"License"); you may not use this file except in compliance
with the License.  You may obtain a copy of the License at

  http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing,
software distributed under the License is distributed on an
"AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, either express or implied.  See the License for the
specific language governing permissions and limitations
under the License.
--><div class="section" id="data-partition">
<h1>Data Partition<a class="headerlink" href="#data-partition" title="Permalink to this headline">¶</a></h1>
<p>This document mainly introduces Doris’s table construction and data partitioning, as well as problems and solutions that may be encountered in the construction of the table.</p>
<div class="section" id="basic-concepts">
<h2>Basic Concepts<a class="headerlink" href="#basic-concepts" title="Permalink to this headline">¶</a></h2>
<p>In Doris, data is logically described in the form of a table.</p>
<div class="section" id="row-column">
<h3>Row &amp; Column<a class="headerlink" href="#row-column" title="Permalink to this headline">¶</a></h3>
<p>A table includes rows (rows) and columns (columns). Row is a row of data for the user. Column is used to describe different fields in a row of data.</p>
<p>Column can be divided into two broad categories: Key and Value. From a business perspective, Key and Value can correspond to dimension columns and metric columns, respectively. From the perspective of the aggregation model, the same row of Key columns will be aggregated into one row. The way the Value column is aggregated is specified by the user when the table is built. For an introduction to more aggregation models, see the [Doris Data Model] (./data-model-rollup.md).</p>
</div>
<div class="section" id="tablet-partition">
<h3>Tablet &amp; Partition<a class="headerlink" href="#tablet-partition" title="Permalink to this headline">¶</a></h3>
<p>In Doris’s storage engine, user data is horizontally divided into several data slices (also known as data buckets). Each tablet contains several rows of data. The data between the individual tablets does not intersect and is physically stored independently.</p>
<p>Multiple tablets are logically attributed to different partitions. A tablet belongs to only one Partition. And a Partition contains several Tablets. Because the tablet is physically stored independently, it can be considered that the Partition is physically independent. Tablet is the smallest physical storage unit for data movement, replication, and so on.</p>
<p>Several Partitions form a Table. Partition can be thought of as the smallest logical unit of management. Importing and deleting data can be done for one Partition or only for one Partition.</p>
</div>
</div>
<div class="section" id="data-division">
<h2>Data division<a class="headerlink" href="#data-division" title="Permalink to this headline">¶</a></h2>
<p>We use a table-building operation to illustrate Doris’ data partitioning.</p>
<p>Doris’s built-in table is a synchronous command. If the command returns successfully, it means that the table is built successfully.</p>
<p>See more help with <code class="docutils literal notranslate"><span class="pre">HELP</span> <span class="pre">CREATE</span> <span class="pre">TABLE;</span></code>.</p>
<p>This section introduces Doris’s approach to building tables with an example.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>CREATE TABLE IF NOT EXISTS example_db.expamle_tbl
(
    `user_id` LARGEINT NOT NULL COMMENT &quot;user id&quot;,
    `date` DATE NOT NULL COMMENT &quot;Data fill in date time&quot;,
    `timestamp` DATETIME NOT NULL COMMENT &quot;Timestamp of data being poured&quot;,
    `city` VARCHAR(20) COMMENT &quot;The city where the user is located&quot;,
    `age` SMALLINT COMMENT &quot;user age&quot;,
    `sex` TINYINT COMMENT &quot;User Gender&quot;,
    `last_visit_date` DATETIME REPLACE DEFAULT &quot;1970-01-01 00:00:00&quot; COMMENT &quot;User last visit time&quot;,
    `cost` BIGINT SUM DEFAULT &quot;0&quot; COMMENT &quot;Total user consumption&quot;,
    `max_dwell_time` INT MAX DEFAULT &quot;0&quot; COMMENT &quot;User maximum dwell time&quot;,
    `min_dwell_time` INT MIN DEFAULT &quot;99999&quot; COMMENT &quot;User minimum dwell time&quot;
)
ENGINE=olap
AGGREGATE KEY(`user_id`, `date`, `timestamp`, `city`, `age`, `sex`)
PARTITION BY RANGE(`date`)
(
    PARTITION `p201701` VALUES LESS THAN (&quot;2017-02-01&quot;),
    PARTITION `p201702` VALUES LESS THAN (&quot;2017-03-01&quot;),
    PARTITION `p201703` VALUES LESS THAN (&quot;2017-04-01&quot;)
)
DISTRIBUTED BY HASH(`user_id`) BUCKETS 16
PROPERTIES
(
    &quot;replication_num&quot; = &quot;3&quot;,
    &quot;storage_medium&quot; = &quot;SSD&quot;,
    &quot;storage_cooldown_time&quot; = &quot;2018-01-01 12:00:00&quot;
);
</pre></div>
</div>
<div class="section" id="column-definition">
<h3>Column Definition<a class="headerlink" href="#column-definition" title="Permalink to this headline">¶</a></h3>
<p>Here we only use the AGGREGATE KEY data model as an example. See the [Doris Data Model] (./data-model-rollup.md) for more data models.</p>
<p>The basic type of column can be viewed by executing <code class="docutils literal notranslate"><span class="pre">HELP</span> <span class="pre">CREATE</span> <span class="pre">TABLE;</span></code> in mysql-client.</p>
<p>In the AGGREGATE KEY data model, all columns that do not specify an aggregation mode (SUM, REPLACE, MAX, MIN) are treated as Key columns. The rest is the Value column.</p>
<p>When defining columns, you can refer to the following suggestions:</p>
<ol class="simple">
<li>The Key column must precede all Value columns.</li>
<li>Try to choose the type of integer. Because integer type calculations and lookups are much more efficient than strings.</li>
<li>For the selection principle of integer types of different lengths, follow ** enough to **.</li>
<li>For lengths of type VARCHAR and STRING, follow ** is sufficient.</li>
<li>The total byte length of all columns (including Key and Value) cannot exceed 100KB.</li>
</ol>
</div>
<div class="section" id="partitioning-and-binning">
<h3>Partitioning and binning<a class="headerlink" href="#partitioning-and-binning" title="Permalink to this headline">¶</a></h3>
<p>Doris supports two levels of data partitioning. The first layer is Partition, which only supports the division of Range. The second layer is Bucket (Tablet), which only supports the way Hash is divided.</p>
<p>It is also possible to use only one layer of partitioning. When using a layer partition, only Bucket partitioning is supported.</p>
<ol>
<li><p class="first">Partition</p>
<ul>
<li><p class="first">The Partition column can specify one or more columns. The partition class must be a KEY column. The use of multi-column partitions is described later in the <strong>Multi-column partitioning</strong> summary.</p>
</li>
<li><p class="first">Regardless of the type of partition column, double quotes are required when writing partition values.</p>
</li>
<li><p class="first">Partition columns are usually time columns for easy management of old and new data.</p>
</li>
<li><p class="first">There is no theoretical limit on the number of partitions.</p>
</li>
<li><p class="first">When you do not use Partition to build a table, the system will automatically generate a Partition with the same name as the table name. This Partition is not visible to the user and cannot be modified.</p>
</li>
<li><p class="first">Partition supports only the upper bound by <code class="docutils literal notranslate"><span class="pre">VALUES</span> <span class="pre">LESS</span> <span class="pre">THAN</span> <span class="pre">(...)</span></code>, the system will use the upper bound of the previous partition as the lower bound of the partition, and generate a left closed right open interval. Passing, also supports specifying the upper and lower bounds by <code class="docutils literal notranslate"><span class="pre">VALUES</span> <span class="pre">[...)</span></code>, and generating a left closed right open interval.</p>
</li>
<li><p class="first">It is easier to understand by specifying <code class="docutils literal notranslate"><span class="pre">VALUES</span> <span class="pre">[...)</span></code>. Here is an example of the change in partition range when adding or deleting partitions using the <code class="docutils literal notranslate"><span class="pre">VALUES</span> <span class="pre">LESS</span> <span class="pre">THAN</span> <span class="pre">(...)</span></code> statement:</p>
<ul>
<li><p class="first">As the example above, when the table is built, the following 3 partitions are automatically generated:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">P201701</span><span class="p">:</span> <span class="p">[</span><span class="n">MIN_VALUE</span><span class="p">,</span> <span class="mi">2017</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">01</span><span class="p">)</span>
<span class="n">P201702</span><span class="p">:</span> <span class="p">[</span><span class="mi">2017</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">01</span><span class="p">,</span> <span class="mi">2017</span><span class="o">-</span><span class="mi">03</span><span class="o">-</span><span class="mi">01</span><span class="p">)</span>
<span class="n">P201703</span><span class="p">:</span> <span class="p">[</span><span class="mi">2017</span><span class="o">-</span><span class="mi">03</span><span class="o">-</span><span class="mi">01</span><span class="p">,</span> <span class="mi">2017</span><span class="o">-</span><span class="mi">04</span><span class="o">-</span><span class="mi">01</span><span class="p">)</span>
</pre></div>
</div>
</li>
<li><p class="first">When we add a partition p201705 VALUES LESS THAN (“2017-06-01”), the partition results are as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">P201701</span><span class="p">:</span> <span class="p">[</span><span class="n">MIN_VALUE</span><span class="p">,</span> <span class="mi">2017</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">01</span><span class="p">)</span>
<span class="n">P201702</span><span class="p">:</span> <span class="p">[</span><span class="mi">2017</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">01</span><span class="p">,</span> <span class="mi">2017</span><span class="o">-</span><span class="mi">03</span><span class="o">-</span><span class="mi">01</span><span class="p">)</span>
<span class="n">P201703</span><span class="p">:</span> <span class="p">[</span><span class="mi">2017</span><span class="o">-</span><span class="mi">03</span><span class="o">-</span><span class="mi">01</span><span class="p">,</span> <span class="mi">2017</span><span class="o">-</span><span class="mi">04</span><span class="o">-</span><span class="mi">01</span><span class="p">)</span>
<span class="n">P201705</span><span class="p">:</span> <span class="p">[</span><span class="mi">2017</span><span class="o">-</span><span class="mi">04</span><span class="o">-</span><span class="mi">01</span><span class="p">,</span> <span class="mi">2017</span><span class="o">-</span><span class="mi">06</span><span class="o">-</span><span class="mi">01</span><span class="p">)</span>
</pre></div>
</div>
</li>
<li><p class="first">At this point we delete the partition p201703, the partition results are as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">p201701</span><span class="p">:</span> <span class="p">[</span><span class="n">MIN_VALUE</span><span class="p">,</span> <span class="mi">2017</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">01</span><span class="p">)</span>
<span class="n">p201702</span><span class="p">:</span> <span class="p">[</span><span class="mi">2017</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">01</span><span class="p">,</span> <span class="mi">2017</span><span class="o">-</span><span class="mi">03</span><span class="o">-</span><span class="mi">01</span><span class="p">)</span>
<span class="n">p201705</span><span class="p">:</span> <span class="p">[</span><span class="mi">2017</span><span class="o">-</span><span class="mi">04</span><span class="o">-</span><span class="mi">01</span><span class="p">,</span> <span class="mi">2017</span><span class="o">-</span><span class="mi">06</span><span class="o">-</span><span class="mi">01</span><span class="p">)</span>
</pre></div>
</div>
<blockquote>
<div><p>Note that the partition range of p201702 and p201705 has not changed, and there is a hole between the two partitions: [2017-03-01, 2017-04-01). That is, if the imported data range is within this hole, it cannot be imported.</p>
</div></blockquote>
</li>
<li><p class="first">Continue to delete partition p201702, the partition results are as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">p201701</span><span class="p">:</span> <span class="p">[</span><span class="n">MIN_VALUE</span><span class="p">,</span> <span class="mi">2017</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">01</span><span class="p">)</span>
<span class="n">p201705</span><span class="p">:</span> <span class="p">[</span><span class="mi">2017</span><span class="o">-</span><span class="mi">04</span><span class="o">-</span><span class="mi">01</span><span class="p">,</span> <span class="mi">2017</span><span class="o">-</span><span class="mi">06</span><span class="o">-</span><span class="mi">01</span><span class="p">)</span>
<span class="n">The</span> <span class="n">void</span> <span class="nb">range</span> <span class="n">becomes</span><span class="p">:</span> <span class="p">[</span><span class="mi">2017</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">01</span><span class="p">,</span> <span class="mi">2017</span><span class="o">-</span><span class="mi">04</span><span class="o">-</span><span class="mi">01</span><span class="p">)</span>
</pre></div>
</div>
</li>
<li><p class="first">Now add a partition p201702new VALUES LESS THAN (“2017-03-01”), the partition results are as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">p201701</span><span class="p">:</span> <span class="p">[</span><span class="n">MIN_VALUE</span><span class="p">,</span> <span class="mi">2017</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">01</span><span class="p">)</span>
<span class="n">p201702new</span><span class="p">:</span> <span class="p">[</span><span class="mi">2017</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">01</span><span class="p">,</span> <span class="mi">2017</span><span class="o">-</span><span class="mi">03</span><span class="o">-</span><span class="mi">01</span><span class="p">)</span>
<span class="n">p201705</span><span class="p">:</span> <span class="p">[</span><span class="mi">2017</span><span class="o">-</span><span class="mi">04</span><span class="o">-</span><span class="mi">01</span><span class="p">,</span> <span class="mi">2017</span><span class="o">-</span><span class="mi">06</span><span class="o">-</span><span class="mi">01</span><span class="p">)</span>
</pre></div>
</div>
<blockquote>
<div><p>You can see that the hole size is reduced to: [2017-03-01, 2017-04-01)</p>
</div></blockquote>
</li>
<li><p class="first">Now delete partition p201701 and add partition p201612 VALUES LESS THAN (“2017-01-01”), the partition result is as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">p201612</span><span class="p">:</span> <span class="p">[</span><span class="n">MIN_VALUE</span><span class="p">,</span> <span class="mi">2017</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span><span class="p">)</span>
<span class="n">p201702new</span><span class="p">:</span> <span class="p">[</span><span class="mi">2017</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">01</span><span class="p">,</span> <span class="mi">2017</span><span class="o">-</span><span class="mi">03</span><span class="o">-</span><span class="mi">01</span><span class="p">)</span>
<span class="n">p201705</span><span class="p">:</span> <span class="p">[</span><span class="mi">2017</span><span class="o">-</span><span class="mi">04</span><span class="o">-</span><span class="mi">01</span><span class="p">,</span> <span class="mi">2017</span><span class="o">-</span><span class="mi">06</span><span class="o">-</span><span class="mi">01</span><span class="p">)</span>
</pre></div>
</div>
<blockquote>
<div><p>A new void appeared: [2017-01-01, 2017-02-01)</p>
</div></blockquote>
</li>
</ul>
</li>
</ul>
<p>In summary, the deletion of a partition does not change the scope of an existing partition. There may be holes in deleting partitions. When a partition is added by the <code class="docutils literal notranslate"><span class="pre">VALUES</span> <span class="pre">LESS</span> <span class="pre">THAN</span></code> statement, the lower bound of the partition immediately follows the upper bound of the previous partition.</p>
<p>You cannot add partitions with overlapping ranges.</p>
</li>
<li><p class="first">Bucket</p>
<ul class="simple">
<li>If a Partition is used, the <code class="docutils literal notranslate"><span class="pre">DISTRIBUTED</span> <span class="pre">...</span></code> statement describes the division rules for the data in each partition. If you do not use Partition, it describes the rules for dividing the data of the entire table.</li>
<li>The bucket column can be multiple columns, but it must be a Key column. The bucket column can be the same or different from the Partition column.</li>
<li>The choice of bucket column is a trade-off between <strong>query throughput</strong> and <strong>query concurrency</strong>:<ol>
<li>If you select multiple bucket columns, the data is more evenly distributed. However, if the query condition does not include the equivalent condition for all bucket columns, a query will scan all buckets. The throughput of such queries will increase, but the latency of a single query will increase. This method is suitable for large throughput and low concurrent query scenarios.</li>
<li>If you select only one or a few bucket columns, the point query can query only one bucket. This approach is suitable for high-concurrency point query scenarios.</li>
</ol>
</li>
<li>There is no theoretical limit on the number of buckets.</li>
</ul>
</li>
<li><p class="first">Recommendations on the number and amount of data for Partitions and Buckets.</p>
<ul class="simple">
<li>The total number of tablets in a table is equal to (Partition num * Bucket num).</li>
<li>The number of tablets in a table, which is slightly more than the number of disks in the entire cluster, regardless of capacity expansion.</li>
<li>The data volume of a single tablet does not theoretically have an upper and lower bound, but is recommended to be in the range of 1G - 10G. If the amount of data for a single tablet is too small, the aggregation of the data is not good and the metadata management pressure is high. If the amount of data is too large, it is not conducive to the migration, completion, and increase the cost of Schema Change or Rollup operation failure retry (the granularity of these operations failure retry is Tablet).</li>
<li>When the tablet’s data volume principle and quantity principle conflict, it is recommended to prioritize the data volume principle.</li>
<li>When building a table, the number of Buckets for each partition is uniformly specified. However, when dynamically increasing partitions (<code class="docutils literal notranslate"><span class="pre">ADD</span> <span class="pre">PARTITION</span></code>), you can specify the number of Buckets for the new partition separately. This feature can be used to easily reduce or expand data.</li>
<li>Once the number of Buckets for a Partition is specified, it cannot be changed. Therefore, when determining the number of Buckets, you need to consider the expansion of the cluster in advance. For example, there are currently only 3 hosts, and each host has 1 disk. If the number of Buckets is only set to 3 or less, then even if you add more machines later, you can’t increase the concurrency.</li>
<li>Give some examples: Suppose there are 10 BEs, one for each BE disk. If the total size of a table is 500MB, you can consider 4-8 shards. 5GB: 8-16. 50GB: 32. 500GB: Recommended partitions, each partition is about 50GB in size, with 16-32 shards per partition. 5TB: Recommended partitions, each with a size of around 50GB and 16-32 shards per partition.</li>
</ul>
<blockquote>
<div><p>Note: The amount of data in the table can be viewed by the <code class="docutils literal notranslate"><span class="pre">show</span> <span class="pre">data</span></code> command. The result is divided by the number of copies, which is the amount of data in the table.</p>
</div></blockquote>
</li>
</ol>
<div class="section" id="multi-column-partition">
<h4>Multi-column partition<a class="headerlink" href="#multi-column-partition" title="Permalink to this headline">¶</a></h4>
<p>Doris supports specifying multiple columns as partition columns, examples are as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>PARTITION BY RANGE(`date`, `id`)
(
    PARTITION `p201701_1000` VALUES LESS THAN (&quot;2017-02-01&quot;, &quot;1000&quot;),
    PARTITION `p201702_2000` VALUES LESS THAN (&quot;2017-03-01&quot;, &quot;2000&quot;),
    PARTITION `p201703_all` VALUES LESS THAN (&quot;2017-04-01&quot;)
)
</pre></div>
</div>
<p>In the above example, we specify <code class="docutils literal notranslate"><span class="pre">date</span></code> (DATE type) and <code class="docutils literal notranslate"><span class="pre">id</span></code> (INT type) as partition columns. The resulting partitions in the above example are as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">*</span><span class="n">p201701_1000</span><span class="p">:</span> <span class="p">[(</span><span class="n">MIN_VALUE</span><span class="p">,</span> <span class="n">MIN_VALUE</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;2017-02-01&quot;</span><span class="p">,</span> <span class="s2">&quot;1000&quot;</span><span class="p">)</span> <span class="p">)</span>
<span class="o">*</span><span class="n">p201702_2000</span><span class="p">:</span> <span class="p">[(</span><span class="s2">&quot;2017-02-01&quot;</span><span class="p">,</span> <span class="s2">&quot;1000&quot;</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;2017-03-01&quot;</span><span class="p">,</span> <span class="s2">&quot;2000&quot;</span><span class="p">)</span> <span class="p">)</span>
<span class="o">*</span><span class="n">p201703_all</span><span class="p">:</span> <span class="p">[(</span><span class="s2">&quot;2017-03-01&quot;</span><span class="p">,</span> <span class="s2">&quot;2000&quot;</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;2017-04-01&quot;</span><span class="p">,</span> <span class="n">MIN_VALUE</span><span class="p">))</span>
</pre></div>
</div>
<p>Note that the last partition user defaults only the partition value of the <code class="docutils literal notranslate"><span class="pre">date</span></code> column, so the partition value of the <code class="docutils literal notranslate"><span class="pre">id</span></code> column will be filled with <code class="docutils literal notranslate"><span class="pre">MIN_VALUE</span></code> by default. When the user inserts data, the partition column values ​​are compared in order, and the corresponding partition is finally obtained. Examples are as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">*</span> <span class="n">Data</span> <span class="o">--&gt;</span> <span class="n">Partition</span>
<span class="o">*</span> <span class="mi">2017</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span><span class="p">,</span> <span class="mi">200</span> <span class="o">--&gt;</span> <span class="n">p201701_1000</span>
<span class="o">*</span> <span class="mi">2017</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span><span class="p">,</span> <span class="mi">2000</span> <span class="o">--&gt;</span> <span class="n">p201701_1000</span>
<span class="o">*</span> <span class="mi">2017</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">01</span><span class="p">,</span> <span class="mi">100</span> <span class="o">--&gt;</span> <span class="n">p201701_1000</span>
<span class="o">*</span> <span class="mi">2017</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">01</span><span class="p">,</span> <span class="mi">2000</span> <span class="o">--&gt;</span> <span class="n">p201702_2000</span>
<span class="o">*</span> <span class="mi">2017</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">15</span><span class="p">,</span> <span class="mi">5000</span> <span class="o">--&gt;</span> <span class="n">p201702_2000</span>
<span class="o">*</span> <span class="mi">2017</span><span class="o">-</span><span class="mi">03</span><span class="o">-</span><span class="mi">01</span><span class="p">,</span> <span class="mi">2000</span> <span class="o">--&gt;</span> <span class="n">p201703_all</span>
<span class="o">*</span> <span class="mi">2017</span><span class="o">-</span><span class="mi">03</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="mi">1</span> <span class="o">--&gt;</span> <span class="n">p201703_all</span>
<span class="o">*</span> <span class="mi">2017</span><span class="o">-</span><span class="mi">04</span><span class="o">-</span><span class="mi">01</span><span class="p">,</span> <span class="mi">1000</span> <span class="o">--&gt;</span> <span class="n">Unable</span> <span class="n">to</span> <span class="kn">import</span>
<span class="o">*</span> <span class="mi">2017</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">01</span><span class="p">,</span> <span class="mi">1000</span> <span class="o">--&gt;</span> <span class="n">Unable</span> <span class="n">to</span> <span class="kn">import</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="properties">
<h3>PROPERTIES<a class="headerlink" href="#properties" title="Permalink to this headline">¶</a></h3>
<p>In the last PROPERTIES of the table statement, you can specify the following two parameters:</p>
<p>Replication_num</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">*</span> <span class="n">The</span> <span class="n">number</span> <span class="n">of</span> <span class="n">copies</span> <span class="n">per</span> <span class="n">tablet</span><span class="o">.</span> <span class="n">The</span> <span class="n">default</span> <span class="ow">is</span> <span class="mi">3</span><span class="p">,</span> <span class="n">it</span> <span class="ow">is</span> <span class="n">recommended</span> <span class="n">to</span> <span class="n">keep</span> <span class="n">the</span> <span class="n">default</span><span class="o">.</span> <span class="n">In</span> <span class="n">the</span> <span class="n">build</span> <span class="n">statement</span><span class="p">,</span> <span class="n">the</span> <span class="n">number</span> <span class="n">of</span> <span class="n">Tablet</span> <span class="n">copies</span> <span class="ow">in</span> <span class="nb">all</span> <span class="n">Partitions</span> <span class="ow">is</span> <span class="n">uniformly</span> <span class="n">specified</span><span class="o">.</span> <span class="n">When</span> <span class="n">you</span> <span class="n">add</span> <span class="n">a</span> <span class="n">new</span> <span class="n">partition</span><span class="p">,</span> <span class="n">you</span> <span class="n">can</span> <span class="n">individually</span> <span class="n">specify</span> <span class="n">the</span> <span class="n">number</span> <span class="n">of</span> <span class="n">copies</span> <span class="n">of</span> <span class="n">the</span> <span class="n">tablet</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">new</span> <span class="n">partition</span><span class="o">.</span>
<span class="o">*</span> <span class="n">The</span> <span class="n">number</span> <span class="n">of</span> <span class="n">copies</span> <span class="n">can</span> <span class="n">be</span> <span class="n">modified</span> <span class="n">at</span> <span class="n">runtime</span><span class="o">.</span> <span class="n">It</span> <span class="ow">is</span> <span class="n">strongly</span> <span class="n">recommended</span> <span class="n">to</span> <span class="n">keep</span> <span class="n">odd</span> <span class="n">numbers</span><span class="o">.</span>
<span class="o">*</span> <span class="n">The</span> <span class="n">maximum</span> <span class="n">number</span> <span class="n">of</span> <span class="n">copies</span> <span class="n">depends</span> <span class="n">on</span> <span class="n">the</span> <span class="n">number</span> <span class="n">of</span> <span class="n">independent</span> <span class="n">IPs</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">cluster</span> <span class="p">(</span><span class="n">note</span> <span class="n">that</span> <span class="n">it</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">the</span> <span class="n">number</span> <span class="n">of</span> <span class="n">BEs</span><span class="p">)</span><span class="o">.</span> <span class="n">The</span> <span class="n">principle</span> <span class="n">of</span> <span class="n">replica</span> <span class="n">distribution</span> <span class="ow">in</span> <span class="n">Doris</span> <span class="ow">is</span> <span class="n">that</span> <span class="n">the</span> <span class="n">copies</span> <span class="n">of</span> <span class="n">the</span> <span class="n">same</span> <span class="n">Tablet</span> <span class="n">are</span> <span class="ow">not</span> <span class="n">allowed</span> <span class="n">to</span> <span class="n">be</span> <span class="n">distributed</span> <span class="n">on</span> <span class="n">the</span> <span class="n">same</span> <span class="n">physical</span> <span class="n">machine</span><span class="p">,</span> <span class="ow">and</span> <span class="n">the</span> <span class="n">physical</span> <span class="n">machine</span> <span class="ow">is</span> <span class="n">identified</span> <span class="k">as</span> <span class="n">IP</span><span class="o">.</span> <span class="n">Therefore</span><span class="p">,</span> <span class="n">even</span> <span class="k">if</span> <span class="mi">3</span> <span class="ow">or</span> <span class="n">more</span> <span class="n">BE</span> <span class="n">instances</span> <span class="n">are</span> <span class="n">deployed</span> <span class="n">on</span> <span class="n">the</span> <span class="n">same</span> <span class="n">physical</span> <span class="n">machine</span><span class="p">,</span> <span class="k">if</span> <span class="n">the</span> <span class="n">BEs</span> <span class="n">have</span> <span class="n">the</span> <span class="n">same</span> <span class="n">IP</span><span class="p">,</span> <span class="n">you</span> <span class="n">can</span> <span class="n">only</span> <span class="nb">set</span> <span class="n">the</span> <span class="n">number</span> <span class="n">of</span> <span class="n">copies</span> <span class="n">to</span> <span class="mf">1.</span>
<span class="o">*</span> <span class="n">For</span> <span class="n">some</span> <span class="n">small</span><span class="p">,</span> <span class="ow">and</span> <span class="n">infrequently</span> <span class="n">updated</span> <span class="n">dimension</span> <span class="n">tables</span><span class="p">,</span> <span class="n">consider</span> <span class="n">setting</span> <span class="n">more</span> <span class="n">copies</span><span class="o">.</span> <span class="n">In</span> <span class="n">this</span> <span class="n">way</span><span class="p">,</span> <span class="n">when</span> <span class="n">joining</span> <span class="n">queries</span><span class="p">,</span> <span class="n">there</span> <span class="ow">is</span> <span class="n">a</span> <span class="n">greater</span> <span class="n">probability</span> <span class="n">of</span> <span class="n">local</span> <span class="n">data</span> <span class="n">join</span><span class="o">.</span>
</pre></div>
</div>
<ol class="simple">
<li>storage_medium &amp; storage_cooldown_time<ul>
<li>The BE data storage directory can be explicitly specified as SSD or HDD (differentiated by .SSD or .HDD suffix). When you build a table, you can uniformly specify the media for all Partition initial storage. Note that the suffix is ​​to explicitly specify the disk media without checking to see if it matches the actual media type.</li>
<li>The default initial storage medium is HDD. If specified as an SSD, the data is initially stored on the SSD.</li>
<li>If storage_cooldown_time is not specified, the data is automatically migrated from the SSD to the HDD after 7 days by default. If storage_cooldown_time is specified, the data will not migrate until the storage_cooldown_time time is reached.</li>
<li>Note that this parameter is just a “best effort” setting when storage_medium is specified. Even if no SSD storage media is set in the cluster, no error is reported and it is automatically stored in the available data directory. Similarly, if the SSD media is inaccessible and out of space, the data may initially be stored directly on other available media. When the data expires and is migrated to the HDD, if the HDD media is inaccessible and there is not enough space, the migration may fail (but will continue to try).</li>
</ul>
</li>
</ol>
</div>
<div class="section" id="engine">
<h3>ENGINE<a class="headerlink" href="#engine" title="Permalink to this headline">¶</a></h3>
<p>In this example, the type of ENGINE is olap, the default ENGINE type. In Doris, only this ENGINE type is managed and stored by Doris. Other ENGINE types, such as mysql, broker, es, etc., are essentially mappings to tables in other external databases or systems to ensure that Doris can read the data. And Doris itself does not create, manage, and store any tables and data of a non-olap ENGINE type.</p>
</div>
<div class="section" id="other">
<h3>Other<a class="headerlink" href="#other" title="Permalink to this headline">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">IF</span> <span class="pre">NOT</span> <span class="pre">EXISTS</span></code> indicates that if the table has not been created, it is created. Note that only the table name is judged here, and it is not determined whether the new table structure is the same as the existing table structure. So if there is a table with the same name but different structure, the command will also return success, but it does not mean that a new table and a new structure have been created.</p>
</div>
</div>
<div class="section" id="common-problem">
<h2>common problem<a class="headerlink" href="#common-problem" title="Permalink to this headline">¶</a></h2>
<div class="section" id="build-table-operations-faq">
<h3>Build Table Operations FAQ<a class="headerlink" href="#build-table-operations-faq" title="Permalink to this headline">¶</a></h3>
<ol>
<li><p class="first">If a syntax error occurs in a long build statement, a syntax error may be incomplete. Here is a list of possible syntax errors for manual error correction:</p>
<ul class="simple">
<li>The syntax is incorrect. Please read <code class="docutils literal notranslate"><span class="pre">HELP</span> <span class="pre">CREATE</span> <span class="pre">TABLE;</span></code> carefully to check the relevant syntax structure.</li>
<li>Reserved words. When the user-defined name encounters a reserved word, it needs to be enclosed in the backquote ``. It is recommended that all custom names be generated using this symbol.</li>
<li>Chinese characters or full-width characters. Non-utf8 encoded Chinese characters, or hidden full-width characters (spaces, punctuation, etc.) can cause syntax errors. It is recommended to check with a text editor with invisible characters.</li>
</ul>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">Failed</span> <span class="pre">to</span> <span class="pre">create</span> <span class="pre">partition</span> <span class="pre">[xxx]</span> <span class="pre">.</span> <span class="pre">Timeout</span></code></p>
<p>Doris builds are created in order of Partition granularity. This error may be reported when a Partition creation fails. Even if you don’t use Partition, you will report <code class="docutils literal notranslate"><span class="pre">Failed</span> <span class="pre">to</span> <span class="pre">create</span> <span class="pre">partition</span></code> when there is a problem with the built table, because as mentioned earlier, Doris will create an unchangeable default Partition for tables that do not have a Partition specified.</p>
<p>When this error is encountered, it is usually the BE that has encountered problems creating data fragments. You can follow the steps below to troubleshoot:</p>
<ol class="simple">
<li>In fe.log, find the <code class="docutils literal notranslate"><span class="pre">Failed</span> <span class="pre">to</span> <span class="pre">create</span> <span class="pre">partition</span></code> log for the corresponding point in time. In this log, a series of numbers like <code class="docutils literal notranslate"><span class="pre">{10001-10010}</span></code> will appear. The first number of the pair is the Backend ID and the second number is the Tablet ID. As for the pair of numbers above, on the Backend with ID 10001, creating a tablet with ID 10010 failed.</li>
<li>Go to the be.INFO log corresponding to Backend and find the log related to the tablet id in the corresponding time period. You can find the error message.</li>
<li>Listed below are some common tablet creation failure errors, including but not limited to:<ul>
<li>BE did not receive the relevant task, and the tablet id related log could not be found in be.INFO. Or the BE is created successfully, but the report fails. For the above questions, see [Deployment and Upgrade Documentation] to check the connectivity of FE and BE.</li>
<li>Pre-allocated memory failed. It may be that the length of a line in a row in the table exceeds 100KB.</li>
<li><code class="docutils literal notranslate"><span class="pre">Too</span> <span class="pre">many</span> <span class="pre">open</span> <span class="pre">files</span></code>. The number of open file handles exceeds the Linux system limit. The handle limit of the Linux system needs to be modified.</li>
</ul>
</li>
</ol>
<p>You can also extend the timeout by setting <code class="docutils literal notranslate"><span class="pre">tablet_create_timeout_second=xxx</span></code> in fe.conf. The default is 2 seconds.</p>
</li>
<li><p class="first">The build table command does not return results for a long time.</p>
<p>Doris’s table creation command is a synchronous command. The timeout of this command is currently set to be relatively simple, ie (tablet num * replication num) seconds. If you create more data fragments and have fragment creation failed, it may cause an error to be returned after waiting for a long timeout.</p>
<p>Under normal circumstances, the statement will return in a few seconds or ten seconds. If it is more than one minute, it is recommended to cancel this operation directly and go to the FE or BE log to view the related errors.</p>
</li>
</ol>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="data-model-rollup_EN.html" class="btn btn-neutral float-right" title="Data Model, ROLLUP and Prefix Index" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="best-practice_EN.html" class="btn btn-neutral float-left" title="Best Practices" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, Apache Doris(Incubating)

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
<div role="contentinfo">
    <p></p>
    <p>

        Apache Doris(incubating) is an effort undergoing incubation at The Apache Software Foundation (ASF), sponsored by the Apache Incubator. Incubation is required of all newly accepted projects until a further review indicates that the infrastructure, communications, and decision making process have stabilized in a manner consistent with other successful ASF projects. While incubation status is not necessarily a reflection of the completeness or stability of the code, it does indicate that the project has yet to be fully endorsed by the ASF.

    </p>
</div>


</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>