

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Data partition &mdash; Doris Documentations 0.11.0 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="Data Model, ROLLUP and Prefix Index" href="data-model-rollup_EN.html" />
    <link rel="prev" title="Best Practices" href="best-practice_EN.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../index.html" class="icon icon-home"> Doris Documentations
          

          
          </a>

          
            
            
              <div class="version">
                0.11.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../cn/index.html">中文</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">English</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../installing/index.html">Compilation and deployment</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html">Getting started</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="basic-usage_EN.html">Guidelines for Basic Use</a></li>
<li class="toctree-l3"><a class="reference internal" href="advance-usage_EN.html">Advanced Use Guide</a></li>
<li class="toctree-l3"><a class="reference internal" href="best-practice_EN.html">Best Practices</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Data partition</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#basic-concepts">Basic concepts</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id1">Data partition</a></li>
<li class="toctree-l4"><a class="reference internal" href="#common-questions">Common Questions</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="data-model-rollup_EN.html">Data Model, ROLLUP and Prefix Index</a></li>
<li class="toctree-l3"><a class="reference internal" href="hit-the-rollup_EN.html">Noun Interpretation</a></li>
<li class="toctree-l3"><a class="reference internal" href="hit-the-rollup_EN.html#index">Index</a></li>
<li class="toctree-l3"><a class="reference internal" href="hit-the-rollup_EN.html#aggregate-data">Aggregate data</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../administrator-guide/index.html">Administrator Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="../extending-doris/index.html">Extending Ability</a></li>
<li class="toctree-l2"><a class="reference internal" href="../internal/index.html">Design Documents</a></li>
<li class="toctree-l2"><a class="reference internal" href="../sql-reference/index.html">SQL Manual</a></li>
<li class="toctree-l2"><a class="reference internal" href="../community/index.html">Apache Commnity</a></li>
</ul>
</li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">Doris Documentations</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../index.html">English</a> &raquo;</li>
        
          <li><a href="index.html">Getting started</a> &raquo;</li>
        
      <li>Data partition</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            
              <a href="https://github.com/apache/incubator-doris/blob/master/docs/documentation/en/getting-started/data-partition_EN.md" class="fa fa-github"> Edit on GitHub</a>
            
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="data-partition">
<h1>Data partition<a class="headerlink" href="#data-partition" title="Permalink to this headline">¶</a></h1>
<p>This document mainly introduces Doris’s table building and data partitioning, as well as possible problems and solutions in table building operation.</p>
<div class="section" id="basic-concepts">
<h2>Basic concepts<a class="headerlink" href="#basic-concepts" title="Permalink to this headline">¶</a></h2>
<p>In Doris, data is logically described in the form of tables.</p>
<div class="section" id="row-column">
<h3>Row &amp; Column<a class="headerlink" href="#row-column" title="Permalink to this headline">¶</a></h3>
<p>A table consists of rows and columns. Row is a row of user data. Column is used to describe different fields in a row of data.</p>
<p>Columns can be divided into two categories: Key and Value. From a business perspective, Key and Value can correspond to dimension columns and indicator columns, respectively. From the point of view of the aggregation model, the same row of the Key column is aggregated into a row. The aggregation of the Value column is specified by the user when the table is built. For an introduction to more aggregation models, see [Doris data model] (. / data-model-rollup. md).</p>
<p>‘35;\ 35;\ 35; Tablet &amp; Partition</p>
<p>In Doris’s storage engine, user data is divided horizontally into several data fragments (Tablets, also known as data buckets). Each table contains several rows of data. Data between Tablets does not intersect and is physically stored independently.</p>
<p>Multiple Tablets logically belong to different Partitions. A Tablet belongs to only one Partition. A Partition contains several Tablets. Because Tablet is physically stored independently, it can be considered that Partition is physically independent. Tablet is the smallest physical storage unit for data movement, replication and other operations.</p>
<p>Several Partitions form a Table. Partition can be regarded as the smallest management unit logically. Data import and deletion can be done for a single partition.</p>
</div>
</div>
<div class="section" id="id1">
<h2>Data partition<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h2>
<p>We illustrate Doris’s data partition with a table-building operation.</p>
<p>Doris’s table building is a synchronization command. The command returns success, which means that the table building is successful.</p>
<p>可以通过 <code class="docutils literal notranslate"><span class="pre">HELP</span> <span class="pre">CREATE</span> <span class="pre">TABLE;</span></code> 查看更多帮助。</p>
<p>This section presents an example of how Doris is constructed.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>CREATE TABLE IF NOT EXISTS example_db.expamle_tbl
(
`user_id` LARGEINT NOT NULL COMMENT &quot;用户id&quot;,
&quot;Date `date not null how `index `Fufu 8;&#39;Back
`timestamp` DATETIME NOT NULL COMMENT &quot;数据灌入的时间戳&quot;,
` City `VARCHAR (20) COMMENT `User City&#39;,
&quot;Age&quot; SMALLINT COMMENT &quot;29992;&quot; 25143;&quot;24180;&quot; 40836 &quot;,
`sex` TINYINT COMMENT &quot;用户性别&quot;,
&quot;last visit date&quot; DATETIME REPLACE DEFAULT &quot;1970 -01 -01 00:00&quot; COMMENT &quot;25143;&quot; 27425;&quot;35775;&quot; 3838382&quot;,
`cost` BIGINT SUM DEFAULT &quot;0&quot; COMMENT &quot;用户总消费&quot;,
Best Answer: Best Answer
How about &quot;99999&quot; as time goes by???????????????????????????????????????????????????????????????????????????????????????????
)
ENGINE=olap
AGGREGATE KEY(`user_id`, `date`, `timestamp`, `city`, `age`, `sex`)
PARTITION BY RANGE(`date`)
(
Segmentation `P201701 `value&#39;equals `2017-02-01&#39;,
Segmentation `P201702 `Value equals&#39;(2017-03-01&#39;),
Segmentation `P201703&#39;`Value less than&#39; (2017-04-01&#39;)
)
DISTRIBUTED BY HASH(`user_id`) BUCKETS 16
PROPERTIES
(
&quot;Replication\ num&quot; = &quot;3&quot;,
&quot;storage_medium&quot; = &quot;SSD&quot;,
&quot;Storage = U Cooldown = U Time&quot; = &quot;2018-01-12:00:
);
</pre></div>
</div>
<div class="section" id="column-definition">
<h3>Column Definition<a class="headerlink" href="#column-definition" title="Permalink to this headline">¶</a></h3>
<p>Here we only take the AGGREGATE KEY data model as an example to illustrate. Refer to [Doris data model] (. / data-model-rollup. md) for more data models.</p>
<p>The basic types of columns can be viewed by executing `HELP CREATE TABLE’in mysql-client.</p>
<p>In the AGGREGATE KEY data model, all columns without specified aggregation methods (SUM, REPLACE, MAX, MIN) are treated as Key columns. The rest are Value columns.</p>
<p>When defining columns, you can refer to the following suggestions:</p>
<ol class="simple">
<li>The Key column must precede all Value columns.</li>
<li>Choose integer type as far as possible. Because integer types are much more efficient than strings in computation and lookup.</li>
<li>For the selection principle of integer types of different lengths, follow the ** sufficient can **.</li>
<li>For the length of VARCHAR and STING types, follow ** suffice **.</li>
<li>The total byte length of all columns (including Key and Value) cannot exceed 100KB.</li>
</ol>
</div>
<div class="section" id="zoning-and-bucketing">
<h3>Zoning and Bucketing<a class="headerlink" href="#zoning-and-bucketing" title="Permalink to this headline">¶</a></h3>
<p>Doris supports two-tier data partitioning. The first layer is Partition, which only supports Range partitioning. The second layer is Bucket (Tablet), which only supports Hash partitioning.</p>
<p>You can also use only one layer of partition. Bucket partitioning is only supported when using one-tier partitioning.</p>
<ol class="simple">
<li>Partition</li>
</ol>
<ul class="simple">
<li>Partition columns can specify one or more columns. Partition classes must be KEY columns. The usage of multi-column partitions is introduced in the following ** summary of multi-column partitions.</li>
<li>Partition’s boundaries are left-closed and right-open. For example, if you want to store all February data in p201702, you need to enter the partition value “2017-03-01”, that is, the range: [2017-02-01, 2017-03-01].</li>
<li>Regardless of the partition column type, double quotation marks are required when writing partition values.</li>
<li>Partition columns are usually time columns to facilitate the management of old and new data.</li>
<li>There is no theoretical upper limit on the number of zones.</li>
<li>When Partition is not used to build tables, the system automatically generates a full-range Partition with the same name as the table name. The Partition is invisible to users and cannot be deleted.</li>
</ul>
<p>An example is given to illustrate the change of partition scope when adding or deleting partitions.</p>
<ul class="simple">
<li>As shown in the example above, when the table is completed, the following three partitions are automatically generated:</li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">p201701</span><span class="p">:</span> <span class="p">[</span><span class="n">MIN</span> <span class="n">VALUE</span><span class="p">,</span> <span class="mi">2017</span> <span class="o">-</span><span class="mi">02</span> <span class="o">-</span><span class="mi">01</span><span class="p">]</span>
<span class="n">p201702</span><span class="p">:</span> <span class="p">[</span><span class="mi">2017</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">01</span><span class="p">,</span> <span class="mi">2017</span><span class="o">-</span><span class="mi">03</span><span class="o">-</span><span class="mi">01</span><span class="p">)</span>
<span class="n">p201703</span><span class="p">:</span> <span class="p">[</span><span class="mi">2017</span><span class="o">-</span><span class="mi">03</span><span class="o">-</span><span class="mi">01</span><span class="p">,</span> <span class="mi">2017</span><span class="o">-</span><span class="mi">04</span><span class="o">-</span><span class="mi">01</span><span class="p">)</span>
</pre></div>
</div>
<ul class="simple">
<li>When we add a partition p201705 VALUES LESS THAN (“2017-06-01”), the partition results are as follows:</li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">p201701</span><span class="p">:</span> <span class="p">[</span><span class="n">MIN</span> <span class="n">VALUE</span><span class="p">,</span> <span class="mi">2017</span> <span class="o">-</span><span class="mi">02</span> <span class="o">-</span><span class="mi">01</span><span class="p">]</span>
<span class="n">p201702</span><span class="p">:</span> <span class="p">[</span><span class="mi">2017</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">01</span><span class="p">,</span> <span class="mi">2017</span><span class="o">-</span><span class="mi">03</span><span class="o">-</span><span class="mi">01</span><span class="p">)</span>
<span class="n">p201703</span><span class="p">:</span> <span class="p">[</span><span class="mi">2017</span><span class="o">-</span><span class="mi">03</span><span class="o">-</span><span class="mi">01</span><span class="p">,</span> <span class="mi">2017</span><span class="o">-</span><span class="mi">04</span><span class="o">-</span><span class="mi">01</span><span class="p">)</span>
<span class="n">p201705</span><span class="p">:</span> <span class="p">[</span><span class="mi">2017</span><span class="o">-</span><span class="mi">04</span><span class="o">-</span><span class="mi">01</span><span class="p">,</span> <span class="mi">2017</span><span class="o">-</span><span class="mi">06</span><span class="o">-</span><span class="mi">01</span><span class="p">)</span>
</pre></div>
</div>
<ul class="simple">
<li>When we delete partition p201703, the partition results are as follows:</li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">*</span><span class="n">p201701</span><span class="p">:</span> <span class="p">[</span><span class="n">MIN</span> <span class="n">VALUE</span><span class="p">,</span> <span class="mi">2017</span> <span class="o">-</span><span class="mi">02</span> <span class="o">-</span><span class="mi">01</span><span class="p">]</span>
<span class="o">*</span> <span class="n">p201702</span><span class="p">:</span> <span class="p">[</span><span class="mi">2017</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">01</span><span class="p">,</span> <span class="mi">2017</span><span class="o">-</span><span class="mi">03</span><span class="o">-</span><span class="mi">01</span><span class="p">)</span>
<span class="o">*</span> <span class="n">p201705</span><span class="p">:</span> <span class="p">[</span><span class="mi">2017</span><span class="o">-</span><span class="mi">04</span><span class="o">-</span><span class="mi">01</span><span class="p">,</span> <span class="mi">2017</span><span class="o">-</span><span class="mi">06</span><span class="o">-</span><span class="mi">01</span><span class="p">)</span>
</pre></div>
</div>
<blockquote>
<div>Notice that the partition ranges of p201702 and p201705 have not changed, and there is a gap between the two partitions: [2017-03-01, 2017-04-01]. That is, if the imported data range is within this empty range, it is imported as before.</div></blockquote>
<ul class="simple">
<li>Continue to delete partition p201702, partition results are as follows:</li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">*</span><span class="n">p201701</span><span class="p">:</span> <span class="p">[</span><span class="n">MIN</span> <span class="n">VALUE</span><span class="p">,</span> <span class="mi">2017</span> <span class="o">-</span><span class="mi">02</span> <span class="o">-</span><span class="mi">01</span><span class="p">]</span>
<span class="o">*</span> <span class="n">p201705</span><span class="p">:</span> <span class="p">[</span><span class="mi">2017</span><span class="o">-</span><span class="mi">04</span><span class="o">-</span><span class="mi">01</span><span class="p">,</span> <span class="mi">2017</span><span class="o">-</span><span class="mi">06</span><span class="o">-</span><span class="mi">01</span><span class="p">)</span>
<span class="o">*</span> <span class="n">The</span> <span class="n">void</span> <span class="nb">range</span> <span class="n">becomes</span><span class="p">:</span> <span class="p">[</span><span class="mi">2017</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">01</span><span class="p">,</span> <span class="mi">2017</span><span class="o">-</span><span class="mi">04</span><span class="o">-</span><span class="mi">01</span><span class="p">]</span>
</pre></div>
</div>
<ul class="simple">
<li>Now add a partition p201702 new VALUES LESS THAN (“2017-03-01”). The partition results are as follows:</li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">*</span><span class="n">p201701</span><span class="p">:</span> <span class="p">[</span><span class="n">MIN</span> <span class="n">VALUE</span><span class="p">,</span> <span class="mi">2017</span> <span class="o">-</span><span class="mi">02</span> <span class="o">-</span><span class="mi">01</span><span class="p">]</span>
<span class="o">*</span><span class="n">p201702new</span><span class="p">:</span> <span class="p">[</span><span class="mi">2017</span> <span class="o">-</span><span class="mi">02</span> <span class="o">-</span><span class="mi">01</span><span class="p">,</span> <span class="mi">2017</span> <span class="o">-</span><span class="mi">03</span> <span class="o">-</span><span class="mi">01</span><span class="p">]</span>
<span class="o">*</span><span class="n">p201705</span><span class="p">:</span> <span class="p">[</span><span class="mi">2017</span> <span class="o">-</span><span class="mi">04</span> <span class="o">-</span><span class="mi">01</span><span class="p">,</span> <span class="mi">2017</span> <span class="o">-</span><span class="mi">06</span> <span class="o">-</span><span class="mi">01</span><span class="p">]</span>
</pre></div>
</div>
<blockquote>
<div>It can be seen that the void range is reduced to: [2017-03-01, 2017-04-01]</div></blockquote>
<ul class="simple">
<li>Now delete partition p201701 and add partition p201612 VALUES LESS THAN (“2017-01-01”). The partition results are as follows:</li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">*</span><span class="n">p201612</span><span class="p">:</span> <span class="p">[</span><span class="n">MIN</span> <span class="n">VALUE</span><span class="p">,</span> <span class="mi">2017</span> <span class="o">-</span><span class="mi">01</span> <span class="o">-</span><span class="mi">01</span><span class="p">]</span>
<span class="o">*</span><span class="n">p201702new</span><span class="p">:</span> <span class="p">[</span><span class="mi">2017</span> <span class="o">-</span><span class="mi">02</span> <span class="o">-</span><span class="mi">01</span><span class="p">,</span> <span class="mi">2017</span> <span class="o">-</span><span class="mi">03</span> <span class="o">-</span><span class="mi">01</span><span class="p">]</span>
<span class="o">*</span><span class="n">p201705</span><span class="p">:</span> <span class="p">[</span><span class="mi">2017</span> <span class="o">-</span><span class="mi">04</span> <span class="o">-</span><span class="mi">01</span><span class="p">,</span> <span class="mi">2017</span> <span class="o">-</span><span class="mi">06</span> <span class="o">-</span><span class="mi">01</span><span class="p">]</span>
</pre></div>
</div>
<blockquote>
<div>A new void appears: [2017-01-01, 2017-02-01]</div></blockquote>
<p>In summary, deletion of partitions does not change the scope of existing partitions. Deleting partitions may cause holes. When partitions are added, the lower bound of a partition is immediately followed by the upper bound of a partition.
Partitions with overlapping ranges cannot be added.</p>
<ol class="simple">
<li>Bucket</li>
</ol>
<ul class="simple">
<li>If Partition is used, the `DISTRIBUTED…’statement describes the partitioning rules of data within ** partitions. If Partition is not used, the partitioning rules for the data of the entire table are described.</li>
<li>Bucket columns can be multiple columns, but must be Key columns. Bucket columns can be the same or different as ARTITION columns.</li>
<li>The choice of bucket columns is a trade-off between ** query throughput ** and ** query concurrency **:</li>
</ul>
<ol class="simple">
<li>If multiple bucket columns are selected, the data will be more evenly distributed. But if the query condition does not contain the equivalent condition of all bucket columns, a query scans all buckets. This increases the throughput of queries, but increases the latency of individual queries. This approach is suitable for query scenarios with high throughput and low concurrency.</li>
<li>If only one or a few bucket columns are selected, point query can query only one bucket. This method is suitable for high concurrent point query scenarios.</li>
</ol>
<ul class="simple">
<li>There is theoretically no upper limit on the number of buckets.</li>
</ul>
<ol class="simple">
<li>Suggestions on the quantity and data quantity of Partition and Bucket.</li>
</ol>
<ul class="simple">
<li>The total number of tables in a table is equal to (Partition num * Bucket num).</li>
<li>The number of tables in a table is recommended to be slightly more than the number of disks in the entire cluster, regardless of capacity expansion.</li>
<li>There is no upper and lower bound theoretically for the data volume of a single Tablet, but it is recommended to be within the range of 1G - 10G. If the amount of single Tablet data is too small, the aggregation effect of data is not good, and the pressure of metadata management is high. If the amount of data is too large, it is not conducive to the migration and completion of replicas, and will increase the cost of failed retries of Schema Change or Rollup operations (the granularity of these failed retries is Tablet).</li>
<li>When Tablet’s principle of data quantity conflicts with that of quantity, it is suggested that priority be given to the principle of data quantity.</li>
<li>When tabulating, the number of Buckets per partition is specified uniformly. However, when adding partitions dynamically (`ADD PARTITION’), you can specify the number of Buckets for new partitions separately. This function can be used to deal with data shrinkage or expansion conveniently.</li>
<li>Once specified, the number of Buckets for a Partition cannot be changed. Therefore, in determining the number of Buckets, it is necessary to consider the situation of cluster expansion in advance. For example, currently there are only three hosts, and each host has one disk. If the number of Buckets is set to 3 or less, concurrency cannot be improved even if machines are added later.</li>
<li>For example, suppose there are 10 BEs, one disk per BE. If the total size of a table is 500 MB, 4-8 fragments can be considered. 5GB: 8-16. 50GB: 32. 500GB: Recommended partition, each partition size is about 50GB, each partition 16-32 partitions. 5TB: Recommended partitions, each partition size is about 50GB, each partition 16-32 partitions.</li>
</ul>
<blockquote>
<div>Note: The amount of data in the table can be viewed by the `show data’command, and the result is divided by the number of copies, that is, the amount of data in the table.</div></blockquote>
<div class="section" id="multi-column-partition">
<h4>Multi-column partition<a class="headerlink" href="#multi-column-partition" title="Permalink to this headline">¶</a></h4>
<p>Doris supports specifying multiple columns as partitioned columns, as shown below:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>PARTITION BY RANGE(`date`, `id`)
(
Separating `P201701 `U1000 `values less than&#39;(2017-02-01&#39;, `1000&#39;),
Split `P201702 `U2000 `values less than&#39;(2017-03-01&#39;, `2000&#39;),
Segmentation `P201703 `U&#39;all `values less than (`2017-04-01&#39;)
)
</pre></div>
</div>
<p>In the above example, we specify <code class="docutils literal notranslate"><span class="pre">date'(DATE</span> <span class="pre">type)</span> <span class="pre">and</span> </code>id’ (INT type) as partition columns. The final partition of the above example is as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">*</span><span class="n">p201701</span><span class="o">.</span><span class="mi">1000</span><span class="p">:</span> <span class="p">[(</span><span class="n">MIN</span> <span class="n">VALUE</span><span class="p">,</span> <span class="n">MIN</span> <span class="n">VALUE</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;2017 -02 -01&quot;</span><span class="p">,</span> <span class="s2">&quot;1000&quot;</span><span class="p">)</span>
<span class="p">(</span><span class="mi">2017</span> <span class="o">-</span><span class="mi">02</span> <span class="o">-</span><span class="mi">01</span><span class="p">,</span> <span class="mi">1000</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;2017 -03 -01&quot;</span><span class="p">,</span> <span class="s2">&quot;2000&quot;</span><span class="p">)</span>
<span class="o">*</span><span class="n">p201703</span> <span class="nb">all</span><span class="p">:</span> <span class="p">[(</span><span class="s2">&quot;2017 -03 -01&quot;</span><span class="p">,</span> <span class="s2">&quot;2000&quot;</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;2017 -04 -01&quot;</span><span class="p">,</span> <span class="n">MIN</span> <span class="n">VALUE</span><span class="p">))</span>
</pre></div>
</div>
<p>Note that the last partition user specifies only the partition value of the <code class="docutils literal notranslate"><span class="pre">date'column</span> <span class="pre">by</span> <span class="pre">default,</span> <span class="pre">so</span> <span class="pre">the</span> <span class="pre">partition</span> <span class="pre">value</span> <span class="pre">of</span> <span class="pre">the</span> </code>id’ column is filled in by default `MIN_VALUE’. When the user inserts data, the partition column values are compared sequentially, and the corresponding partitions are finally obtained. Examples are as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">*</span> <span class="n">Data</span> <span class="o">-</span> <span class="o">&gt;</span> <span class="n">Partition</span>
<span class="o">*</span><span class="mi">2017</span> <span class="o">-</span><span class="mi">01</span><span class="p">,</span> <span class="mi">200</span> <span class="o">--&gt;</span> <span class="n">p201701</span> <span class="o">-</span><span class="n">u</span> <span class="mi">1000</span>
<span class="o">*</span> <span class="mi">2017</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span><span class="p">,</span> <span class="mi">2000</span>    <span class="o">--&gt;</span> <span class="n">p201701_1000</span>
<span class="o">*</span><span class="mi">2017</span> <span class="o">-</span><span class="mi">02</span> <span class="o">-</span><span class="mi">01</span><span class="p">,</span> <span class="mi">100</span> <span class="o">--&gt;</span> <span class="n">p201701</span> <span class="o">-</span><span class="n">u</span> <span class="mi">1000</span>
<span class="o">*</span> <span class="mi">2017</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">01</span><span class="p">,</span> <span class="mi">2000</span>    <span class="o">--&gt;</span> <span class="n">p201702_2000</span>
<span class="o">*</span> <span class="mi">2017</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">15</span><span class="p">,</span> <span class="mi">5000</span>    <span class="o">--&gt;</span> <span class="n">p201702_2000</span>
<span class="o">*</span> <span class="mi">2017</span><span class="o">-</span><span class="mi">03</span><span class="o">-</span><span class="mi">01</span><span class="p">,</span> <span class="mi">2000</span>    <span class="o">--&gt;</span> <span class="n">p201703_all</span>
<span class="o">*</span> <span class="mi">2017</span><span class="o">-</span><span class="mi">03</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="mi">1</span><span class="o">-&gt;</span> <span class="n">P201703</span>  <span class="nb">all</span>
<span class="o">*</span> <span class="mi">2017</span><span class="o">-</span><span class="mi">04</span><span class="o">-</span><span class="mi">01</span><span class="p">,</span> <span class="mi">1000</span> <span class="o">-</span> <span class="o">&gt;</span> <span class="n">Unable</span> <span class="n">to</span> <span class="kn">import</span>
<span class="o">*</span> <span class="mi">2017</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">01</span><span class="p">,</span> <span class="mi">1000</span> <span class="o">-</span> <span class="o">&gt;</span> <span class="n">Unable</span> <span class="n">to</span> <span class="kn">import</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="properties">
<h3>PROPERTIES<a class="headerlink" href="#properties" title="Permalink to this headline">¶</a></h3>
<p>In the final PROPERTIES of the table statement, you can specify the following two parameters:</p>
<p>One copy</p>
<ul class="simple">
<li>Number of copies per Tablet. The default is 3. It is recommended that the default be maintained. In the table statement, the number of Tablet replicas in all Partitions is specified uniformly. When adding a new partition, you can specify the number of Tablet copies in the new partition separately.</li>
<li>The number of copies can be modified at run time. It is strongly recommended that odd numbers be maintained.</li>
<li>The maximum number of copies depends on the number of independent IP in the cluster (note that it is not the number of BEs). The principle of duplicate distribution in Doris is that duplicates of the same Tablet are not allowed to be distributed on the same physical machine, while identifying the physical machine is through IP. Therefore, even if three or more BE instances are deployed on the same physical machine, if the IP of these BEs is the same, only 1 copy number can be set.</li>
<li>For some small and infrequently updated dimension tables, you can consider setting more copies. In this way, when Join queries, there is a greater probability of local data Join.</li>
</ul>
<ol class="simple">
<li>storage_medium &amp; storage_cooldown_time</li>
</ol>
<ul class="simple">
<li>The data storage directory of BE can be explicitly specified as SSD or HDD (distinguished by. SSD or. HDD suffixes). When creating a table, you can specify all the media that Partition initially stores. Note that the suffix function is to explicitly specify the disk media without checking whether it matches the actual media type.</li>
<li>The default initial storage medium is HDD. If SSD is specified, the data is initially stored on SSD.</li>
<li>If storage cooldown time is not specified, data will be automatically migrated from SSD to HDD 7 days later by default. If storage cooldown time is specified, the data migrates only after the storage_cooldown_time time time is reached.</li>
<li>Note that when storage_media is specified, this parameter is just a “best effort” setting. Even if SSD storage medium is not set up in the cluster, it will not report errors, but will be automatically stored in the available data directory. Similarly, if SSD media is inaccessible and space is insufficient, it may cause data to be stored directly on other available media initially. When data is migrated to HDD at maturity, if HDD media is inaccessible and space is insufficient, the migration may fail (but it will keep trying).</li>
</ul>
</div>
<div class="section" id="engine">
<h3>ENGINE<a class="headerlink" href="#engine" title="Permalink to this headline">¶</a></h3>
<p>In this example, the ENGINE type is olap, which is the default ENGINE type. In Doris, only this ENGINE type is responsible for data management and storage by Doris. Other ENGINE types, such as mysql, broker, es, etc., are essentially mappings to tables in other external databases or systems to ensure that Doris can read these data. Doris itself does not create, manage and store any tables and data of non-olap ENGINE type.</p>
</div>
<div class="section" id="others">
<h3>Others<a class="headerlink" href="#others" title="Permalink to this headline">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">IF</span> <span class="pre">NOT</span> <span class="pre">EXISTS</span></code> indicates that if the table has not been created, it will be created. Note that only the existence of table names is judged here, not whether the new table structure is the same as the existing table structure. So if there is a table with the same name but different structure, the command returns success, but it does not mean that a new table and new structure have been created.</p>
</div>
</div>
<div class="section" id="common-questions">
<h2>Common Questions<a class="headerlink" href="#common-questions" title="Permalink to this headline">¶</a></h2>
<div class="section" id="common-problems-in-table-building-operation">
<h3>Common problems in table building operation<a class="headerlink" href="#common-problems-in-table-building-operation" title="Permalink to this headline">¶</a></h3>
<ol class="simple">
<li>If a grammatical error occurs in a long table-building statement, the phenomenon of incomplete grammatical error hints may occur. Here is a list of possible grammatical errors for manual error correction:</li>
</ol>
<ul class="simple">
<li>Error in grammatical structure. Please read <code class="docutils literal notranslate"><span class="pre">HELP</span> <span class="pre">CREATE</span> <span class="pre">TABLE'carefully;</span> </code>Check the relevant grammatical structure.</li>
<li>Keep words. When a user-defined name encounters a reserved word, it needs to be caused by a back quotation mark `. It is recommended that all custom names be generated using this symbol.</li>
<li>Chinese characters or full-angle characters. Non-utf8 coded Chinese characters, or hidden full-angle characters (spaces, punctuation, etc.), can lead to grammatical errors. It is recommended to use a text editor with invisible characters to check.</li>
</ul>
<ol class="simple">
<li><code class="docutils literal notranslate"><span class="pre">Failed</span> <span class="pre">to</span> <span class="pre">create</span> <span class="pre">partition</span> <span class="pre">[xxx]</span> <span class="pre">.</span> <span class="pre">Timeout</span></code></li>
</ol>
<p>Doris tables are created in order of partition granularity. This error may be reported when a Partition creation fails. Even if you don’t use Partition, you will report `Failed to create Partition’when a table is built incorrectly, because Doris will create an immutable default Artition for a table that does not specify Partition, as described earlier.</p>
<p>When encountering this error, BE usually encounters problems in creating data fragments. Reference can be made to the following steps:</p>
<ol class="simple">
<li>In fe.log, find the `Failed to create Partition’log for the corresponding time point. In this log, there will be a series of number pairs similar to {10001-10010}. The first number of the number pair represents the Backend ID, and the second number represents the Tablet ID. As the above number pair indicates, on the Backend with ID 10001, the creation of a Tablet with ID 10010 failed.</li>
<li>Go to the be.INFO log corresponding to Backend and find the tablet id-related log within the corresponding time period to find the error information.</li>
<li>Following are some common tablet creation failures, including but not limited to:</li>
</ol>
<ul class="simple">
<li>BE did not receive the related task, and the tablet ID related log could not be found in be.INFO at this time. Or BE was created successfully, but failed to report. For the above questions, see the Deployment and Upgrade Document to check the connectivity between FE and BE.</li>
<li>Pre-allocated memory failed. Perhaps the byte length of a row in the table exceeds 100KB.
*<code class="docutils literal notranslate"><span class="pre">Too</span> <span class="pre">many</span> <span class="pre">open</span> <span class="pre">files</span></code>. The number of open file handles exceeds the Linux system limit. Handle limit of Linux system needs to be modified.</li>
</ul>
<p>You can also extend the timeout time by setting `tablet_create_timeout_second= xxx’in fe.conf. The default is 2 seconds.</p>
<ol class="simple">
<li>Tabulation commands do not return results for a long time.</li>
</ol>
<p>Doris’s build command is a synchronization command. The command’s timeout time is currently set in a relatively simple (tablet num * replication num) second. If you create more data fragments, and some of them fail to create fragments, you may be waiting for a longer timeout before returning an error.</p>
<p>Normally, the build statement will return in a few seconds or a dozen seconds. If it takes more than one minute, it is recommended to cancel this operation directly and go to the FE or BE log to check for related errors.</p>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="data-model-rollup_EN.html" class="btn btn-neutral float-right" title="Data Model, ROLLUP and Prefix Index" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="best-practice_EN.html" class="btn btn-neutral float-left" title="Best Practices" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, Apache Doris(Incubating)

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
<div role="contentinfo">
    <p></p>
    <p>

        Apache Doris is an effort undergoing incubation at The Apache Software Foundation (ASF), sponsored by the name of Apache TLP sponsor. Incubation is required of all newly accepted projects until a further review indicates that the infrastructure, communications, and decision making process have stabilized in a manner consistent with other successful ASF projects. While incubation status is not necessarily a reflection of the completeness or stability of the code, it does indicate that the project has yet to be fully endorsed by the ASF.

    </p>
</div>


</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>